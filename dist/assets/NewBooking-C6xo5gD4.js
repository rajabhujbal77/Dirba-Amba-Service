import{_ as oe}from"./vendor-pdf-DRk-497H.js";import{r as N,j as e,R as le}from"./vendor-radix-BK0gN1wx.js";import{c as ee,u as ce,d as se,e as ne,f as de,p as xe,g as ge,s as ue,b as he,q as te}from"./index-BkVEoUbx.js";import"./vendor-react-BRY8hXab.js";import"./vendor-state-B-0uGrSJ.js";function re({nameValue:r,phoneValue:n,onNameChange:m,onPhoneChange:F,onContactSelect:k,nameLabel:I="Name",phoneLabel:p="Phone",namePlaceholder:f="Enter name",phonePlaceholder:c="10-digit number",required:P=!1}){const[T,l]=N.useState([]),[v,R]=N.useState(!1),[w,_]=N.useState(null),[z,B]=N.useState(!1),h=N.useRef(null);N.useEffect(()=>{const i=w==="name"?r:n;if(!i||i.length<2){l([]),R(!1);return}const a=setTimeout(async()=>{B(!0);const{contacts:s}=await ee.search(i);l(s),R(s.length>0),B(!1)},300);return()=>clearTimeout(a)},[r,n,w]),N.useEffect(()=>{const i=a=>{h.current&&!h.current.contains(a.target)&&R(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const t=i=>{m(i.name),F(i.phone),R(!1),k&&k(i)},o=i=>/^[6-9]\d{9}$/.test(i);return e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[I," ",P&&"*"]}),e.jsx("input",{type:"text",value:r,onChange:i=>m(i.target.value),onFocus:()=>_("name"),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:f,autoComplete:"off",required:P})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[p," ",P&&"*"]}),e.jsx("input",{type:"tel",value:n,onChange:i=>F(i.target.value),onFocus:()=>_("phone"),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:c,maxLength:10,autoComplete:"off",required:P}),n&&!o(n)&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Must be 10 digits starting with 9, 8, 7, or 6"})]})]}),v&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:z?e.jsx("div",{className:"p-3 text-gray-500 text-center",children:"Searching..."}):T.map(i=>e.jsx("button",{type:"button",onClick:()=>t(i),className:"w-full text-left px-4 py-3 hover:bg-orange-50 border-b border-gray-100 last:border-0 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:i.name}),e.jsx("div",{className:"text-sm text-gray-600",children:i.phone})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Used ",i.usage_count,"x"]})]})},i.id))})]})}function Ce({onNavigate:r}){const[n,m]=N.useState(1),[F,k]=N.useState(null),[I,p]=N.useState(!0),[f,c]=N.useState([]),[P,T]=N.useState([]),[l,v]=N.useState([]),[R,w]=N.useState(!1),[_,z]=N.useState(""),[B,h]=N.useState(!1),{draft:t,hasDraft:o,saveDraft:i,clearDraft:a,lastSavedAt:s,pendingBookingId:x,setPendingBookingId:y}=ce(),b=se(g=>g.isOnline),j=ne(g=>g.pendingOperations),[d,u]=N.useState({originDepotId:"",destinationDepotId:"",paymentMethod:"cash",deliveryType:"pickup",deliveryCharge:0,customInstructions:"",senderName:"",senderPhone:"",receivers:[{name:"",phone:"",address:"",packages:[]}]});N.useEffect(()=>{o&&t&&s&&((Date.now()-new Date(s).getTime())/36e5<24?h(!0):a())},[]),N.useEffect(()=>{const g=setTimeout(()=>{(d.senderName||d.senderPhone||d.originDepotId)&&i(d)},1e3);return()=>clearTimeout(g)},[d,i]),N.useEffect(()=>{W()},[]);const W=async()=>{try{const[g,S,L,A]=await Promise.all([de.getAll(),xe.getAll(),ge.getAll(),ue.get()]),E=g.depots||[];c(E),T(S.packages||[]),v(L.pricing||[]);const C=E.find($=>{var G;return((G=$.name)==null?void 0:G.toLowerCase())==="devgad"&&$.type==="origin"});if(C&&u($=>({...$,originDepotId:C.id})),A.season){k(A.season);const $=new Date,G=new Date(A.season.startDate),ie=new Date(A.season.endDate),ae=$>=G&&$<=ie;p(ae)}}catch(g){console.error("Error loading data:",g)}},U=()=>{let g=0;return d.receivers.forEach(S=>{S.packages.forEach(L=>{g+=L.quantity*L.price})}),g+(d.deliveryCharge||0)},D=async()=>{var g,S,L;w(!0),console.log("[NewBooking] handleSubmit called"),console.log("[NewBooking] isOnline from store:",b),console.log("[NewBooking] navigator.onLine:",navigator.onLine);try{const A={origin_depot_id:d.originDepotId,destination_depot_id:d.destinationDepotId,payment_method:d.paymentMethod,delivery_type:d.deliveryType,delivery_charges:d.deliveryCharge,sender_name:d.senderName,sender_phone:d.senderPhone,receivers:d.receivers,subtotal:U()-(d.deliveryCharge||0),total_amount:U(),current_status:"booked",special_instructions:d.customInstructions};if(b)try{const E=await he.create(A),C=((g=E.booking)==null?void 0:g.receipt_number)||((S=E.booking)==null?void 0:S.id)||"Unknown";z(C),d.senderName&&d.senderPhone&&await ee.upsert(d.senderName,d.senderPhone).catch(console.error);for(const $ of d.receivers)$.name&&$.phone&&await ee.upsert($.name,$.phone).catch(console.error);a(),m(5)}catch(E){console.error("Error creating booking:",E);const C=((L=E.message)==null?void 0:L.toLowerCase())||"";if(C.includes("fetch")||C.includes("network")||C.includes("failed to fetch")||C.includes("err_name_not_resolved")||C.includes("err_internet_disconnected")||C.includes("err_connection")||C.includes("err_network")||C.includes("net::")||C.includes("timeout")||C.includes("abort")||E.name==="TypeError"||E.code==="ECONNREFUSED"||!navigator.onLine){console.log("[NewBooking] Network error detected, queuing operation");const G=te("CREATE_BOOKING",A,{entityType:"booking",optimisticData:{formData:d,createdAt:new Date().toISOString()}});y(G),z("PENDING-"+G.slice(-8).toUpperCase()),a(),m(5)}else alert("Failed to create booking. Please try again.")}else{const E=te("CREATE_BOOKING",A,{entityType:"booking",optimisticData:{formData:d,createdAt:new Date().toISOString()}});y(E),z("PENDING-"+E.slice(-8).toUpperCase()),a(),m(5)}}catch(A){console.error("Error creating booking:",A),alert("Failed to create booking. Please try again.")}finally{w(!1)}},H=N.useRef(null),q=N.useRef(null),K=g=>{H.current=g.touches[0].clientX,q.current=g.touches[0].clientY},Q=g=>{if(H.current===null||q.current===null)return;const S=g.changedTouches[0].clientX,L=g.changedTouches[0].clientY,A=S-H.current,E=L-q.current;Math.abs(A)>Math.abs(E)&&Math.abs(A)>50&&(A<0&&n<4?m(C=>Math.min(C+1,4)):A>0&&n>1&&m(C=>Math.max(C-1,1))),H.current=null,q.current=null},O=()=>m(g=>Math.min(g+1,5)),Y=()=>m(g=>Math.max(g-1,1)),M=g=>m(g),J=()=>{const g=f.find(S=>{var L;return((L=S.name)==null?void 0:L.toLowerCase())==="devgad"&&S.type==="origin"});u({originDepotId:(g==null?void 0:g.id)||"",destinationDepotId:"",paymentMethod:"cash",deliveryType:"pickup",deliveryCharge:0,customInstructions:"",senderName:"",senderPhone:"",receivers:[{name:"",phone:"",address:"",packages:[]}]}),z(""),m(1),a(),y(null)},X=()=>{t&&u(t),h(!1)},Z=()=>{a(),h(!1)};if(!I)return e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ü•≠"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Mango Season is Currently Closed"}),e.jsx("p",{className:"text-gray-600",children:"Please check back during the mango season."})]});const V=["Depot & Payment","Sender Details","Receivers & Packages","Summary"];return x&&j.find(g=>g.id===x&&g.status==="completed"),e.jsxs("div",{className:"p-8",children:[B&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"üìù"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"Resume Previous Booking?"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["You have an unsaved booking from ",s?new Date(s).toLocaleString():"earlier",". Would you like to continue where you left off?"]}),e.jsxs("div",{className:"flex gap-3 mt-3",children:[e.jsx("button",{onClick:X,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Resume Booking"}),e.jsx("button",{onClick:Z,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium",children:"Start Fresh"})]})]})]})}),!b&&n<5&&e.jsx("div",{className:"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-amber-800",children:"You're currently offline. "}),e.jsx("span",{className:"text-amber-700",children:"Your booking will be saved and submitted when you're back online."})]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"New Booking"}),e.jsx("p",{className:"text-gray-600",children:"Create a new transport booking"})]}),n<=4&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4 lg:hidden",children:[e.jsx("button",{onClick:Y,disabled:n===1,className:`p-3 rounded-full transition-colors touch-target ${n===1?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-orange-100 text-orange-600 hover:bg-orange-200 active:bg-orange-300"}`,"aria-label":"Previous step",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["Step ",n," of 4"]}),e.jsx("div",{className:"text-sm text-gray-600",children:V[n-1]})]}),e.jsx("button",{onClick:O,disabled:n===4,className:`p-3 rounded-full transition-colors touch-target ${n===4?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-orange-100 text-orange-600 hover:bg-orange-200 active:bg-orange-300"}`,"aria-label":"Next step",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"hidden lg:flex items-center justify-center gap-2",children:V.map((g,S)=>e.jsxs(le.Fragment,{children:[e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium ${n===S+1?"bg-orange-500 text-white":n>S+1?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[e.jsx("span",{children:S+1}),e.jsx("span",{children:g})]}),S<3&&e.jsx("div",{className:"w-8 h-0.5 bg-gray-200"})]},S))}),e.jsx("p",{className:"lg:hidden text-center text-xs text-gray-400 mt-2",children:"Swipe or use arrows to navigate"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 max-w-4xl mx-auto",onTouchStart:K,onTouchEnd:Q,children:[n===1&&e.jsx(me,{formData:d,setFormData:u,depots:f,onNext:O}),n===2&&e.jsx(pe,{formData:d,setFormData:u,onNext:O,onPrev:Y}),n===3&&e.jsx(be,{formData:d,setFormData:u,packages:P,pricing:l,onNext:O,onPrev:Y}),n===4&&e.jsx(ye,{formData:d,depots:f,onSubmit:D,onPrev:Y,goToStep:M,isSubmitting:R}),n===5&&e.jsx(ve,{receiptNumber:_,formData:d,depots:f,onNewBooking:J,onNavigate:r})]})]})}function me({formData:r,setFormData:n,depots:m,onNext:F}){const k=m.filter(c=>c.type==="origin"),p=m.filter(c=>c.type!=="origin").sort((c,P)=>{var R,w;const T=["bhusari colony","sadashiv peth","akurdi"],l=T.indexOf((R=c.name)==null?void 0:R.toLowerCase()),v=T.indexOf((w=P.name)==null?void 0:w.toLowerCase());return l!==-1&&v!==-1?l-v:l!==-1?-1:v!==-1?1:(c.name||"").localeCompare(P.name||"")}),f=r.originDepotId&&r.destinationDepotId&&r.paymentMethod;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Step 1: Route & Payment"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Origin Depot *"}),e.jsxs("select",{value:r.originDepotId,onChange:c=>n({...r,originDepotId:c.target.value,destinationDepotId:""}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select Origin"}),k.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Destination Depot *"}),e.jsxs("select",{value:r.destinationDepotId,onChange:c=>n({...r,destinationDepotId:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500",disabled:!r.originDepotId,children:[e.jsx("option",{value:"",children:"Select Destination"}),p.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Payment Method *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{value:"cash",label:"üíµ Cash"},{value:"online",label:"üì± Online"},{value:"to_pay",label:"üì¶ To Pay"},{value:"credit",label:"üí≥ Credit"}].map(c=>e.jsx("button",{type:"button",onClick:()=>n({...r,paymentMethod:c.value}),className:`px-4 py-3 rounded-lg border-2 text-sm font-medium transition-all ${r.paymentMethod===c.value?"border-orange-500 bg-orange-50 text-orange-700":"border-gray-200 hover:border-orange-300"}`,children:c.label},c.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Delivery Type *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{value:"pickup",label:"üè™ Depot Pickup",desc:"Receiver picks up from depot"},{value:"home_sender",label:"üè† Home Delivery (Paid)",desc:"Delivery paid by sender"},{value:"home_topay",label:"üöö Home Delivery (To Pay)",desc:"Delivery paid by receiver"},{value:"home_drt",label:"üìç DRT Delivery",desc:"Special DRT delivery"}].map(c=>e.jsxs("button",{type:"button",onClick:()=>n({...r,deliveryType:c.value,deliveryCharge:0}),className:`p-4 rounded-lg border-2 text-left transition-all ${r.deliveryType===c.value?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-orange-300"}`,children:[e.jsx("div",{className:"font-medium",children:c.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:c.desc})]},c.value))})]}),r.deliveryType!=="pickup"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Charge (‚Çπ)"}),e.jsx("input",{type:"number",min:"0",value:r.deliveryCharge,onChange:c=>n({...r,deliveryCharge:Number(c.target.value)}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500",placeholder:"Enter delivery charge"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Instructions (Optional)"}),e.jsx("textarea",{value:r.customInstructions,onChange:c=>n({...r,customInstructions:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500",rows:2,placeholder:"Any special handling instructions..."})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:F,disabled:!f,className:"px-8 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 font-medium",children:"Next Step ‚Üí"})})]})}function pe({formData:r,setFormData:n,onNext:m,onPrev:F}){const k=p=>/^[6-9]\d{9}$/.test(p),I=r.senderName&&k(r.senderPhone);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Step 2: Sender Details"}),e.jsx("p",{className:"text-gray-600",children:"Start typing to see suggestions from past bookings"}),e.jsx(re,{nameValue:r.senderName,phoneValue:r.senderPhone,onNameChange:p=>n({...r,senderName:p}),onPhoneChange:p=>n({...r,senderPhone:p}),onContactSelect:p=>n({...r,senderName:p.name,senderPhone:p.phone}),nameLabel:"Sender Name",phoneLabel:"Sender Phone",namePlaceholder:"Start typing name...",phonePlaceholder:"10-digit number",required:!0}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:F,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",children:"‚Üê Previous"}),e.jsx("button",{onClick:m,disabled:!I,className:"px-8 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 font-medium",children:"Next Step ‚Üí"})]})]})}function be({formData:r,setFormData:n,packages:m,pricing:F,onNext:k,onPrev:I}){const p=o=>/^[6-9]\d{9}$/.test(o),f=["home_sender","home_topay","home_drt"].includes(r.deliveryType),c=o=>{var a;const i=F.find(s=>s.packageId===o&&s.depotId===r.destinationDepotId);return(i==null?void 0:i.price)||((a=m.find(s=>s.id===o))==null?void 0:a.basePrice)||0},P=[...m].sort((o,i)=>{var j,d;const a=["1 dz","1dz","2 dz","2dz","3 dz","3dz","5 dz","5dz"],s=((j=o.name)==null?void 0:j.toLowerCase())||"",x=((d=i.name)==null?void 0:d.toLowerCase())||"",y=a.findIndex(u=>s.includes(u)),b=a.findIndex(u=>x.includes(u));return y!==-1&&b!==-1?y-b:y!==-1?-1:b!==-1?1:s.localeCompare(x)}),T=(o,i,a)=>{const s=[...r.receivers];s[o]={...s[o],[i]:a},n({...r,receivers:s})},l=(o,i,a)=>{const s=[...r.receivers],x=s[o],y=m.find(d=>d.id===i),b=c(i),j=x.packages.findIndex(d=>d.packageId===i);if(a>0){const d={packageId:i,size:(y==null?void 0:y.name)||"Custom",quantity:a,price:b};j>=0?x.packages[j]=d:x.packages.push(d)}else j>=0&&x.packages.splice(j,1);n({...r,receivers:s})},v=(o,i,a)=>{const s=[...r.receivers],x=s[o],y=x.packages.findIndex(b=>b.packageId===i);y>=0&&(x.packages[y].description=a,n({...r,receivers:s}))},R=(o,i)=>{var s,x;const a=(x=(s=r.receivers[o])==null?void 0:s.packages)==null?void 0:x.find(y=>y.packageId===i);return(a==null?void 0:a.description)||""},w=o=>(o==null?void 0:o.toLowerCase())==="other",_=(o,i)=>{var s,x;const a=(x=(s=r.receivers[o])==null?void 0:s.packages)==null?void 0:x.find(y=>y.packageId===i);return(a==null?void 0:a.quantity)||0},z=()=>{n({...r,receivers:[...r.receivers,{name:"",phone:"",address:"",packages:[]}]})},B=o=>{if(r.receivers.length>1){const i=r.receivers.filter((a,s)=>s!==o);n({...r,receivers:i})}},h=o=>o.packages.reduce((i,a)=>i+a.quantity*a.price,0),t=r.receivers.every(o=>o.name&&p(o.phone)&&o.packages.length>0&&(!f||o.address));return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Step 3: Receivers & Packages"}),e.jsx("p",{className:"text-gray-600",children:"Add receiver details and select packages for each receiver"}),r.receivers.map((o,i)=>e.jsxs("div",{className:"p-6 border-2 border-gray-200 rounded-lg space-y-4 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:["Receiver ",i+1]}),r.receivers.length>1&&e.jsx("button",{onClick:()=>B(i),className:"text-red-600 hover:text-red-700 text-sm font-medium",children:"Remove"})]}),e.jsx(re,{nameValue:o.name,phoneValue:o.phone,onNameChange:a=>T(i,"name",a),onPhoneChange:a=>T(i,"phone",a),onContactSelect:a=>{const s=[...r.receivers];s[i]={...s[i],name:a.name,phone:a.phone},n({...r,receivers:s})},nameLabel:"Receiver Name",phoneLabel:"Receiver Phone",namePlaceholder:"Start typing name...",phonePlaceholder:"10-digit number",required:!0}),f&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Address *"}),e.jsx("textarea",{value:o.address,onChange:a=>T(i,"address",a.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500",rows:2,placeholder:"Enter full delivery address",required:!0})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"üì¶ Select Packages"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:P.map(a=>{const s=c(a.id),x=_(i,a.id),y=w(a.name),b=R(i,a.id);return e.jsxs("div",{className:`p-3 bg-white border rounded-lg hover:border-orange-300 transition-colors ${y&&x>0?"border-yellow-400 col-span-full":"border-gray-200"}`,children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:a.name}),e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["‚Çπ",s,"/unit"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",value:x>0?x:"",placeholder:"0",onChange:j=>l(i,a.id,Number(j.target.value)||0),className:`w-16 px-2 py-1 text-center border rounded focus:ring-2 focus:ring-orange-500 ${x>0?"border-orange-400 bg-orange-50":"border-gray-300 text-gray-400"}`}),x>0&&e.jsxs("span",{className:"text-xs font-medium text-green-600",children:["‚Çπ",(x*s).toFixed(0)]})]}),y&&x>0&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",value:b,onChange:j=>v(i,a.id,j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-sm",placeholder:"Enter description (e.g., Special box, Custom crate...)"})})]},a.id)})})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:["Subtotal for ",o.name||`Receiver ${i+1}`,":"]}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["‚Çπ",h(o).toFixed(2)]})]})})]},i)),e.jsx("button",{onClick:z,className:"w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-orange-500 hover:text-orange-500 font-medium transition-colors",children:"+ Add Another Receiver"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:I,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",children:"‚Üê Previous"}),e.jsx("button",{onClick:k,disabled:!t,className:"px-8 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 font-medium",children:"Review Summary ‚Üí"})]})]})}function ye({formData:r,depots:n,onSubmit:m,onPrev:F,goToStep:k,isSubmitting:I}){var T,l;const p=n.find(v=>v.id===r.originDepotId),f=n.find(v=>v.id===r.destinationDepotId),c=r.receivers.reduce((v,R)=>v+R.packages.reduce((w,_)=>w+_.quantity*_.price,0),0),P=c+(r.deliveryCharge||0);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Step 4: Review & Confirm"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"üìç Route"}),e.jsx("button",{onClick:()=>k(1),className:"text-orange-600 text-sm hover:underline",children:"Edit"})]}),e.jsxs("p",{children:[p==null?void 0:p.name," ‚Üí ",f==null?void 0:f.name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Payment: ",(T=r.paymentMethod)==null?void 0:T.toUpperCase()," | Delivery: ",(l=r.deliveryType)==null?void 0:l.replace("_"," ")]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"üë§ Sender"}),e.jsx("button",{onClick:()=>k(2),className:"text-orange-600 text-sm hover:underline",children:"Edit"})]}),e.jsxs("p",{children:[r.senderName," (",r.senderPhone,")"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"üì¶ Receivers & Packages"}),e.jsx("button",{onClick:()=>k(3),className:"text-orange-600 text-sm hover:underline",children:"Edit"})]}),r.receivers.map((v,R)=>e.jsxs("div",{className:"border-l-4 border-orange-300 pl-4 mb-4",children:[e.jsxs("p",{className:"font-medium",children:[v.name," (",v.phone,")"]}),v.address&&e.jsx("p",{className:"text-sm text-gray-600",children:v.address}),e.jsx("div",{className:"mt-2 space-y-1",children:v.packages.map((w,_)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[w.size," √ó ",w.quantity]}),e.jsxs("span",{children:["‚Çπ",(w.quantity*w.price).toFixed(0)]})]},_))})]},R))]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Packages Subtotal"}),e.jsxs("span",{children:["‚Çπ",c.toFixed(2)]})]}),r.deliveryCharge>0&&e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Delivery Charge"}),e.jsxs("span",{children:["‚Çπ",r.deliveryCharge.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2 pt-2 border-t border-orange-300",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{className:"text-orange-600",children:["‚Çπ",P.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:F,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",children:"‚Üê Previous"}),e.jsx("button",{onClick:m,disabled:I,className:"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-medium",children:I?"Creating...":"‚úì Confirm Booking"})]})]})}function ve({receiptNumber:r,formData:n,depots:m,onNewBooking:F,onNavigate:k}){const I=m==null?void 0:m.find(h=>h.id===(n==null?void 0:n.originDepotId)),p=m==null?void 0:m.find(h=>h.id===(n==null?void 0:n.destinationDepotId)),f=r==null?void 0:r.startsWith("PENDING-"),c=ne(h=>h.pendingOperations),P=se(h=>h.isOnline),T=f?r.replace("PENDING-","").toLowerCase():null,l=T?c.find(h=>h.id.toLowerCase().endsWith(T)):null,v=()=>n!=null&&n.receivers?n.receivers.reduce((h,t)=>h+(t.packages||[]).reduce((o,i)=>o+i.quantity*i.price,0),0)+(n.deliveryCharge||0):0,R=()=>{var t;const h=["ü•≠ DIRBA AMBA SERVICE","‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ",`Receipt: ${r}`,`Date: ${new Date().toLocaleDateString("en-IN")}`,"","üìç DESTINATION",`${(p==null?void 0:p.name)||"N/A"}`,"","üë§ SENDER",`*${(n==null?void 0:n.senderName)||"N/A"}* (${(n==null?void 0:n.senderPhone)||"N/A"})`,"","üì¶ RECEIVERS & PACKAGES"];return(t=n==null?void 0:n.receivers)==null||t.forEach((o,i)=>{var a;h.push(`
${i+1}. ${o.name} (${o.phone})`),(a=o.packages)==null||a.forEach(s=>{h.push(`   ‚Ä¢ ${s.size} √ó ${s.quantity} = ‚Çπ${(s.quantity*s.price).toFixed(0)}`)})}),h.push(`
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`),h.push(`üí∞ TOTAL: ‚Çπ${v().toFixed(2)}`),h.push(`
Thank you for choosing Dirba Amba Service! ü•≠`),h.join(`
`)},w=()=>{const h=encodeURIComponent(R());window.open(`https://wa.me/?text=${h}`,"_blank")},_=async()=>{var Q,O,Y;const{jsPDF:h}=await oe(async()=>{const{jsPDF:M}=await import("./vendor-pdf-DRk-497H.js").then(J=>J.j);return{jsPDF:M}},[]),t=new h({format:"a5",unit:"mm",orientation:"landscape"}),o=t.internal.pageSize.getWidth(),i=t.internal.pageSize.getHeight(),a=12;let s=12;t.setFontSize(18),t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("DIRBA AMBA SERVICE",o/2,s,{align:"center"}),s+=5,t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(80,80,80),t.text("AT POST JAMSANDE, TAL.DEVGAD, DIST. SINDHUDURG | MOB: 9422584166, 9422435348",o/2,s,{align:"center"}),t.setTextColor(0,0,0),s+=6,t.setDrawColor(200,200,200),t.setLineWidth(.3),t.line(a,s,o-a,s),s+=6,t.setFontSize(10),t.setFont("helvetica","bold"),t.text(`Receipt No: ${r}`,a,s),t.setFont("helvetica","normal"),t.text(`Date: ${new Date().toLocaleDateString("en-IN")}`,o-a,s,{align:"right"}),s+=7,t.setFontSize(12),t.setFont("helvetica","bold"),t.text(`Destination: ${(p==null?void 0:p.name)||"N/A"}`,a,s),s+=6,t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`Sender: ${(n==null?void 0:n.senderName)||"N/A"} (${(n==null?void 0:n.senderPhone)||"N/A"})`,a,s),s+=8;const x=a,y=o-2*x,b={srNo:12,receiver:55,packageSize:40,qty:20},j=7,d=i-35;t.setFillColor(51,51,51),t.rect(x,s,y,j,"F"),t.setTextColor(255,255,255),t.setFontSize(9),t.setFont("helvetica","bold");let u=x+3;t.text("Sr.",u,s+5),u+=b.srNo,t.text("Receiver",u,s+5),u+=b.receiver,t.text("Package Size",u,s+5),u+=b.packageSize,t.text("Qty",u,s+5),u+=b.qty,t.text("Amount",u,s+5),s+=j,t.setTextColor(0,0,0),t.setFont("helvetica","normal");let W=0,U=0;(Q=n==null?void 0:n.receivers)==null||Q.forEach((M,J)=>{M.packages&&M.packages.length>0&&M.packages.forEach((X,Z)=>{s>d&&(t.addPage(),s=15),W++;const V=X.quantity*X.price;U+=V,W%2===0&&(t.setFillColor(248,248,248),t.rect(x,s,y,j,"F")),t.setDrawColor(220,220,220);const g=Z===0?j+3:j;if(t.rect(x,s,y,g,"S"),t.setFontSize(9),u=x+3,t.text(`${W}`,u,s+5),u+=b.srNo,Z===0){const S=`${M.name||"N/A"}`.substring(0,22);t.setFont("helvetica","bold"),t.text(S,u,s+4),t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text(`${M.phone||""}`,u,s+8),t.setTextColor(0,0,0),t.setFontSize(9)}u+=b.receiver,t.text(X.size||"N/A",u,s+5),u+=b.packageSize,t.text(`${X.quantity}`,u,s+5),u+=b.qty,t.text(`‚Çπ${V.toFixed(0)}`,u,s+5),s+=g})}),(n==null?void 0:n.deliveryCharge)>0&&(s>d&&(t.addPage(),s=15),W++,U+=n.deliveryCharge,t.setFillColor(255,250,240),t.rect(x,s,y,j,"F"),t.setDrawColor(220,220,220),t.rect(x,s,y,j,"S"),t.setFontSize(9),u=x+3,t.text(`${W}`,u,s+5),u+=b.srNo,t.setFont("helvetica","italic"),t.text("Delivery Charge",u,s+5),t.setFont("helvetica","normal"),u+=b.receiver+b.packageSize,t.text("1",u,s+5),u+=b.qty,t.text(`‚Çπ${n.deliveryCharge.toFixed(0)}`,u,s+5),s+=j),t.setFillColor(51,51,51),t.rect(x,s,y,j+2,"F"),t.setTextColor(255,255,255),t.setFontSize(11),t.setFont("helvetica","bold");const D=((Y=(O=n==null?void 0:n.paymentMethod)==null?void 0:O.replace("_"," "))==null?void 0:Y.toUpperCase())||"CASH";t.text(`Payment: ${D}`,x+3,s+6);const H=x+b.srNo+b.receiver+b.packageSize+b.qty+3;t.text(`TOTAL: ‚Çπ${U.toFixed(0)}`,H,s+6),s+=j+8,t.setTextColor(0,0,0),t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text("Thank you for choosing Dirba Amba Service!",o/2,s,{align:"center"}),t.setTextColor(0,0,0),s+=12;const q=45,K=o-a-q;t.setDrawColor(150,150,150),t.setLineWidth(.4),t.line(K,s,K+q,s),s+=4,t.setFontSize(8),t.setFont("helvetica","normal"),t.text("Authorized Signature",K+q/2,s,{align:"center"}),t.save(`${r}.pdf`)},z=()=>{navigator.clipboard.writeText(r),alert("Receipt number copied!")},B=()=>{k?k("dashboard"):window.location.reload()};return e.jsxs("div",{className:"text-center space-y-6 py-8",children:[f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl",children:(l==null?void 0:l.status)==="syncing"?"üîÑ":(l==null?void 0:l.status)==="failed"?"‚ö†Ô∏è":"‚è≥"}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:(l==null?void 0:l.status)==="syncing"?"Syncing Booking...":(l==null?void 0:l.status)==="failed"?"Sync Failed":"Booking Saved Locally"}),e.jsx("p",{className:"text-gray-600",children:P?(l==null?void 0:l.status)==="failed"?"Failed to sync. Will retry automatically or you can retry from the status bar.":"Your booking will be synced shortly...":"Your booking is saved and will be submitted when you're back online."}),e.jsxs("div",{className:`border rounded-lg p-6 max-w-md mx-auto ${(l==null?void 0:l.status)==="failed"?"bg-red-50 border-red-200":"bg-amber-50 border-amber-200"}`,children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Temporary Reference"}),e.jsx("p",{className:`text-2xl font-bold ${(l==null?void 0:l.status)==="failed"?"text-red-700":"text-amber-700"}`,children:r}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(l==null?void 0:l.status)==="syncing"&&"‚è≥ Syncing now...",(l==null?void 0:l.status)==="pending"&&P&&"‚è≥ Waiting to sync...",(l==null?void 0:l.status)==="pending"&&!P&&"üì¥ Will sync when online",(l==null?void 0:l.status)==="failed"&&`‚ùå ${l.error||"Sync failed"}`]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl",children:"‚úÖ"}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Booking Created Successfully!"}),e.jsx("p",{className:"text-gray-600",children:"Your transport booking has been confirmed"}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 max-w-md mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Receipt Number"}),e.jsx("p",{className:"text-3xl font-bold text-green-700",children:r}),e.jsx("button",{onClick:z,className:"mt-2 text-sm text-green-600 hover:underline",children:"üìã Copy"})]})]}),e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 max-w-md mx-auto text-left",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Route:"}),e.jsxs("span",{className:"font-medium",children:[I==null?void 0:I.name," ‚Üí ",p==null?void 0:p.name]})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Sender:"}),e.jsx("span",{className:"font-medium",children:n==null?void 0:n.senderName})]}),e.jsxs("div",{className:"flex justify-between font-bold pt-2 border-t mt-2",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:f?"text-amber-700":"text-green-700",children:["‚Çπ",v().toFixed(2)]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 max-w-md mx-auto pt-4",children:[!f&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:w,className:"flex-1 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-medium",children:"üí¨ WhatsApp"}),e.jsx("button",{onClick:_,className:"flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-medium",children:"üì• Download PDF"})]}),f&&e.jsx("div",{className:"p-3 bg-gray-100 rounded-lg text-sm text-gray-600",children:"üìã Share and PDF options will be available after sync completes"}),e.jsx("button",{onClick:F,className:"py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-medium",children:"‚ûï Create New Booking"}),e.jsx("button",{onClick:B,className:"py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",children:"üè† Go to Dashboard"})]})]})}export{Ce as default};
//# sourceMappingURL=NewBooking-C6xo5gD4.js.map
