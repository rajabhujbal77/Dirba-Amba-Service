import{r as l,j as e}from"./vendor-radix-BK0gN1wx.js";import{l as P,f as C,i as E,p as R,g as F,s as U,m as I}from"./index-lxF1Xzjf.js";import"./vendor-react-BRY8hXab.js";import"./vendor-pdf-DRk-497H.js";import"./vendor-state-B-0uGrSJ.js";function H({userRole:n}){const[d,g]=l.useState("users");return n!=="owner"?e.jsx("div",{className:"p-8",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6",children:e.jsx("p",{className:"text-red-700",children:"You don't have permission to access Settings."})})}):e.jsxs("div",{className:"p-8",children:[e.jsx("div",{className:"mb-8 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Settings"}),e.jsx("p",{className:"text-gray-600",children:"Manage system configuration and preferences"})]})}),e.jsxs("div",{className:"flex gap-2 mb-6 border-b border-gray-200 overflow-x-auto",children:[e.jsx(S,{active:d==="users",onClick:()=>g("users"),children:"User Management"}),e.jsx(S,{active:d==="depots",onClick:()=>g("depots"),children:"Depots"}),e.jsx(S,{active:d==="routes",onClick:()=>g("routes"),children:"Depot Routes"}),e.jsx(S,{active:d==="pricing",onClick:()=>g("pricing"),children:"Packages & Pricing"}),e.jsx(S,{active:d==="season",onClick:()=>g("season"),children:"Season"}),e.jsx(S,{active:d==="backup",onClick:()=>g("backup"),children:"Backup & Restore"})]}),d==="users"&&e.jsx(B,{}),d==="depots"&&e.jsx(L,{}),d==="routes"&&e.jsx(T,{}),d==="pricing"&&e.jsx(q,{}),d==="season"&&e.jsx(_,{}),d==="backup"&&e.jsx(z,{})]})}function S({active:n,onClick:d,children:g}){return e.jsx("button",{onClick:d,className:`px-6 py-3 font-medium border-b-2 transition-colors whitespace-nowrap ${n?"border-orange-500 text-orange-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:g})}function B(){const[n,d]=l.useState([]),[g,v]=l.useState([]),[j,f]=l.useState(!0),[m,p]=l.useState(!1),[i,u]=l.useState(null),[o,x]=l.useState({name:"",email:"",password:"",role:"booking_clerk",assignedDepot:"",status:"active"});l.useEffect(()=>{r()},[]);const r=async()=>{try{const[t,c]=await Promise.all([P.getAll(),C.getAll()]);d(t.users||[]),v(c.depots||[])}catch(t){console.error("Error loading data:",t)}finally{f(!1)}},h=async t=>{t.preventDefault();try{if(i){const c={...o};c.password||delete c.password,await P.update(i.id,c)}else{if(!o.password){alert("Password is required for new users");return}await P.create(o)}p(!1),u(null),x({name:"",email:"",password:"",role:"booking_clerk",assignedDepot:"",status:"active"}),r()}catch(c){console.error("Error saving user:",c),alert("Failed to save user")}},s=t=>{u(t),x({name:t.name,email:t.email,password:"",role:t.role==="owner"?"booking_clerk":t.role,assignedDepot:t.assignedDepot||"",status:t.status}),p(!0)},y=async t=>{if(confirm("Are you sure you want to delete this user?"))try{await P.delete(t),r()}catch(c){console.error("Error deleting user:",c),alert("Failed to delete user")}};return j?e.jsx("div",{className:"p-6",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-bold text-gray-900",children:"Users"}),e.jsx("button",{onClick:()=>{p(!0),u(null),x({name:"",email:"",password:"",role:"booking_clerk",assignedDepot:"",status:"active"})},className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"Add User"})]}),m&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-4",children:i?"Edit User":"New User"}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),e.jsx("input",{type:"text",value:o.name,onChange:t=>x({...o,name:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",value:o.email,onChange:t=>x({...o,email:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0,disabled:!!i})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Password ",i?"(leave blank to keep current)":"*"]}),e.jsx("input",{type:"password",value:o.password,onChange:t=>x({...o,password:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!i,placeholder:i?"Leave blank to keep current password":""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role *"}),e.jsxs("select",{value:o.role,onChange:t=>x({...o,role:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"booking_clerk",children:"Booking Clerk"}),e.jsx("option",{value:"depot_manager",children:"Depot Manager"})]})]}),o.role==="depot_manager"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned Depot *"}),e.jsxs("select",{value:o.assignedDepot,onChange:t=>x({...o,assignedDepot:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select a depot"}),g.map(t=>{var c;return e.jsxs("option",{value:t.name,children:[t.number,". ",t.name," (",(c=t.type)==null?void 0:c.replace("_"," "),")"]},t.id)})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600",children:[i?"Update":"Create"," User"]}),e.jsx("button",{type:"button",onClick:()=>{p(!1),u(null)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Assigned Depot"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[n.map(t=>{var c,N;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:t.name}),e.jsx("td",{className:"px-6 py-4",children:t.email}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs capitalize",children:(c=t.role)==null?void 0:c.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4",children:t.assignedDepot?((N=g.find(a=>a.id===t.assignedDepot))==null?void 0:N.name)||t.assignedDepot:"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s(t),className:"text-sm text-orange-600 hover:text-orange-700 font-medium",children:"Edit"}),e.jsx("button",{onClick:()=>y(t.id),className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Delete"})]})})]},t.id)}),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:'No users found. Click "Add User" to create one.'})})]})]})})]})}function L(){const[n,d]=l.useState([]),[g,v]=l.useState(!0),[j,f]=l.useState(!1),[m,p]=l.useState(null),[i,u]=l.useState({name:"",type:"origin",address:"",contactPerson:"",contactPhone:""});l.useEffect(()=>{o()},[]);const o=async()=>{try{const s=await C.getAll();d(s.depots||[])}catch(s){console.error("Error loading depots:",s)}finally{v(!1)}},x=async s=>{s.preventDefault();try{m?await C.update(m.id,i):await C.create(i),f(!1),p(null),u({name:"",type:"origin",address:"",contactPerson:"",contactPhone:""}),o()}catch(y){console.error("Error saving depot:",y),alert("Failed to save depot")}},r=s=>{p(s),u({name:s.name,type:s.type,address:s.address||"",contactPerson:s.contactPerson||"",contactPhone:s.contactPhone||""}),f(!0)},h=async s=>{if(confirm("Are you sure you want to delete this depot?"))try{await C.delete(s),o()}catch(y){console.error("Error deleting depot:",y),alert("Failed to delete depot")}};return g?e.jsx("div",{className:"p-6",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-bold text-gray-900",children:"Depots"}),e.jsx("button",{onClick:()=>{f(!0),p(null),u({name:"",type:"origin",address:"",contactPerson:"",contactPhone:""})},className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"Add Depot"})]}),j&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-4",children:m?"Edit Depot":"New Depot"}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Depot Name *"}),e.jsx("input",{type:"text",value:i.name,onChange:s=>u({...i,name:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"e.g., Devgad",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsxs("select",{value:i.type,onChange:s=>u({...i,type:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"origin",children:"Origin Depot"}),e.jsx("option",{value:"managed",children:"Managed Depot"}),e.jsx("option",{value:"direct_pickup",children:"Direct Pickup by Customer"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),e.jsx("input",{type:"text",value:i.address,onChange:s=>u({...i,address:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"Full address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Person"}),e.jsx("input",{type:"text",value:i.contactPerson,onChange:s=>u({...i,contactPerson:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Phone"}),e.jsx("input",{type:"tel",value:i.contactPhone,onChange:s=>u({...i,contactPhone:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600",children:[m?"Update":"Create"," Depot"]}),e.jsx("button",{type:"button",onClick:()=>{f(!1),p(null)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[n.map(s=>{var y;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-medium",children:s.number}),e.jsx("td",{className:"px-6 py-4 font-medium",children:s.name}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.type==="origin"?"bg-purple-100 text-purple-700":s.type==="managed"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:(y=s.type)==null?void 0:y.replace("_"," ")})}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[s.contactPerson&&e.jsx("div",{children:s.contactPerson}),s.contactPhone&&e.jsx("div",{className:"text-gray-500",children:s.contactPhone}),!s.contactPerson&&!s.contactPhone&&"-"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r(s),className:"text-sm text-orange-600 hover:text-orange-700 font-medium",children:"Edit"}),e.jsx("button",{onClick:()=>h(s.id),className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Delete"})]})})]},s.id)}),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500",children:'No depots found. Click "Add Depot" to create one.'})})]})]})})]})}function T(){const[n,d]=l.useState([]),[g,v]=l.useState([]),[j,f]=l.useState(!0),[m,p]=l.useState(!1),[i,u]=l.useState(null),[o,x]=l.useState({originDepotId:"",forwardingDepotIds:[]});l.useEffect(()=>{r()},[]);const r=async()=>{try{const[t,c]=await Promise.all([E.getAll(),C.getAll()]);d(t.routes||[]),v(c.depots||[])}catch(t){console.error("Error loading data:",t)}finally{f(!1)}},h=async t=>{t.preventDefault();try{i?await E.update(i.id,o):await E.create(o),p(!1),u(null),x({originDepotId:"",forwardingDepotIds:[]}),r()}catch(c){console.error("Error saving route:",c),alert("Failed to save route")}},s=async t=>{if(confirm("Are you sure you want to delete this route?"))try{await E.delete(t),r()}catch(c){console.error("Error deleting route:",c),alert("Failed to delete route")}},y=g.filter(t=>t.type==="managed");return j?e.jsx("div",{className:"p-6",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Info:"})," Depot Routes allow managed depots to forward packages to other depots. When configured, packages meant for forwarded depots will appear in the origin depot manager's dashboard."]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-bold text-gray-900",children:"Depot Routes"}),e.jsx("button",{onClick:()=>{p(!0),u(null),x({originDepotId:"",forwardingDepotIds:[]})},className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"Add Route"})]}),m&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-4",children:i?"Edit Route":"New Route"}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Origin Depot (Managed) *"}),e.jsxs("select",{value:o.originDepotId,onChange:t=>x({...o,originDepotId:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select a managed depot"}),y.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forwarding Depots *"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 space-y-2 max-h-64 overflow-y-auto",children:g.filter(t=>t.id!==o.originDepotId).map(t=>{var c;return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.forwardingDepotIds.includes(t.id),onChange:N=>{N.target.checked?x({...o,forwardingDepotIds:[...o.forwardingDepotIds,t.id]}):x({...o,forwardingDepotIds:o.forwardingDepotIds.filter(a=>a!==t.id)})},className:"w-4 h-4 text-orange-500 border-gray-300 rounded"}),e.jsxs("span",{className:"text-sm",children:[t.name," (",(c=t.type)==null?void 0:c.replace("_"," "),")"]})]},t.id)})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600",children:[i?"Update":"Create"," Route"]}),e.jsx("button",{type:"button",onClick:()=>{p(!1),u(null)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[n.map(t=>{const c=g.find(a=>a.id===t.originDepotId),N=g.filter(a=>{var b;return(b=t.forwardingDepotIds)==null?void 0:b.includes(a.id)});return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900",children:(c==null?void 0:c.name)||"Unknown"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Origin Depot"})]}),e.jsx("button",{onClick:()=>s(t.id),className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Delete"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Forwards to:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(a=>e.jsx("span",{className:"px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm",children:a.name},a.id))})]})]},t.id)}),n.length===0&&e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:'No depot routes configured. Click "Add Route" to create one.'})})]})]})}function q(){const[n,d]=l.useState([]),[g,v]=l.useState([]),[j,f]=l.useState([]),[m,p]=l.useState(!0),[i,u]=l.useState(!1),[o,x]=l.useState(null),[r,h]=l.useState({name:"",basePrice:0});l.useEffect(()=>{s()},[]);const s=async()=>{try{const[a,b,k]=await Promise.all([R.getAll(),C.getAll(),F.getAll()]);d(a.packages||[]),v(b.depots||[]),f(k.pricing||[])}catch(a){console.error("Error loading data:",a)}finally{p(!1)}},y=async a=>{a.preventDefault();try{o?await R.update(o.id,r):await R.create(r),u(!1),x(null),h({name:"",basePrice:0}),s()}catch(b){console.error("Error saving package:",b),alert("Failed to save package")}},t=async a=>{if(confirm("Are you sure you want to delete this package?"))try{await R.delete(a),s()}catch(b){console.error("Error deleting package:",b),alert("Failed to delete package")}},c=async(a,b,k)=>{const D=parseFloat(k);if(!isNaN(D))try{await F.update(a,b,D),s()}catch(w){console.error("Error updating price:",w),alert("Failed to update price")}},N=(a,b)=>{const k=j.find(w=>w.packageId===a&&w.depotId===b);if(k)return k.price;const D=n.find(w=>w.id===a);return(D==null?void 0:D.basePrice)||0};return m?e.jsx("div",{className:"p-6",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-bold text-gray-900",children:"Packages & Pricing"}),e.jsx("button",{onClick:()=>{u(!0),x(null),h({name:"",basePrice:0})},className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"Add Package Size"})]}),i&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-4",children:o?"Edit Package":"New Package"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Package Size Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:a=>h({...r,name:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"e.g., 1 Dz",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Base Price (‚Çπ) *"}),e.jsx("input",{type:"number",value:r.basePrice,onChange:a=>h({...r,basePrice:Number(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"e.g., 50",required:!0})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600",children:[o?"Update":"Create"," Package"]}),e.jsx("button",{type:"button",onClick:()=>{u(!1),x(null)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",style:{width:0,minWidth:"100%"},children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:"Pricing Overview"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Base prices can be overridden per depot. Use horizontal scroll to view all depots."})]}),e.jsx("div",{style:{overflowX:"auto",maxHeight:"70vh",border:"2px solid #e5e7eb",borderRadius:"8px",backgroundColor:"white"},children:e.jsxs("table",{className:"w-full text-sm",style:{minWidth:"1200px"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:40},children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase",style:{position:"sticky",left:0,zIndex:30,backgroundColor:"#f3f4f6",minWidth:"180px",borderRight:"2px solid #e5e7eb"},children:"Package Size"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase",style:{position:"sticky",left:"180px",zIndex:30,backgroundColor:"#f3f4f6",minWidth:"130px",borderRight:"2px solid #e5e7eb"},children:"Base Price"}),g.filter(a=>!["Devgad","Shirgaon"].includes(a.name)).map(a=>{var b;return e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase whitespace-nowrap",style:{minWidth:"130px"},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a.name}),e.jsx("span",{className:"text-[10px] text-gray-500 font-normal lowercase",children:(b=a.type)==null?void 0:b.replace("_"," ")})]})},a.id)}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase",style:{minWidth:"130px"},children:"Actions"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[n.map(a=>e.jsxs("tr",{className:"hover:bg-amber-50 transition-colors border-b border-gray-200",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",style:{position:"sticky",left:0,zIndex:20,backgroundColor:"white",minWidth:"180px",borderRight:"2px solid #e5e7eb"},children:a.name}),e.jsxs("td",{className:"px-6 py-4 font-bold text-orange-600",style:{position:"sticky",left:"180px",zIndex:20,backgroundColor:"white",minWidth:"130px",borderRight:"2px solid #e5e7eb"},children:["‚Çπ",a.basePrice]}),g.filter(b=>!["Devgad","Shirgaon"].includes(b.name)).map(b=>{const k=N(a.id,b.id),D=j.some(w=>w.packageId===a.id&&w.depotId===b.id);return e.jsxs("td",{className:"px-6 py-4 border-r border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 text-xs",children:"‚Çπ"}),e.jsx("input",{type:"number",defaultValue:k,onBlur:w=>{const A=w.target.value;A&&parseFloat(A)!==k&&c(a.id,b.id,A)},className:`w-20 px-2 py-1 border rounded text-sm transition-all focus:ring-2 focus:ring-orange-500 focus:border-transparent ${D?"border-orange-500 bg-orange-50 text-orange-900 font-medium":"border-gray-200 text-gray-600 bg-gray-50 hover:bg-white hover:border-gray-300"}`,placeholder:String(a.basePrice)})]}),D&&e.jsx("span",{className:"text-[10px] text-orange-600 block mt-1 font-medium",children:"Custom Price"})]},b.id)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{x(a),h({name:a.name,basePrice:a.basePrice}),u(!0)},className:"text-xs font-medium text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 px-3 py-1.5 rounded transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>t(a.id),className:"text-xs font-medium text-red-600 hover:text-red-800 bg-red-50 hover:bg-red-100 px-3 py-1.5 rounded transition-colors",children:"Delete"})]})})]},a.id)),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:g.length+3,className:"px-6 py-12 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-4xl mb-4",children:"üì¶"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"No packages found"}),e.jsx("p",{className:"text-sm",children:'Click "Add Package Size" above to create your first package.'})]})})})]})]})})]})]})}function _(){const[n,d]=l.useState({startDate:"",endDate:"",year:new Date().getFullYear()}),[g,v]=l.useState(!0),[j,f]=l.useState(!1),[m,p]=l.useState(!1);l.useEffect(()=>{i()},[]);const i=async()=>{try{const r=await U.get();r.season&&Object.keys(r.season).length>0&&d(r.season)}catch(r){console.error("Error loading season:",r)}finally{v(!1)}},u=async r=>{r.preventDefault(),f(!0);try{await U.update(n),await i(),p(!1),alert("Season updated successfully!")}catch(h){console.error("Error updating season:",h),alert("Failed to update season")}finally{f(!1)}},o=()=>{if(!n.startDate||!n.endDate)return!1;const r=new Date;r.setHours(0,0,0,0);const h=new Date(n.startDate+"T00:00:00"),s=new Date(n.endDate+"T23:59:59");return isNaN(h.getTime())||isNaN(s.getTime())?(console.error("Invalid season dates:",{startDate:n.startDate,endDate:n.endDate}),!1):r>=h&&r<=s},x=r=>r?new Date(r+"T00:00:00").toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric"}):"";return g?e.jsx("div",{className:"p-6",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`rounded-xl border p-6 ${o()?"bg-green-50 border-green-200":"bg-orange-50 border-orange-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-2xl",children:o()?"ü•≠":"‚è∞"}),e.jsxs("h3",{className:"font-bold text-gray-900",children:["Season Status: ",o()?"Active":"Inactive"]})]}),e.jsx("p",{className:"text-sm text-gray-700",children:o()?`The mango season is currently active. Bookings and trips can be created.${n.startDate&&n.endDate?` Current season is from ${x(n.startDate)} to ${x(n.endDate)}.`:""}`:`The season is currently inactive. No bookings or trips can be created outside the season dates.${n.startDate&&n.endDate?` Season dates: ${x(n.startDate)} to ${x(n.endDate)}.`:""}`}),!m&&e.jsx("button",{onClick:()=>p(!0),className:"mt-4 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors font-medium text-sm",children:"Edit Season"})]}),m&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 max-w-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"font-bold text-gray-900",children:"Season Configuration"}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-500 hover:text-gray-700",children:"‚úï"})]}),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Season Year *"}),e.jsx("input",{type:"number",value:n.year,onChange:r=>d({...n,year:Number(r.target.value)}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date *"}),e.jsx("input",{type:"date",value:n.startDate,onChange:r=>d({...n,startDate:r.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date *"}),e.jsx("input",{type:"date",value:n.endDate,onChange:r=>d({...n,endDate:r.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Warning:"})," After the end date, no new bookings or trips can be created until the next season is configured."]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:j,className:"px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors font-medium disabled:opacity-50",children:j?"Saving...":"Update Season"}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Cancel"})]})]})]})]})}function z(){const[n,d]=l.useState(!1),[g,v]=l.useState(!1),[j,f]=l.useState(null),[m,p]=l.useState(null),i=async()=>{d(!0);try{const h=(await I.create()).backup,s=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),y=URL.createObjectURL(s),t=document.createElement("a");t.href=y,t.download=`mango-transport-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(y),alert("Backup created and downloaded successfully!")}catch(r){console.error("Error creating backup:",r),alert("Failed to create backup. Check console for details.")}finally{d(!1)}},u=r=>{var y;const h=(y=r.target.files)==null?void 0:y[0];if(!h)return;const s=new FileReader;s.onload=t=>{var c;try{const N=JSON.parse((c=t.target)==null?void 0:c.result);f(N);const a=I.getPreview(N);p(a)}catch(N){console.error("Error parsing backup file:",N),alert("Invalid backup file format"),f(null),p(null)}},s.readAsText(h)},o=async()=>{if(!j){alert("Please select a backup file first");return}if(confirm(`‚ö†Ô∏è WARNING: This will DELETE all current data and replace it with the backup data.

Are you absolutely sure you want to proceed?`)&&confirm("Final confirmation: Type OK in the next prompt to proceed with restore.")){v(!0);try{await I.restore(j.data),alert("‚úÖ Data restored successfully! The page will now refresh."),f(null),p(null),window.location.reload()}catch(r){console.error("Error restoring backup:",r),alert("‚ùå Failed to restore backup. Check console for details.")}finally{v(!1)}}},x=()=>{f(null),p(null)};return e.jsxs("div",{className:"space-y-6 max-w-3xl",children:[e.jsx("h2",{className:"font-bold text-gray-900",children:"Backup & Restore"}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-8",children:e.jsx("div",{className:"flex items-start gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"üì• Create Backup"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Download a complete backup of all system data including bookings, trips, receivers, packages, users, depots, contacts, credit data, and settings."}),e.jsx("button",{onClick:i,disabled:n,className:"px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors font-medium disabled:opacity-50",children:n?"‚è≥ Creating Backup...":"üíæ Download Backup"})]})})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-8",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"üì§ Restore Backup"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Upload a backup file to restore all data. ",e.jsx("strong",{className:"text-red-600",children:"This will delete all current data!"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Choose backup file"}),e.jsx("input",{type:"file",accept:".json",onChange:u,className:`block w-full text-sm text-gray-500\r
                    file:mr-4 file:py-2 file:px-4\r
                    file:rounded-lg file:border-0\r
                    file:bg-orange-50 file:text-orange-700\r
                    hover:file:bg-orange-100\r
                    file:cursor-pointer cursor-pointer`})]})}),m&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"üìã Backup Preview"}),e.jsxs("p",{className:"text-xs text-blue-700",children:["Version: ",m.version," ‚Ä¢ Created: ",new Date(m.timestamp).toLocaleString("en-IN")]})]}),e.jsx("button",{onClick:x,className:"text-blue-600 hover:text-blue-800 text-sm",children:"‚úï Clear"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"bg-white rounded p-2",children:[e.jsx("span",{className:"text-gray-500",children:"Bookings:"}),e.jsx("span",{className:"font-bold text-gray-900 ml-1",children:m.counts.bookings})]}),e.jsxs("div",{className:"bg-white rounded p-2",children:[e.jsx("span",{className:"text-gray-500",children:"Trips:"}),e.jsx("span",{className:"font-bold text-gray-900 ml-1",children:m.counts.trips})]}),e.jsxs("div",{className:"bg-white rounded p-2",children:[e.jsx("span",{className:"text-gray-500",children:"Receivers:"}),e.jsx("span",{className:"font-bold text-gray-900 ml-1",children:m.counts.receivers})]}),e.jsxs("div",{className:"bg-white rounded p-2",children:[e.jsx("span",{className:"text-gray-500",children:"Packages:"}),e.jsx("span",{className:"font-bold text-gray-900 ml-1",children:m.counts.packages})]}),e.jsxs("div",{className:"bg-white rounded p-2",children:[e.jsx("span",{className:"text-gray-500",children:"Contacts:"}),e.jsx("span",{className:"font-bold text-gray-900 ml-1",children:m.counts.contacts})]}),e.jsxs("div",{className:"bg-white rounded p-2",children:[e.jsx("span",{className:"text-gray-500",children:"Credit Customers:"}),e.jsx("span",{className:"font-bold text-gray-900 ml-1",children:m.counts.credit_customers})]})]})]}),e.jsx("button",{onClick:o,disabled:g||!j,className:"px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors font-medium disabled:opacity-50",children:g?"‚è≥ Restoring...":"‚ö†Ô∏è Restore Backup"})]})]})}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"‚ö†Ô∏è Critical Warning:"})," Restoring a backup will ",e.jsx("strong",{children:"permanently delete"})," all current bookings, trips, receivers, and packages, replacing them with data from the backup file. Always create a fresh backup before restoring!"]})}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"‚ÑπÔ∏è Note:"})," Depots, Package Sizes, and User accounts are not overwritten during restore to preserve your system configuration."]})})]})}export{H as default};
//# sourceMappingURL=Settings-DYf4YIfE.js.map
