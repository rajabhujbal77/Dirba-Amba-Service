import{r as d,j as t}from"./vendor-radix-BK0gN1wx.js";import{b as z,t as G}from"./index-DzBcAM1U.js";import"./vendor-react-BRY8hXab.js";import"./vendor-pdf-DRk-497H.js";import"./vendor-state-B-0uGrSJ.js";function Y({userRole:c,assignedDepotId:r}){const[B,u]=d.useState([{label:"Today's Bookings",value:"0",icon:"ðŸ“"},{label:"Today's Revenue",value:"â‚¹0",icon:"ðŸ’µ"},{label:"Total Revenue",value:"â‚¹0",icon:"ðŸ’°"},{label:"Total Trips",value:"0",icon:"ðŸšš"}]),[N,$]=d.useState([]),[_,A]=d.useState([]),[L,R]=d.useState(!0);d.useEffect(()=>{D()},[]);const D=async()=>{try{const[a,o]=await Promise.all([z.getAll(),G.getAll()]),f=a.bookings||[],g=o.trips||[],n=c==="depot_manager"&&r?f.filter(e=>(e.destination_depot_id===r||e.origin_depot_id===r)&&e.status!=="booked"):f,j=c==="depot_manager"&&r?g.filter(e=>e.origin_depot_id===r||e.destination_depot_id===r):g,T=new Date;T.setHours(0,0,0,0);const k=T.getTime(),m=n.filter(e=>{const s=new Date(e.created_at);return s.setHours(0,0,0,0),s.getTime()===k}),P=m.length,S=j.length,q=j.filter(e=>e.status==="in_transit"||e.status==="loading").length,w=n.filter(e=>e.status!=="delivered").length,x=m.reduce((e,s)=>e+(Number(s.total_amount)||0),0),C=x>1e5?`â‚¹${(x/1e5).toFixed(1)}L`:`â‚¹${x.toLocaleString("en-IN")}`,y=n.reduce((e,s)=>e+(Number(s.total_amount)||0),0),E=y>1e5?`â‚¹${(y/1e5).toFixed(1)}L`:`â‚¹${y.toLocaleString("en-IN")}`,H=n.filter(e=>e.payment_method==="to_pay"&&e.status!=="delivered").reduce((e,s)=>e+(Number(s.total_amount)||0),0),F=m.filter(e=>e.payment_method==="to_pay"&&e.status!=="delivered").reduce((e,s)=>e+(Number(s.total_amount)||0),0),I=n.filter(e=>e.payment_method==="to_pay"&&e.status==="delivered").reduce((e,s)=>e+(Number(s.total_amount)||0),0),O=n.filter(e=>{if(e.payment_method!=="to_pay"||!e.to_pay_collected_at)return!1;const s=new Date(e.to_pay_collected_at);return s.setHours(0,0,0,0),s.getTime()===k}).reduce((e,s)=>e+(Number(s.total_amount)||0),0),W=m.reduce((e,s)=>{var i;return e+(((i=s.receivers)==null?void 0:i.reduce((p,v)=>{var l;return p+(((l=v.packages)==null?void 0:l.reduce((h,b)=>h+(b.quantity||0),0))||0)},0))||0)},0);u(c==="booking_clerk"?[{label:"Today's Bookings",value:String(P),icon:"ðŸ“"},{label:"Active Trips",value:String(q),icon:"ðŸšš"},{label:"Pending Deliveries",value:String(w),icon:"ðŸ“¦"},{label:"Total Trips",value:String(S),icon:"ðŸš›"}]:c==="depot_manager"?[{label:"Today's Packages",value:String(W),icon:"ðŸ“¦"},{label:"Pending To-Pay",value:`Today: â‚¹${F.toLocaleString("en-IN")}
Total: â‚¹${H.toLocaleString("en-IN")}`,icon:"ðŸ’µ"},{label:"To-Pay Collected",value:`Today: â‚¹${O.toLocaleString("en-IN")}
Total: â‚¹${I.toLocaleString("en-IN")}`,icon:"ðŸ’°"},{label:"Pending Deliveries",value:String(w),icon:"ðŸšš"}]:[{label:"Today's Bookings",value:String(P),icon:"ðŸ“"},{label:"Today's Revenue",value:C,icon:"ðŸ’µ"},{label:"Total Revenue",value:E,icon:"ðŸ’°"},{label:"Total Trips",value:String(S),icon:"ðŸšš"}]),$(n.slice(0,5).map(e=>{var i;const s=((i=e.receivers)==null?void 0:i.reduce((p,v)=>{var l;return p+(((l=v.packages)==null?void 0:l.reduce((h,b)=>h+(b.quantity||0),0))||0)},0))||0;return{id:e.id||e.receipt_number,customer:e.sender_name||e.customer_name||"N/A",origin:e.origin_depot_name||e.origin_location||"N/A",destination:e.destination_depot_name||e.destination_location||"N/A",quantity:s>0?`${s} pkg`:e.quantity||"0",status:e.status,total:e.total_amount||0}})),A(g.filter(e=>e.status!=="completed"&&e.status!=="cancelled").slice(0,5).map(e=>{var s,i;return{id:e.id,route:`${((s=e.origin_depot)==null?void 0:s.name)||"Origin"} â†’ ${((i=e.destination_depot)==null?void 0:i.name)||"Dest"}`,driver:e.driver_name,vehicle:e.vehicle_number,status:e.status,bookings:0}}))}catch(a){console.error("Error loading dashboard data:",a)}finally{R(!1)}};return L?t.jsx("div",{className:"p-8",children:"Loading dashboard..."}):t.jsxs("div",{className:"p-8",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Dashboard"}),t.jsx("p",{className:"text-gray-600",children:"Welcome back! Here's your logistics overview."})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:B.map((a,o)=>t.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsx("span",{className:"text-2xl",children:a.icon})}),t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:a.label}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 whitespace-pre-line",children:a.value})]},o))}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsx("h2",{className:"font-bold text-gray-900",children:"Recent Bookings"})}),t.jsx("div",{className:"divide-y divide-gray-200",children:N.length===0?t.jsx("div",{className:"p-6 text-gray-500 text-center",children:"No bookings found."}):N.map(a=>{var o;return t.jsxs("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:a.customer}),t.jsx("p",{className:"text-sm text-gray-600",children:a.id})]}),t.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a.status==="booked"?"bg-blue-100 text-blue-700":a.status==="delivered"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:(o=a.status)==null?void 0:o.replace("_"," ")})]}),t.jsxs("p",{className:"text-sm text-gray-600",children:[a.origin," â†’ ",a.destination," â€¢ ",a.quantity]})]},a.id)})})]}),t.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsx("h2",{className:"font-bold text-gray-900",children:"Active Trips"})}),t.jsx("div",{className:"divide-y divide-gray-200",children:_.length===0?t.jsx("div",{className:"p-6 text-gray-500 text-center",children:"No active trips."}):_.map(a=>{var o;return t.jsxs("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:a.route}),t.jsx("p",{className:"text-sm text-gray-600",children:a.id})]}),t.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a.status==="in_transit"?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"}`,children:(o=a.status)==null?void 0:o.replace("_"," ")})]}),t.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Driver: ",a.driver]}),t.jsx("p",{className:"text-sm text-gray-600",children:a.vehicle})]},a.id)})})]})]})]})}export{Y as default};
//# sourceMappingURL=Dashboard-lU2ozLy9.js.map
