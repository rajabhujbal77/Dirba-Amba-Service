{"version":3,"mappings":"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","names":["CreditLedger","assignedDepotId","searchTerm","setSearchTerm","useState","selectedCustomer","setSelectedCustomer","activeTab","setActiveTab","creditAccounts","setCreditAccounts","isLoading","setIsLoading","totals","setTotals","showPaymentModal","setShowPaymentModal","paymentAmount","setPaymentAmount","paymentMethod","setPaymentMethod","paymentNotes","setPaymentNotes","isProcessing","setIsProcessing","packages","setPackages","depots","setDepots","standardPricing","setStandardPricing","customerPricing","setCustomerPricing","editingPrices","setEditingPrices","isSavingPrices","setIsSavingPrices","discountSummary","setDiscountSummary","isEditingName","setIsEditingName","editedName","setEditedName","useEffect","loadCreditData","loadPricingData","accounts","totalCredit","totalAdvancePaid","totalNetOutstanding","creditApi","error","packagesRes","depotsRes","pricingRes","packagesApi","depotsApi","depotPricingApi","loadCustomerPricing","phone","pricing","editMap","p","summary","getSelectedAccount","a","handleRecordPayment","amount","account","payment","generatePaymentReceipt","handleSaveDisplayName","handlePriceChange","packageId","depotId","value","key","numValue","prev","newPrices","handleSavePricing","price","getStandardPrice","depotPrice","pkg","exportCustomerLedgerCSV","rows","b","csvContent","row","cell","BOM","blob","link","jsPDF","__vitePreload","n","doc","pageWidth","y","newAdvance","netOutstanding","_a","_b","filteredAccounts","selectedAccount","customerDepots","relevantDepots","d","jsx","jsxs","e","tab","_c","_d","_e","_f","Fragment","depot","standardPrice","currentValue","hasDiscount","_g","_h"],"ignoreList":[],"sources":["../../src/app/components/CreditLedger.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { creditApi, packagesApi, depotsApi, depotPricingApi } from '../utils/api';\r\n// jsPDF is dynamically imported when needed to reduce bundle size\r\n\r\ninterface CreditLedgerProps {\r\n  assignedDepotId?: string | null;\r\n}\r\n\r\nexport default function CreditLedger({ assignedDepotId }: CreditLedgerProps) {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedCustomer, setSelectedCustomer] = useState<string | null>(null);\r\n  const [activeTab, setActiveTab] = useState<'bookings' | 'payments' | 'pricing' | 'settlement'>('bookings');\r\n  const [creditAccounts, setCreditAccounts] = useState<any[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [totals, setTotals] = useState({ totalCredit: 0, totalAdvancePaid: 0, totalNetOutstanding: 0 });\r\n  const [showPaymentModal, setShowPaymentModal] = useState(false);\r\n  const [paymentAmount, setPaymentAmount] = useState('');\r\n  const [paymentMethod, setPaymentMethod] = useState('cash');\r\n  const [paymentNotes, setPaymentNotes] = useState('');\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n\r\n  // Pricing state\r\n  const [packages, setPackages] = useState<any[]>([]);\r\n  const [depots, setDepots] = useState<any[]>([]);\r\n  const [standardPricing, setStandardPricing] = useState<any[]>([]);\r\n  const [customerPricing, setCustomerPricing] = useState<any[]>([]);\r\n  const [editingPrices, setEditingPrices] = useState<Record<string, number>>({});\r\n  const [isSavingPrices, setIsSavingPrices] = useState(false);\r\n  const [discountSummary, setDiscountSummary] = useState<any>(null);\r\n\r\n  // Display name editing\r\n  const [isEditingName, setIsEditingName] = useState(false);\r\n  const [editedName, setEditedName] = useState('');\r\n\r\n  useEffect(() => {\r\n    loadCreditData();\r\n    loadPricingData();\r\n  }, []);\r\n\r\n  const loadCreditData = async () => {\r\n    try {\r\n      const { accounts, totalCredit, totalAdvancePaid, totalNetOutstanding } = await creditApi.getCreditSummary(assignedDepotId);\r\n      setCreditAccounts(accounts);\r\n      setTotals({ totalCredit, totalAdvancePaid, totalNetOutstanding });\r\n    } catch (error) {\r\n      console.error('Error loading credit data:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadPricingData = async () => {\r\n    try {\r\n      const [packagesRes, depotsRes, pricingRes] = await Promise.all([\r\n        packagesApi.getAll(),\r\n        depotsApi.getAll(),\r\n        depotPricingApi.getAll()\r\n      ]);\r\n      setPackages(packagesRes.packages || []);\r\n      setDepots(depotsRes.depots || []);\r\n      setStandardPricing(pricingRes.pricing || []);\r\n    } catch (error) {\r\n      console.error('Error loading pricing data:', error);\r\n    }\r\n  };\r\n\r\n  const loadCustomerPricing = async (phone: string) => {\r\n    try {\r\n      const { pricing } = await creditApi.getCustomerPricing(phone);\r\n      setCustomerPricing(pricing);\r\n\r\n      // Initialize editing prices\r\n      const editMap: Record<string, number> = {};\r\n      pricing.forEach((p: any) => {\r\n        editMap[`${p.packageId}_${p.depotId}`] = p.discountedPrice;\r\n      });\r\n      setEditingPrices(editMap);\r\n\r\n      // Load discount summary\r\n      const summary = await creditApi.getDiscountSummary(phone);\r\n      setDiscountSummary(summary);\r\n    } catch (error) {\r\n      console.error('Error loading customer pricing:', error);\r\n      setCustomerPricing([]);\r\n      setEditingPrices({});\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (selectedCustomer) {\r\n      loadCustomerPricing(selectedCustomer);\r\n    }\r\n  }, [selectedCustomer]);\r\n\r\n  const getSelectedAccount = () => {\r\n    return creditAccounts.find(a => a.id === selectedCustomer);\r\n  };\r\n\r\n  const handleRecordPayment = async () => {\r\n    const amount = parseFloat(paymentAmount);\r\n    if (!amount || amount <= 0) {\r\n      alert('Please enter a valid payment amount');\r\n      return;\r\n    }\r\n\r\n    const account = getSelectedAccount();\r\n    if (!account) return;\r\n\r\n    setIsProcessing(true);\r\n    try {\r\n      const { payment } = await creditApi.recordPayment({\r\n        customer_name: account.customer,\r\n        customer_phone: account.phone,\r\n        amount: amount,\r\n        payment_method: paymentMethod,\r\n        notes: paymentNotes\r\n      });\r\n\r\n      generatePaymentReceipt(payment, account);\r\n      alert(`Payment of ‚Çπ${amount.toLocaleString('en-IN')} recorded! Receipt: ${payment.receipt_number}`);\r\n      setShowPaymentModal(false);\r\n      setPaymentAmount('');\r\n      setPaymentNotes('');\r\n      setIsLoading(true);\r\n      await loadCreditData();\r\n    } catch (error) {\r\n      console.error('Error recording payment:', error);\r\n      alert('Failed to record payment. Please try again.');\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  const handleSaveDisplayName = async () => {\r\n    if (!selectedCustomer || !editedName.trim()) return;\r\n    try {\r\n      await creditApi.updateCustomerDisplayName(selectedCustomer, editedName.trim());\r\n      await loadCreditData();\r\n      setIsEditingName(false);\r\n    } catch (error) {\r\n      console.error('Error updating name:', error);\r\n      alert('Failed to update name. Please try again.');\r\n    }\r\n  };\r\n\r\n  const handlePriceChange = (packageId: string, depotId: string, value: string) => {\r\n    const key = `${packageId}_${depotId}`;\r\n    const numValue = parseFloat(value);\r\n    if (!isNaN(numValue) && numValue >= 0) {\r\n      setEditingPrices(prev => ({ ...prev, [key]: numValue }));\r\n    } else if (value === '') {\r\n      const newPrices = { ...editingPrices };\r\n      delete newPrices[key];\r\n      setEditingPrices(newPrices);\r\n    }\r\n  };\r\n\r\n  const handleSavePricing = async () => {\r\n    if (!selectedCustomer) return;\r\n    setIsSavingPrices(true);\r\n    try {\r\n      const pricing = Object.entries(editingPrices).map(([key, price]) => {\r\n        const [packageId, depotId] = key.split('_');\r\n        return { packageId, depotId, discountedPrice: price };\r\n      });\r\n      await creditApi.setCustomerPricing(selectedCustomer, pricing);\r\n      await loadCustomerPricing(selectedCustomer);\r\n      alert('Pricing saved successfully!');\r\n    } catch (error) {\r\n      console.error('Error saving pricing:', error);\r\n      alert('Failed to save pricing. Make sure the database tables are created.');\r\n    } finally {\r\n      setIsSavingPrices(false);\r\n    }\r\n  };\r\n\r\n  const getStandardPrice = (packageId: string, depotId: string) => {\r\n    const depotPrice = standardPricing.find(p => p.packageId === packageId && p.depotId === depotId);\r\n    if (depotPrice) return depotPrice.price;\r\n    const pkg = packages.find(p => p.id === packageId);\r\n    return pkg?.basePrice || 0;\r\n  };\r\n\r\n  // Export customer ledger as CSV\r\n  const exportCustomerLedgerCSV = () => {\r\n    const account = getSelectedAccount();\r\n    if (!account) return;\r\n\r\n    // Build CSV rows\r\n    const rows: string[][] = [];\r\n\r\n    // Header info\r\n    rows.push(['CREDIT LEDGER STATEMENT']);\r\n    rows.push(['Customer', account.customer]);\r\n    rows.push(['Phone', account.phone]);\r\n    rows.push(['Generated', new Date().toLocaleString('en-IN')]);\r\n    rows.push([]);\r\n\r\n    // Summary\r\n    rows.push(['SUMMARY']);\r\n    rows.push(['Total Credit', account.totalCredit]);\r\n    rows.push(['Advance Paid', account.advancePaid]);\r\n    rows.push(['Net Outstanding', account.netOutstanding]);\r\n    rows.push([]);\r\n\r\n    // Bookings\r\n    rows.push(['BOOKINGS']);\r\n    rows.push(['Date', 'Receipt No', 'Destination', 'Amount']);\r\n    (account.bookings || []).forEach((b: any) => {\r\n      rows.push([\r\n        new Date(b.date).toLocaleDateString('en-IN'),\r\n        b.receiptNumber || b.id,\r\n        b.destination,\r\n        b.amount\r\n      ]);\r\n    });\r\n    rows.push([]);\r\n\r\n    // Payments\r\n    rows.push(['ADVANCE PAYMENTS']);\r\n    rows.push(['Date', 'Receipt No', 'Method', 'Amount']);\r\n    (account.payments || []).forEach((p: any) => {\r\n      rows.push([\r\n        new Date(p.date).toLocaleDateString('en-IN'),\r\n        p.receiptNumber || '-',\r\n        p.method || 'cash',\r\n        p.amount\r\n      ]);\r\n    });\r\n\r\n    // Convert to CSV string with UTF-8 BOM for Excel compatibility\r\n    const csvContent = rows.map(row =>\r\n      row.map(cell => `\"${String(cell || '').replace(/\"/g, '\"\"')}\"`).join(',')\r\n    ).join('\\n');\r\n\r\n    // Add UTF-8 BOM for Excel to recognize encoding\r\n    const BOM = '\\uFEFF';\r\n    const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });\r\n    const link = document.createElement('a');\r\n    link.href = URL.createObjectURL(blob);\r\n    link.download = `Credit_Ledger_${account.customer.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;\r\n    link.click();\r\n  };\r\n\r\n  const generatePaymentReceipt = async (payment: any, account: any) => {\r\n    // Dynamically import jsPDF to reduce bundle size\r\n    const { jsPDF } = await import('jspdf');\r\n    const doc = new jsPDF();\r\n    const pageWidth = doc.internal.pageSize.getWidth();\r\n    let y = 20;\r\n\r\n    doc.setFontSize(20);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setTextColor(247, 137, 30);\r\n    doc.text('DIRBA AMBA SERVICE', pageWidth / 2, y, { align: 'center' });\r\n    y += 10;\r\n    doc.setFontSize(14);\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.text('ADVANCE PAYMENT RECEIPT', pageWidth / 2, y, { align: 'center' });\r\n    y += 15;\r\n\r\n    doc.setFontSize(11);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Receipt No: ${payment.receipt_number}`, 15, y);\r\n    y += 8;\r\n    doc.text(`Date: ${new Date(payment.payment_date).toLocaleDateString('en-IN')}`, 15, y);\r\n    y += 12;\r\n\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(`Customer: ${account.customer}`, 15, y);\r\n    doc.setFont('helvetica', 'normal');\r\n    y += 6;\r\n    doc.text(`Phone: ${account.phone}`, 15, y);\r\n    y += 12;\r\n\r\n    doc.setFillColor(254, 243, 199);\r\n    doc.roundedRect(15, y, pageWidth - 30, 45, 3, 3, 'F');\r\n    y += 10;\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('Credit Summary', pageWidth / 2, y, { align: 'center' });\r\n    y += 10;\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Total Credit:`, 25, y);\r\n    doc.text(`‚Çπ${account.totalCredit.toLocaleString('en-IN')}`, pageWidth - 25, y, { align: 'right' });\r\n    y += 8;\r\n    doc.text(`Advance Paid (including this):`, 25, y);\r\n    const newAdvance = account.advancePaid + Number(payment.amount);\r\n    doc.text(`‚Çπ${newAdvance.toLocaleString('en-IN')}`, pageWidth - 25, y, { align: 'right' });\r\n    y += 8;\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setTextColor(220, 38, 38);\r\n    doc.text(`Net Outstanding:`, 25, y);\r\n    const netOutstanding = Math.max(0, account.totalCredit - newAdvance);\r\n    doc.text(`‚Çπ${netOutstanding.toLocaleString('en-IN')}`, pageWidth - 25, y, { align: 'right' });\r\n    y += 15;\r\n\r\n    doc.setTextColor(22, 163, 74);\r\n    doc.setFontSize(14);\r\n    doc.text(`THIS PAYMENT: ‚Çπ${Number(payment.amount).toLocaleString('en-IN')}`, pageWidth / 2, y, { align: 'center' });\r\n\r\n    doc.save(`${payment.receipt_number}.pdf`);\r\n  };\r\n\r\n  // Build transactions from selected account\r\n  const transactions = selectedCustomer\r\n    ? [\r\n      ...(getSelectedAccount()?.bookings || []).map((b: any) => ({\r\n        id: b.id, type: 'debit', amount: b.amount,\r\n        description: `Booking ${b.receiptNumber || b.id}`,\r\n        date: b.date, destination: b.destination\r\n      })),\r\n      ...(getSelectedAccount()?.payments || []).map((p: any) => ({\r\n        id: p.id, type: 'credit', amount: p.amount,\r\n        description: `Payment ${p.receiptNumber || ''}`,\r\n        date: p.date, method: p.method\r\n      }))\r\n    ].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\r\n    : [];\r\n\r\n  const filteredAccounts = creditAccounts.filter(account =>\r\n    (account.customer || '').toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    (account.id || '').toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    (account.phone || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n  );\r\n\r\n  const selectedAccount = getSelectedAccount();\r\n  const customerDepots = selectedAccount?.depots || [];\r\n  const relevantDepots = depots.filter(d => customerDepots.includes(d.id));\r\n\r\n  if (isLoading) return <div className=\"p-4 md:p-8\">Loading credit data...</div>;\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-8\">\r\n      <div className=\"mb-6 md:mb-8\">\r\n        <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900 mb-2\">Credit Ledger</h1>\r\n        <p className=\"text-gray-600 text-sm md:text-base\">Manage customer credit accounts, pricing, and payments</p>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6\">\r\n        <div className=\"bg-white rounded-xl p-4 md:p-6 border border-gray-200\">\r\n          <p className=\"text-sm text-gray-600 mb-1\">Total Credit Issued</p>\r\n          <p className=\"text-xl md:text-2xl font-bold text-gray-900\">‚Çπ{(totals.totalCredit / 100000).toFixed(2)}L</p>\r\n        </div>\r\n        <div className=\"bg-white rounded-xl p-4 md:p-6 border border-gray-200\">\r\n          <p className=\"text-sm text-gray-600 mb-1\">Advance Paid</p>\r\n          <p className=\"text-xl md:text-2xl font-bold text-green-600\">\r\n            ‚Çπ{totals.totalAdvancePaid >= 100000 ? (totals.totalAdvancePaid / 100000).toFixed(2) + 'L' : totals.totalAdvancePaid.toLocaleString('en-IN')}\r\n          </p>\r\n        </div>\r\n        <div className=\"bg-white rounded-xl p-4 md:p-6 border border-gray-200\">\r\n          <p className=\"text-sm text-gray-600 mb-1\">Net Outstanding</p>\r\n          <p className=\"text-xl md:text-2xl font-bold text-orange-600\">\r\n            ‚Çπ{totals.totalNetOutstanding >= 100000 ? (totals.totalNetOutstanding / 100000).toFixed(2) + 'L' : totals.totalNetOutstanding.toLocaleString('en-IN')}\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        {/* Credit Accounts List */}\r\n        <div className=\"lg:col-span-1\">\r\n          <div className=\"bg-white rounded-xl border border-gray-200\">\r\n            <div className=\"p-4 border-b border-gray-200\">\r\n              <h2 className=\"font-bold text-gray-900 mb-3\">Credit Accounts</h2>\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Search by name or phone...\"\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"divide-y divide-gray-200 max-h-[600px] overflow-y-auto\">\r\n              {filteredAccounts.map((account) => (\r\n                <div\r\n                  key={account.id}\r\n                  className={`p-4 cursor-pointer transition-colors ${selectedCustomer === account.id ? 'bg-orange-50 border-l-4 border-orange-500' : 'hover:bg-gray-50'}`}\r\n                  onClick={() => {\r\n                    setSelectedCustomer(account.id);\r\n                    setActiveTab('bookings');\r\n                  }}\r\n                >\r\n                  <div className=\"flex items-start justify-between mb-2\">\r\n                    <div>\r\n                      <p className=\"font-semibold text-gray-900\">{account.customer}</p>\r\n                      <p className=\"text-sm text-orange-600 font-medium\">üì± {account.phone}</p>\r\n                      {account.nameVariations?.length > 1 && (\r\n                        <p className=\"text-xs text-gray-400 mt-1\">\r\n                          Also: {account.nameVariations.filter((n: string) => n !== account.customer).join(', ')}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${account.netOutstanding === 0 ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'\r\n                      }`}>\r\n                      {account.netOutstanding === 0 ? 'Clear' : '‚Çπ' + account.netOutstanding.toLocaleString('en-IN')}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between text-xs text-gray-500\">\r\n                    <span>{account.bookingCount} bookings</span>\r\n                    <span>{account.depots?.length || 0} depots</span>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n              {filteredAccounts.length === 0 && (\r\n                <div className=\"p-8 text-center text-gray-500\">\r\n                  No credit accounts found\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Customer Details */}\r\n        <div className=\"lg:col-span-2\">\r\n          {selectedAccount ? (\r\n            <div className=\"bg-white rounded-xl border border-gray-200\">\r\n              {/* Customer Header */}\r\n              <div className=\"p-6 border-b border-gray-200\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  {isEditingName ? (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input\r\n                        type=\"text\"\r\n                        value={editedName}\r\n                        onChange={(e) => setEditedName(e.target.value)}\r\n                        className=\"px-3 py-1 border border-gray-300 rounded-lg text-lg font-bold\"\r\n                        autoFocus\r\n                      />\r\n                      <button onClick={handleSaveDisplayName} className=\"px-3 py-1 bg-green-500 text-white rounded text-sm\">Save</button>\r\n                      <button onClick={() => setIsEditingName(false)} className=\"px-3 py-1 bg-gray-200 text-gray-700 rounded text-sm\">Cancel</button>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <h2 className=\"text-xl font-bold text-gray-900\">{selectedAccount.customer}</h2>\r\n                      <button\r\n                        onClick={() => { setIsEditingName(true); setEditedName(selectedAccount.customer); }}\r\n                        className=\"text-sm text-orange-600 hover:text-orange-700\"\r\n                      >‚úèÔ∏è Edit</button>\r\n                    </div>\r\n                  )}\r\n                  <button onClick={() => setSelectedCustomer(null)} className=\"text-gray-400 hover:text-gray-600 text-xl\">√ó</button>\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <p className=\"text-orange-600 font-medium\">üì± {selectedAccount.phone}</p>\r\n                  <button\r\n                    onClick={exportCustomerLedgerCSV}\r\n                    className=\"px-3 py-1 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200 flex items-center gap-1\"\r\n                  >\r\n                    üì• Export CSV\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tabs - 2x2 grid on mobile, flex on desktop */}\r\n              <div className=\"grid grid-cols-2 md:flex border-b border-gray-200\">\r\n                {(['bookings', 'payments', 'pricing', 'settlement'] as const).map((tab) => (\r\n                  <button\r\n                    key={tab}\r\n                    onClick={() => setActiveTab(tab)}\r\n                    className={`px-3 md:px-6 py-3 text-xs md:text-sm font-medium transition-colors flex flex-col md:flex-row items-center justify-center gap-1 ${activeTab === tab\r\n                      ? 'text-orange-600 border-b-2 border-orange-500 bg-orange-50'\r\n                      : 'text-gray-500 hover:text-gray-700 border-b-2 border-transparent'\r\n                      }`}\r\n                  >\r\n                    <span className=\"text-base md:mr-1\">\r\n                      {tab === 'bookings' && 'üì¶'}\r\n                      {tab === 'payments' && 'üí∞'}\r\n                      {tab === 'pricing' && '‚ö°'}\r\n                      {tab === 'settlement' && 'üìä'}\r\n                    </span>\r\n                    <span>\r\n                      {tab === 'bookings' && 'Bookings'}\r\n                      {tab === 'payments' && 'Payments'}\r\n                      {tab === 'pricing' && 'Set Pricing'}\r\n                      {tab === 'settlement' && 'Settlement'}\r\n                    </span>\r\n                  </button>\r\n                ))}\r\n              </div>\r\n\r\n              {/* Tab Content */}\r\n              <div className=\"p-6 max-h-[500px] overflow-y-auto\">\r\n                {/* Bookings Tab */}\r\n                {activeTab === 'bookings' && (\r\n                  <div className=\"space-y-3\">\r\n                    {selectedAccount.bookings?.map((b: any) => (\r\n                      <div key={b.id} className=\"flex justify-between items-center p-3 bg-gray-50 rounded-lg\">\r\n                        <div>\r\n                          <p className=\"font-medium text-gray-900\">{b.receiptNumber}</p>\r\n                          <p className=\"text-xs text-gray-500\">{new Date(b.date).toLocaleDateString('en-IN')} ‚Ä¢ {b.destination}</p>\r\n                        </div>\r\n                        <p className=\"font-bold text-orange-600\">‚Çπ{b.amount.toLocaleString('en-IN')}</p>\r\n                      </div>\r\n                    ))}\r\n                    {!selectedAccount.bookings?.length && (\r\n                      <p className=\"text-gray-500 text-center py-8\">No bookings found</p>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                {/* Payments Tab */}\r\n                {activeTab === 'payments' && (\r\n                  <div>\r\n                    <button\r\n                      onClick={() => setShowPaymentModal(true)}\r\n                      className=\"w-full mb-4 px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-medium\"\r\n                    >\r\n                      + Record New Payment\r\n                    </button>\r\n                    <div className=\"space-y-3\">\r\n                      {selectedAccount.payments?.map((p: any) => (\r\n                        <div key={p.id} className=\"flex justify-between items-center p-3 bg-green-50 rounded-lg\">\r\n                          <div>\r\n                            <p className=\"font-medium text-gray-900\">{p.receiptNumber || 'Payment'}</p>\r\n                            <p className=\"text-xs text-gray-500\">{new Date(p.date).toLocaleDateString('en-IN')} ‚Ä¢ {p.method}</p>\r\n                          </div>\r\n                          <p className=\"font-bold text-green-600\">+‚Çπ{p.amount.toLocaleString('en-IN')}</p>\r\n                        </div>\r\n                      ))}\r\n                      {!selectedAccount.payments?.length && (\r\n                        <p className=\"text-gray-500 text-center py-8\">No payments recorded yet</p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Pricing Tab */}\r\n                {activeTab === 'pricing' && (\r\n                  <div>\r\n                    <div className=\"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                      <p className=\"text-sm text-blue-800\">\r\n                        <strong>Set discounted prices</strong> for this customer. Only depots where they have shipped are shown.\r\n                      </p>\r\n                    </div>\r\n\r\n                    {relevantDepots.length === 0 ? (\r\n                      <p className=\"text-gray-500 text-center py-8\">No shipping history found for this customer.</p>\r\n                    ) : (\r\n                      <>\r\n                        <div className=\"overflow-y-auto max-h-[400px]\">\r\n                          <table className=\"w-full text-sm\">\r\n                            <thead className=\"bg-gray-100 sticky top-0\">\r\n                              <tr>\r\n                                <th className=\"px-4 py-3 text-left font-semibold text-gray-700 bg-gray-100\">Depot</th>\r\n                                {packages.map(pkg => (\r\n                                  <th key={pkg.id} className=\"px-3 py-3 text-center font-semibold text-gray-700 bg-gray-100\">\r\n                                    <div>{pkg.name}</div>\r\n                                    <div className=\"text-xs font-normal text-gray-500\">Base: ‚Çπ{pkg.basePrice}</div>\r\n                                  </th>\r\n                                ))}\r\n                              </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-gray-200\">\r\n                              {relevantDepots.map(depot => (\r\n                                <tr key={depot.id} className=\"hover:bg-gray-50\">\r\n                                  <td className=\"px-4 py-3 font-medium text-gray-900 whitespace-nowrap\">\r\n                                    {depot.name}\r\n                                  </td>\r\n                                  {packages.map(pkg => {\r\n                                    const key = `${pkg.id}_${depot.id}`;\r\n                                    const standardPrice = getStandardPrice(pkg.id, depot.id);\r\n                                    const currentValue = editingPrices[key];\r\n                                    const hasDiscount = currentValue !== undefined && currentValue < standardPrice;\r\n\r\n                                    return (\r\n                                      <td key={pkg.id} className=\"px-3 py-3 text-center\">\r\n                                        <div className=\"flex flex-col items-center gap-1\">\r\n                                          <div className=\"flex items-center gap-1\">\r\n                                            <span className=\"text-gray-400 text-xs\">‚Çπ</span>\r\n                                            <input\r\n                                              type=\"number\"\r\n                                              placeholder={String(standardPrice)}\r\n                                              value={currentValue ?? ''}\r\n                                              onChange={(e) => handlePriceChange(pkg.id, depot.id, e.target.value)}\r\n                                              className={`w-16 px-2 py-1 border rounded text-sm text-center ${hasDiscount\r\n                                                ? 'border-orange-500 bg-orange-50 text-orange-900 font-medium'\r\n                                                : 'border-gray-200 bg-gray-50'\r\n                                                }`}\r\n                                            />\r\n                                          </div>\r\n                                          {hasDiscount && (\r\n                                            <span className=\"text-xs text-green-600\">\r\n                                              -‚Çπ{(standardPrice - currentValue).toFixed(0)}\r\n                                            </span>\r\n                                          )}\r\n                                        </div>\r\n                                      </td>\r\n                                    );\r\n                                  })}\r\n                                </tr>\r\n                              ))}\r\n                            </tbody>\r\n                          </table>\r\n                        </div>\r\n\r\n                        <div className=\"mt-4 flex justify-end\">\r\n                          <button\r\n                            onClick={handleSavePricing}\r\n                            disabled={isSavingPrices}\r\n                            className=\"px-6 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-medium disabled:opacity-50\"\r\n                          >\r\n                            {isSavingPrices ? 'Saving...' : 'Save Pricing'}\r\n                          </button>\r\n                        </div>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                {/* Settlement Tab */}\r\n                {activeTab === 'settlement' && (\r\n                  <div>\r\n                    <div className=\"grid grid-cols-2 gap-4 mb-6\">\r\n                      <div className=\"p-4 bg-gray-50 rounded-lg\">\r\n                        <p className=\"text-sm text-gray-600\">Total Credit</p>\r\n                        <p className=\"text-xl font-bold text-gray-900\">‚Çπ{selectedAccount.totalCredit.toLocaleString('en-IN')}</p>\r\n                      </div>\r\n                      <div className=\"p-4 bg-green-50 rounded-lg\">\r\n                        <p className=\"text-sm text-gray-600\">Advance Paid</p>\r\n                        <p className=\"text-xl font-bold text-green-600\">‚Çπ{selectedAccount.advancePaid.toLocaleString('en-IN')}</p>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {discountSummary && discountSummary.totalSavings > 0 && (\r\n                      <div className=\"mb-6 p-4 bg-orange-50 border border-orange-200 rounded-lg\">\r\n                        <h3 className=\"font-bold text-orange-800 mb-2\">üí∞ Discount Applied</h3>\r\n                        <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                          <p className=\"text-gray-600\">Original Total:</p>\r\n                          <p className=\"text-right\">‚Çπ{discountSummary.originalTotal.toLocaleString('en-IN')}</p>\r\n                          <p className=\"text-gray-600\">Discounted Total:</p>\r\n                          <p className=\"text-right font-medium\">‚Çπ{discountSummary.discountedTotal.toLocaleString('en-IN')}</p>\r\n                          <p className=\"font-bold text-green-700\">Total Savings:</p>\r\n                          <p className=\"text-right font-bold text-green-700\">‚Çπ{discountSummary.totalSavings.toLocaleString('en-IN')} ({discountSummary.savingsPercent}%)</p>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    <div className=\"p-4 bg-orange-100 rounded-lg border-2 border-orange-500\">\r\n                      <p className=\"text-sm text-orange-800\">Net Outstanding</p>\r\n                      <p className=\"text-3xl font-bold text-orange-600\">‚Çπ{selectedAccount.netOutstanding.toLocaleString('en-IN')}</p>\r\n                    </div>\r\n\r\n                    <button\r\n                      onClick={() => setShowPaymentModal(true)}\r\n                      className=\"w-full mt-4 px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-medium\"\r\n                    >\r\n                      Record Payment\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"bg-white rounded-xl border border-gray-200 p-12 text-center\">\r\n              <p className=\"text-4xl mb-4\">üëà</p>\r\n              <p className=\"text-gray-500\">Select a customer to view details and manage pricing</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Payment Modal */}\r\n      {showPaymentModal && selectedCustomer && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-xl p-6 max-w-md w-full mx-4\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h2 className=\"text-xl font-bold text-gray-900\">Record Advance Payment</h2>\r\n              <button onClick={() => setShowPaymentModal(false)} className=\"text-gray-500 hover:text-gray-700 text-2xl\">√ó</button>\r\n            </div>\r\n\r\n            <div className=\"mb-4 bg-gray-50 rounded-lg p-3\">\r\n              <p className=\"text-sm\"><strong>Customer:</strong> {getSelectedAccount()?.customer}</p>\r\n              <p className=\"text-sm\"><strong>Outstanding:</strong> ‚Çπ{(getSelectedAccount()?.netOutstanding || 0).toLocaleString('en-IN')}</p>\r\n            </div>\r\n\r\n            <div className=\"mb-4\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Amount (‚Çπ)</label>\r\n              <input\r\n                type=\"number\"\r\n                value={paymentAmount}\r\n                onChange={(e) => setPaymentAmount(e.target.value)}\r\n                placeholder=\"Enter amount\"\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"mb-4\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Payment Method</label>\r\n              <select\r\n                value={paymentMethod}\r\n                onChange={(e) => setPaymentMethod(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500\"\r\n              >\r\n                <option value=\"cash\">Cash</option>\r\n                <option value=\"upi\">UPI</option>\r\n                <option value=\"bank_transfer\">Bank Transfer</option>\r\n                <option value=\"cheque\">Cheque</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"mb-4\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Notes (Optional)</label>\r\n              <input\r\n                type=\"text\"\r\n                value={paymentNotes}\r\n                onChange={(e) => setPaymentNotes(e.target.value)}\r\n                placeholder=\"e.g., Season 2024 partial\"\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={() => setShowPaymentModal(false)}\r\n                className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50\"\r\n              >Cancel</button>\r\n              <button\r\n                onClick={handleRecordPayment}\r\n                disabled={!paymentAmount || isProcessing}\r\n                className=\"flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50\"\r\n              >\r\n                {isProcessing ? 'Processing...' : 'Record Payment'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"file":"assets/CreditLedger-AjoWP8Q2.js"}