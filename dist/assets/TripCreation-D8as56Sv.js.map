{"version":3,"file":"TripCreation-D8as56Sv.js","sources":["../../src/app/components/TripCreation.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { seasonApi, bookingsApi, depotsApi, tripsApi, depotRoutesApi } from '../utils/api';\r\nimport { useTripStore, useSyncStore, useOnlineStore } from '../stores';\r\nimport { queueOperation } from '../utils/syncEngine';\r\nimport { isNetworkError } from '../utils/networkErrors';\r\n\r\ninterface Booking {\r\n  id: string;\r\n  receipt_number: string;\r\n  sender_name: string;\r\n  sender_phone: string;\r\n  destination_depot_name: string;\r\n  destination_depot_id: string;\r\n  origin_depot_id: string;\r\n  origin_depot_name: string;\r\n  total_amount: number;\r\n  package_details: any[];\r\n  receivers: any[];\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface Depot {\r\n  id: string;\r\n  name: string;\r\n  depot_type: string;\r\n}\r\n\r\ninterface TripCreationProps {\r\n  userRole?: string;\r\n  assignedDepotId?: string | null;\r\n}\r\n\r\nexport default function TripCreation({ userRole, assignedDepotId }: TripCreationProps) {\r\n  // Zustand stores for offline support\r\n  const { draft, hasDraft, saveDraft, clearDraft, lastSavedAt, selectedBookings: storedSelectedBookings, setSelectedBookings: storeSetSelectedBookings, pendingTripId, setPendingTripId } = useTripStore();\r\n  const isOnline = useOnlineStore((state) => state.isOnline);\r\n  const pendingOperations = useSyncStore((state) => state.pendingOperations);\r\n\r\n  const [formData, setFormData] = useState({\r\n    driverName: '',\r\n    driverPhone: '',\r\n    vehicleNumber: '',\r\n    tripCost: '',\r\n  });\r\n\r\n  const [selectedBookings, setSelectedBookings] = useState<string[]>([]);\r\n  const [availableBookings, setAvailableBookings] = useState<Booking[]>([]);\r\n  const [depots, setDepots] = useState<Depot[]>([]);\r\n  const [season, setSeason] = useState<any>(null);\r\n  const [isSeasonActive, setIsSeasonActive] = useState(true);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [forwardingDestinations, setForwardingDestinations] = useState<string[]>([]);\r\n  const [showDraftPrompt, setShowDraftPrompt] = useState(false);\r\n  const [phoneError, setPhoneError] = useState<string | null>(null);\r\n\r\n  // Indian mobile number validation: 10 digits starting with 6, 7, 8, or 9\r\n  const validatePhone = (phone: string) => /^[6-9]\\d{9}$/.test(phone);\r\n\r\n  // Check for draft on mount\r\n  useEffect(() => {\r\n    if (hasDraft && draft) {\r\n      if (lastSavedAt) {\r\n        const hoursSinceLastSave = (Date.now() - new Date(lastSavedAt).getTime()) / (1000 * 60 * 60);\r\n        if (hoursSinceLastSave < 24) {\r\n          setShowDraftPrompt(true);\r\n        } else {\r\n          clearDraft();\r\n        }\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Auto-save form data as draft (debounced)\r\n  useEffect(() => {\r\n    const timeoutId = setTimeout(() => {\r\n      if (formData.driverName || formData.vehicleNumber || selectedBookings.length > 0) {\r\n        saveDraft(formData);\r\n        storeSetSelectedBookings(selectedBookings);\r\n      }\r\n    }, 1000);\r\n\r\n    return () => clearTimeout(timeoutId);\r\n  }, [formData, selectedBookings, saveDraft, storeSetSelectedBookings]);\r\n\r\n  useEffect(() => {\r\n    loadInitialData();\r\n  }, []);;\r\n\r\n  const loadInitialData = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const [seasonRes, bookingsRes, depotsRes] = await Promise.all([\r\n        seasonApi.get(),\r\n        bookingsApi.getAll(),\r\n        depotsApi.getAll()\r\n      ]);\r\n\r\n      // Season check\r\n      if (seasonRes.season && seasonRes.season.startDate && seasonRes.season.endDate) {\r\n        setSeason(seasonRes.season);\r\n        const now = new Date();\r\n        const start = new Date(seasonRes.season.startDate);\r\n        const end = new Date(seasonRes.season.endDate);\r\n        setIsSeasonActive(now >= start && now <= end);\r\n      }\r\n\r\n      // For forwarding depot managers, show bookings that need to be forwarded\r\n      if (userRole === 'depot_manager' && assignedDepotId) {\r\n        // Fetch the routes where this depot is the origin (forwarding from)\r\n        const routesRes = await depotRoutesApi.getByDepotId(assignedDepotId);\r\n        const destinationIds = routesRes.forwardingDepotIds || [];\r\n        setForwardingDestinations(destinationIds);\r\n\r\n        console.log('Forwarding destinations for depot:', assignedDepotId, destinationIds);\r\n\r\n        // For forwarding trips: show bookings that are in_transit or reached_depot\r\n        // AND destined for one of the forwarding destinations\r\n        // These are packages that arrived at this depot and need to be forwarded\r\n        const forwardingBookings = (bookingsRes.bookings || []).filter((b: Booking) =>\r\n          ['in_transit', 'reached_depot'].includes(b.status) &&\r\n          destinationIds.includes(b.destination_depot_id)\r\n        );\r\n\r\n        setAvailableBookings(forwardingBookings);\r\n      } else {\r\n        // For owner/booking clerk: show only 'booked' status (regular trip creation)\r\n        const bookedOnly = (bookingsRes.bookings || []).filter(\r\n          (b: Booking) => b.status === 'booked'\r\n        );\r\n        setAvailableBookings(bookedOnly);\r\n      }\r\n\r\n      // Set depots\r\n      setDepots(depotsRes.depots || []);\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!isSeasonActive) {\r\n      alert('Cannot create trips outside of the season dates. Please contact admin to update season settings.');\r\n      return;\r\n    }\r\n\r\n    if (selectedBookings.length === 0) {\r\n      alert('Please select at least one booking for this trip.');\r\n      return;\r\n    }\r\n\r\n    if (!formData.driverName || !formData.driverPhone || !formData.vehicleNumber) {\r\n      alert('Please fill in all required fields.');\r\n      return;\r\n    }\r\n\r\n    // Validate Indian mobile number format\r\n    if (!validatePhone(formData.driverPhone)) {\r\n      setPhoneError('Please enter a valid 10-digit Indian mobile number (starting with 6, 7, 8, or 9)');\r\n      return;\r\n    }\r\n    setPhoneError(null);\r\n\r\n    setIsSubmitting(true);\r\n    try {\r\n      // Get origin depot from first selected booking\r\n      const firstBooking = availableBookings.find(b => selectedBookings.includes(b.id));\r\n\r\n      // For forwarding trips, the origin is the current depot (forwarding from)\r\n      const isForwardingTrip = userRole === 'depot_manager' && assignedDepotId;\r\n\r\n      // Create trip data\r\n      const tripData = {\r\n        driver: formData.driverName,\r\n        driverPhone: formData.driverPhone,\r\n        vehicle: formData.vehicleNumber,\r\n        tripCost: parseFloat(formData.tripCost) || 0,\r\n        originId: isForwardingTrip ? assignedDepotId : (firstBooking?.origin_depot_id || null),\r\n        destinationId: firstBooking?.destination_depot_id || null,\r\n        departure: new Date().toISOString(),\r\n        eta: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),\r\n        isForwarding: isForwardingTrip,\r\n      };\r\n\r\n      if (isOnline) {\r\n        try {\r\n          const tripResult = await tripsApi.create(tripData, selectedBookings);\r\n          alert(`Trip created successfully! Trip Number: ${tripResult.trip?.trip_number || tripResult.trip?.id || 'Created'}`);\r\n\r\n          // Clear draft and reset\r\n          clearDraft();\r\n          setFormData({ driverName: '', driverPhone: '', vehicleNumber: '', tripCost: '' });\r\n          setSelectedBookings([]);\r\n          loadInitialData();\r\n        } catch (error: any) {\r\n          console.error('Error creating trip:', error);\r\n\r\n          // Check if network error - queue it\r\n          if (isNetworkError(error)) {\r\n            console.log('[TripCreation] Network error detected, queuing operation');\r\n            const operationId = queueOperation('CREATE_TRIP', { tripData, bookingIds: selectedBookings }, {\r\n              entityType: 'trip',\r\n              optimisticData: { formData, selectedBookings, createdAt: new Date().toISOString() }\r\n            });\r\n            setPendingTripId(operationId);\r\n            alert(`Trip saved offline! Reference: TRIP-${operationId.slice(-8).toUpperCase()}. It will be synced when you're back online.`);\r\n            clearDraft();\r\n            setFormData({ driverName: '', driverPhone: '', vehicleNumber: '', tripCost: '' });\r\n            setSelectedBookings([]);\r\n          } else {\r\n            alert('Error creating trip. Please try again.');\r\n          }\r\n        }\r\n      } else {\r\n        // Offline: Queue the operation\r\n        const operationId = queueOperation('CREATE_TRIP', { tripData, bookingIds: selectedBookings }, {\r\n          entityType: 'trip',\r\n          optimisticData: { formData, selectedBookings, createdAt: new Date().toISOString() }\r\n        });\r\n\r\n        setPendingTripId(operationId);\r\n        alert(`Trip saved offline! Reference: TRIP-${operationId.slice(-8).toUpperCase()}. It will be synced when you're back online.`);\r\n        clearDraft();\r\n        setFormData({ driverName: '', driverPhone: '', vehicleNumber: '', tripCost: '' });\r\n        setSelectedBookings([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error creating trip:', error);\r\n      alert('Error creating trip. Please try again.');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value,\r\n    });\r\n  };\r\n\r\n  const toggleBooking = (bookingId: string) => {\r\n    setSelectedBookings(prev =>\r\n      prev.includes(bookingId)\r\n        ? prev.filter(id => id !== bookingId)\r\n        : [...prev, bookingId]\r\n    );\r\n  };\r\n\r\n  const selectAllBookings = () => {\r\n    if (selectedBookings.length === availableBookings.length) {\r\n      setSelectedBookings([]);\r\n    } else {\r\n      setSelectedBookings(availableBookings.map(b => b.id));\r\n    }\r\n  };\r\n\r\n  // Helper to extract all packages from a booking (from receivers)\r\n  const getBookingPackages = (booking: any) => {\r\n    const packages: { size: string; quantity: number }[] = [];\r\n    if (Array.isArray(booking.receivers)) {\r\n      booking.receivers.forEach((receiver: any) => {\r\n        if (Array.isArray(receiver.packages)) {\r\n          receiver.packages.forEach((pkg: any) => {\r\n            packages.push({\r\n              size: pkg.size || 'Other',\r\n              quantity: Number(pkg.quantity) || 0\r\n            });\r\n          });\r\n        }\r\n      });\r\n    }\r\n    return packages;\r\n  };\r\n\r\n  // Calculate totals\r\n  const selectedBookingDetails = availableBookings.filter(b => selectedBookings.includes(b.id));\r\n  const totalPackages = selectedBookingDetails.reduce((sum, b) => {\r\n    return sum + getBookingPackages(b).reduce((pSum, pkg) => pSum + pkg.quantity, 0);\r\n  }, 0);\r\n  const totalAmount = selectedBookingDetails.reduce((sum, b) => sum + (Number(b.total_amount) || 0), 0);\r\n\r\n  // Calculate total inventory across all depots\r\n  const totalInventory = availableBookings.reduce((acc, booking) => {\r\n    getBookingPackages(booking).forEach(pkg => {\r\n      acc[pkg.size] = (acc[pkg.size] || 0) + pkg.quantity;\r\n    });\r\n    return acc;\r\n  }, {} as Record<string, number>);\r\n\r\n  // Group bookings by destination depot with package breakdown\r\n  const inventoryByDestination = availableBookings.reduce((acc, booking) => {\r\n    const dest = booking.destination_depot_name || 'Unknown';\r\n    if (!acc[dest]) {\r\n      acc[dest] = { bookings: [], packages: {} as Record<string, number> };\r\n    }\r\n    acc[dest].bookings.push(booking);\r\n\r\n    // Aggregate packages from receivers\r\n    getBookingPackages(booking).forEach(pkg => {\r\n      acc[dest].packages[pkg.size] = (acc[dest].packages[pkg.size] || 0) + pkg.quantity;\r\n    });\r\n    return acc;\r\n  }, {} as Record<string, { bookings: Booking[]; packages: Record<string, number> }>);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"p-4 md:p-8\">\r\n        <div className=\"text-center py-12\">\r\n          <div className=\"animate-spin w-8 h-8 border-4 border-orange-500 border-t-transparent rounded-full mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Loading trip data...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-8 max-w-full overflow-x-hidden\">\r\n      <div className=\"mb-8\">\r\n        <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900 mb-2\">Trip Creation</h1>\r\n        <p className=\"text-gray-600\">Create a new transport trip and assign bookings</p>\r\n      </div>\r\n\r\n      {/* Season Warning */}\r\n      {!isSeasonActive && (\r\n        <div className=\"bg-red-50 border border-red-200 rounded-xl p-6 mb-6\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <span className=\"text-2xl\">‚ö†Ô∏è</span>\r\n            <div>\r\n              <h3 className=\"font-bold text-red-800 mb-1\">Season Inactive</h3>\r\n              <p className=\"text-sm text-red-700\">\r\n                Trips cannot be created outside the season dates\r\n                {season && ` (${new Date(season.startDate).toLocaleDateString('en-IN')} - ${new Date(season.endDate).toLocaleDateString('en-IN')})`}.\r\n                Please contact the administrator to update season settings.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Draft Recovery Prompt */}\r\n      {showDraftPrompt && (\r\n        <div className=\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <span className=\"text-2xl\">üìù</span>\r\n            <div className=\"flex-1\">\r\n              <h3 className=\"font-semibold text-blue-900\">Resume Previous Trip?</h3>\r\n              <p className=\"text-sm text-blue-700 mt-1\">\r\n                You have an unsaved trip draft from {lastSavedAt ? new Date(lastSavedAt).toLocaleString() : 'earlier'}.\r\n              </p>\r\n              <div className=\"flex gap-3 mt-3\">\r\n                <button\r\n                  onClick={() => {\r\n                    if (draft) setFormData(draft);\r\n                    if (storedSelectedBookings.length > 0) setSelectedBookings(storedSelectedBookings);\r\n                    setShowDraftPrompt(false);\r\n                  }}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium\"\r\n                >\r\n                  Resume Trip\r\n                </button>\r\n                <button\r\n                  onClick={() => { clearDraft(); setShowDraftPrompt(false); }}\r\n                  className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium\"\r\n                >\r\n                  Start Fresh\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Offline Warning */}\r\n      {!isOnline && (\r\n        <div className=\"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"text-xl\">‚ö†Ô∏è</span>\r\n            <div>\r\n              <span className=\"font-medium text-amber-800\">You're currently offline. </span>\r\n              <span className=\"text-amber-700\">Your trip will be saved and submitted when you're back online.</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Inventory Summary Cards */}\r\n      <div className=\"mb-6\">\r\n        <h2 className=\"font-bold text-gray-900 mb-4\">System Inventory - Pending Bookings</h2>\r\n        {/* Container with viewport-based width - responsive for mobile vs desktop */}\r\n        <div className=\"w-[calc(100vw-2rem)] md:w-[calc(100vw-320px)] max-w-full overflow-hidden -mx-4 md:mx-0 px-4 md:px-0\">\r\n          <div className=\"flex gap-3 md:gap-4 overflow-x-auto pb-3 snap-x snap-mandatory\">\r\n            {/* Total Inventory Card - First */}\r\n            {availableBookings.length > 0 && (\r\n              <div className=\"bg-orange-50 rounded-lg border-2 border-orange-300 p-3 md:p-4 min-w-[160px] md:min-w-[180px] max-w-[180px] md:max-w-[200px] flex-shrink-0 snap-start\">\r\n                <p className=\"text-sm font-bold text-orange-700 mb-2\">üì¶ Total Inventory</p>\r\n                <p className=\"text-xs text-gray-600 mb-2\">{availableBookings.length} total bookings</p>\r\n                <div className=\"space-y-1 max-h-[140px] overflow-y-auto\">\r\n                  {Object.entries(totalInventory).map(([pkgName, qty]) => (\r\n                    <div key={pkgName} className=\"flex justify-between text-xs\">\r\n                      <span className=\"text-gray-700\">{pkgName}</span>\r\n                      <span className=\"font-bold text-orange-700 ml-2\">{qty}</span>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Per-Depot Cards */}\r\n            {Object.entries(inventoryByDestination).map(([depot, data]) => (\r\n              <div key={depot} className=\"bg-white rounded-lg border border-gray-200 p-3 md:p-4 min-w-[160px] md:min-w-[180px] max-w-[180px] md:max-w-[200px] flex-shrink-0 snap-start\">\r\n                <p className=\"text-sm font-bold text-gray-900 truncate mb-2\">{depot}</p>\r\n                <p className=\"text-xs text-gray-500 mb-2\">{data.bookings.length} bookings</p>\r\n                <div className=\"space-y-1 max-h-[140px] overflow-y-auto\">\r\n                  {Object.entries(data.packages).map(([pkgName, qty]) => (\r\n                    <div key={pkgName} className=\"flex justify-between text-xs\">\r\n                      <span className=\"text-gray-600 truncate\">{pkgName}</span>\r\n                      <span className=\"font-bold text-orange-600 ml-2\">{qty}</span>\r\n                    </div>\r\n                  ))}\r\n                  {Object.keys(data.packages).length === 0 && (\r\n                    <p className=\"text-xs text-gray-400\">No packages</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ))}\r\n            {Object.keys(inventoryByDestination).length === 0 && (\r\n              <div className=\"flex-1 bg-gray-50 rounded-lg p-6 text-center text-gray-500\">\r\n                No pending bookings available\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        {/* Trip Details Form */}\r\n        <div className=\"lg:col-span-1\">\r\n          <div className=\"bg-white rounded-xl border border-gray-200 p-6 sticky top-8\">\r\n            <h2 className=\"font-bold text-gray-900 mb-4\">Trip Details</h2>\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n              <div>\r\n                <label htmlFor=\"driverName\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  Driver Name *\r\n                </label>\r\n                <input\r\n                  id=\"driverName\"\r\n                  name=\"driverName\"\r\n                  type=\"text\"\r\n                  value={formData.driverName}\r\n                  onChange={handleChange}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\r\n                  placeholder=\"Enter driver name\"\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"driverPhone\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  Driver Phone *\r\n                </label>\r\n                <input\r\n                  id=\"driverPhone\"\r\n                  name=\"driverPhone\"\r\n                  type=\"tel\"\r\n                  value={formData.driverPhone}\r\n                  onChange={(e) => {\r\n                    // Only allow digits\r\n                    const value = e.target.value.replace(/\\D/g, '');\r\n                    setFormData({ ...formData, driverPhone: value });\r\n                    // Clear error when user starts typing\r\n                    if (phoneError) setPhoneError(null);\r\n                  }}\r\n                  className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent ${phoneError ? 'border-red-500' : 'border-gray-300'\r\n                    }`}\r\n                  placeholder=\"10-digit number (e.g., 9876543210)\"\r\n                  maxLength={10}\r\n                  required\r\n                />\r\n                {phoneError && (\r\n                  <p className=\"mt-1 text-sm text-red-600\">{phoneError}</p>\r\n                )}\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"vehicleNumber\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  Vehicle Number *\r\n                </label>\r\n                <input\r\n                  id=\"vehicleNumber\"\r\n                  name=\"vehicleNumber\"\r\n                  type=\"text\"\r\n                  value={formData.vehicleNumber}\r\n                  onChange={handleChange}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\r\n                  placeholder=\"e.g., MH-12-AB-1234\"\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"tripCost\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  Trip Cost (‚Çπ)\r\n                </label>\r\n                <input\r\n                  id=\"tripCost\"\r\n                  name=\"tripCost\"\r\n                  type=\"number\"\r\n                  value={formData.tripCost}\r\n                  onChange={handleChange}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\r\n                  placeholder=\"Optional\"\r\n                />\r\n              </div>\r\n\r\n              {/* Selected Summary */}\r\n              <div className=\"bg-orange-50 rounded-lg p-4\">\r\n                <div className=\"flex justify-between items-center mb-2\">\r\n                  <span className=\"text-sm font-medium text-gray-700\">Selected Bookings</span>\r\n                  <span className=\"font-bold text-orange-600\">{selectedBookings.length}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center mb-2\">\r\n                  <span className=\"text-sm font-medium text-gray-700\">Total Packages</span>\r\n                  <span className=\"font-bold text-gray-900\">{totalPackages}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center border-t border-orange-200 pt-2\">\r\n                  <span className=\"text-sm font-medium text-gray-700\">Total Value</span>\r\n                  <span className=\"font-bold text-green-600\">‚Çπ{totalAmount.toLocaleString('en-IN')}</span>\r\n                </div>\r\n              </div>\r\n\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isSubmitting || selectedBookings.length === 0 || !isSeasonActive}\r\n                className=\"w-full px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                {isSubmitting ? 'Creating Trip...' : 'Create Trip'}\r\n              </button>\r\n            </form>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Booking Selection */}\r\n        <div className=\"lg:col-span-2\">\r\n          <div className=\"bg-white rounded-xl border border-gray-200\">\r\n            <div className=\"p-6 border-b border-gray-200 flex justify-between items-center\">\r\n              <div>\r\n                <h2 className=\"font-bold text-gray-900\">Select Bookings</h2>\r\n                <p className=\"text-sm text-gray-600 mt-1\">\r\n                  {availableBookings.length} bookings available for assignment\r\n                </p>\r\n              </div>\r\n              <button\r\n                type=\"button\"\r\n                onClick={selectAllBookings}\r\n                className=\"px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors\"\r\n              >\r\n                {selectedBookings.length === availableBookings.length ? 'Deselect All' : 'Select All'}\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"max-h-[600px] overflow-y-auto divide-y divide-gray-200\">\r\n              {availableBookings.length > 0 ? availableBookings.map((booking) => (\r\n                <label\r\n                  key={booking.id}\r\n                  className={`flex items-start gap-4 p-4 cursor-pointer hover:bg-gray-50 transition-colors ${selectedBookings.includes(booking.id) ? 'bg-orange-50' : ''\r\n                    }`}\r\n                >\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={selectedBookings.includes(booking.id)}\r\n                    onChange={() => toggleBooking(booking.id)}\r\n                    className=\"mt-1 w-5 h-5 text-orange-500 border-gray-300 rounded focus:ring-orange-500\"\r\n                  />\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex justify-between items-start\">\r\n                      <div>\r\n                        <p className=\"font-medium text-gray-900\">{booking.sender_name}</p>\r\n                        <p className=\"text-sm text-gray-600\">{booking.sender_phone}</p>\r\n                      </div>\r\n                      <span className=\"px-2 py-1 bg-orange-100 text-orange-700 text-xs font-medium rounded\">\r\n                        {booking.receipt_number}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"mt-2 flex flex-wrap gap-4 text-sm\">\r\n                      <span className=\"text-gray-600\">\r\n                        üìç {booking.origin_depot_name || 'Origin'} ‚Üí {booking.destination_depot_name || 'Destination'}\r\n                      </span>\r\n                      <span className=\"font-medium text-green-600\">\r\n                        ‚Çπ{(Number(booking.total_amount) || 0).toLocaleString('en-IN')}\r\n                      </span>\r\n                    </div>\r\n                    {booking.package_details && Array.isArray(booking.package_details) && (\r\n                      <div className=\"mt-2 flex flex-wrap gap-2\">\r\n                        {booking.package_details.map((pkg: any, idx: number) => (\r\n                          <span key={idx} className=\"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded\">\r\n                            {pkg.name || pkg.packageName}: {pkg.quantity}\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </label>\r\n              )) : (\r\n                <div className=\"p-8 text-center text-gray-500\">\r\n                  <p className=\"text-lg mb-2\">No pending bookings</p>\r\n                  <p className=\"text-sm\">All bookings have been assigned to trips or delivered.</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["TripCreation","userRole","assignedDepotId","draft","hasDraft","saveDraft","clearDraft","lastSavedAt","storedSelectedBookings","storeSetSelectedBookings","pendingTripId","setPendingTripId","useTripStore","isOnline","useOnlineStore","state","useSyncStore","formData","setFormData","useState","selectedBookings","setSelectedBookings","availableBookings","setAvailableBookings","depots","setDepots","season","setSeason","isSeasonActive","setIsSeasonActive","isLoading","setIsLoading","isSubmitting","setIsSubmitting","forwardingDestinations","setForwardingDestinations","showDraftPrompt","setShowDraftPrompt","phoneError","setPhoneError","validatePhone","phone","useEffect","timeoutId","loadInitialData","seasonRes","bookingsRes","depotsRes","seasonApi","bookingsApi","depotsApi","now","start","end","destinationIds","depotRoutesApi","forwardingBookings","b","bookedOnly","error","handleSubmit","e","firstBooking","isForwardingTrip","tripData","tripResult","tripsApi","_a","_b","isNetworkError","operationId","queueOperation","handleChange","toggleBooking","bookingId","prev","id","selectAllBookings","getBookingPackages","booking","packages","receiver","pkg","selectedBookingDetails","totalPackages","sum","pSum","totalAmount","totalInventory","acc","inventoryByDestination","dest","jsxs","jsx","pkgName","qty","depot","data","value","idx"],"mappings":"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"}