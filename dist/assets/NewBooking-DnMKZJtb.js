import{_ as oe}from"./vendor-pdf-DRk-497H.js";import{r as N,j as e,R as le}from"./vendor-radix-BK0gN1wx.js";import{c as ee,u as ce,d as se,e as ne,f as de,p as ge,g as xe,s as ue,b as he,q as te}from"./index-ByUUsPfb.js";import"./vendor-react-BRY8hXab.js";import"./vendor-state-B-0uGrSJ.js";function re({nameValue:r,phoneValue:n,onNameChange:m,onPhoneChange:E,onContactSelect:k,nameLabel:F="Name",phoneLabel:p="Phone",namePlaceholder:f="Enter name",phonePlaceholder:c="10-digit number",required:P=!1}){const[R,l]=N.useState([]),[v,T]=N.useState(!1),[w,_]=N.useState(null),[z,B]=N.useState(!1),h=N.useRef(null);N.useEffect(()=>{const a=w==="name"?r:n;if(!a||a.length<2){l([]),T(!1);return}const i=setTimeout(async()=>{B(!0);const{contacts:s}=await ee.search(a);l(s),T(s.length>0),B(!1)},300);return()=>clearTimeout(i)},[r,n,w]),N.useEffect(()=>{const a=i=>{h.current&&!h.current.contains(i.target)&&T(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const t=a=>{m(a.name),E(a.phone),T(!1),k&&k(a)},o=a=>/^[6-9]\d{9}$/.test(a);return e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[F," ",P&&"*"]}),e.jsx("input",{type:"text",value:r,onChange:a=>m(a.target.value),onFocus:()=>_("name"),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:f,autoComplete:"off",required:P})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[p," ",P&&"*"]}),e.jsx("input",{type:"tel",value:n,onChange:a=>E(a.target.value),onFocus:()=>_("phone"),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:c,maxLength:10,autoComplete:"off",required:P}),n&&!o(n)&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Must be 10 digits starting with 9, 8, 7, or 6"})]})]}),v&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:z?e.jsx("div",{className:"p-3 text-gray-500 text-center",children:"Searching..."}):R.map(a=>e.jsx("button",{type:"button",onClick:()=>t(a),className:"w-full text-left px-4 py-3 hover:bg-orange-50 border-b border-gray-100 last:border-0 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.name}),e.jsx("div",{className:"text-sm text-gray-600",children:a.phone})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Used ",a.usage_count,"x"]})]})},a.id))})]})}function Ce({onNavigate:r}){const[n,m]=N.useState(1),[E,k]=N.useState(null),[F,p]=N.useState(!0),[f,c]=N.useState([]),[P,R]=N.useState([]),[l,v]=N.useState([]),[T,w]=N.useState(!1),[_,z]=N.useState(""),[B,h]=N.useState(!1),{draft:t,hasDraft:o,saveDraft:a,clearDraft:i,lastSavedAt:s,pendingBookingId:g,setPendingBookingId:y}=ce(),b=se(x=>x.isOnline),j=ne(x=>x.pendingOperations),[d,u]=N.useState({originDepotId:"",destinationDepotId:"",paymentMethod:"cash",deliveryType:"pickup",deliveryCharge:0,customInstructions:"",senderName:"",senderPhone:"",receivers:[{name:"",phone:"",address:"",packages:[]}]});N.useEffect(()=>{o&&t&&s&&((Date.now()-new Date(s).getTime())/36e5<24?h(!0):i())},[]),N.useEffect(()=>{const x=setTimeout(()=>{(d.senderName||d.senderPhone||d.originDepotId)&&a(d)},1e3);return()=>clearTimeout(x)},[d,a]),N.useEffect(()=>{O()},[]);const O=async()=>{try{const[x,S,L,I]=await Promise.all([de.getAll(),ge.getAll(),xe.getAll(),ue.get()]),A=x.depots||[];c(A),R(S.packages||[]),v(L.pricing||[]);const C=A.find($=>{var Y;return((Y=$.name)==null?void 0:Y.toLowerCase())==="devgad"&&$.type==="origin"});if(C&&u($=>({...$,originDepotId:C.id})),I.season){k(I.season);const $=new Date,Y=new Date(I.season.startDate),ae=new Date(I.season.endDate),ie=$>=Y&&$<=ae;p(ie)}}catch(x){console.error("Error loading data:",x)}},U=()=>{let x=0;return d.receivers.forEach(S=>{S.packages.forEach(L=>{x+=L.quantity*L.price})}),x+(d.deliveryCharge||0)},D=async()=>{var x,S,L;w(!0),console.log("[NewBooking] handleSubmit called"),console.log("[NewBooking] isOnline from store:",b),console.log("[NewBooking] navigator.onLine:",navigator.onLine);try{const I={origin_depot_id:d.originDepotId,destination_depot_id:d.destinationDepotId,payment_method:d.paymentMethod,delivery_type:d.deliveryType,delivery_charges:d.deliveryCharge,sender_name:d.senderName,sender_phone:d.senderPhone,receivers:d.receivers,subtotal:U()-(d.deliveryCharge||0),total_amount:U(),current_status:"booked",special_instructions:d.customInstructions};if(b)try{const A=await he.create(I),C=((x=A.booking)==null?void 0:x.receipt_number)||((S=A.booking)==null?void 0:S.id)||"Unknown";z(C),d.senderName&&d.senderPhone&&await ee.upsert(d.senderName,d.senderPhone).catch(console.error);for(const $ of d.receivers)$.name&&$.phone&&await ee.upsert($.name,$.phone).catch(console.error);i(),m(5)}catch(A){console.error("Error creating booking:",A);const C=((L=A.message)==null?void 0:L.toLowerCase())||"";if(C.includes("fetch")||C.includes("network")||C.includes("failed to fetch")||C.includes("err_name_not_resolved")||C.includes("err_internet_disconnected")||C.includes("err_connection")||C.includes("err_network")||C.includes("net::")||C.includes("timeout")||C.includes("abort")||A.name==="TypeError"||A.code==="ECONNREFUSED"||!navigator.onLine){console.log("[NewBooking] Network error detected, queuing operation");const Y=te("CREATE_BOOKING",I,{entityType:"booking",optimisticData:{formData:d,createdAt:new Date().toISOString()}});y(Y),z("PENDING-"+Y.slice(-8).toUpperCase()),i(),m(5)}else alert("Failed to create booking. Please try again.")}else{const A=te("CREATE_BOOKING",I,{entityType:"booking",optimisticData:{formData:d,createdAt:new Date().toISOString()}});y(A),z("PENDING-"+A.slice(-8).toUpperCase()),i(),m(5)}}catch(I){console.error("Error creating booking:",I),alert("Failed to create booking. Please try again.")}finally{w(!1)}},H=N.useRef(null),q=N.useRef(null),K=x=>{H.current=x.touches[0].clientX,q.current=x.touches[0].clientY},J=x=>{if(H.current===null||q.current===null)return;const S=x.changedTouches[0].clientX,L=x.changedTouches[0].clientY,I=S-H.current,A=L-q.current;Math.abs(I)>Math.abs(A)&&Math.abs(I)>50&&(I<0&&n<4?m(C=>Math.min(C+1,4)):I>0&&n>1&&m(C=>Math.max(C-1,1))),H.current=null,q.current=null},W=()=>m(x=>Math.min(x+1,5)),G=()=>m(x=>Math.max(x-1,1)),M=x=>m(x),V=()=>{const x=f.find(S=>{var L;return((L=S.name)==null?void 0:L.toLowerCase())==="devgad"&&S.type==="origin"});u({originDepotId:(x==null?void 0:x.id)||"",destinationDepotId:"",paymentMethod:"cash",deliveryType:"pickup",deliveryCharge:0,customInstructions:"",senderName:"",senderPhone:"",receivers:[{name:"",phone:"",address:"",packages:[]}]}),z(""),m(1),i(),y(null)},X=()=>{t&&u(t),h(!1)},Z=()=>{i(),h(!1)};if(!F)return e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ü•≠"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Mango Season is Currently Closed"}),e.jsx("p",{className:"text-gray-600",children:"Please check back during the mango season."})]});const Q=["Depot & Payment","Sender Details","Receivers & Packages","Summary"];return g&&j.find(x=>x.id===g&&x.status==="completed"),e.jsxs("div",{className:"p-8",children:[B&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"üìù"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"Resume Previous Booking?"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["You have an unsaved booking from ",s?new Date(s).toLocaleString():"earlier",". Would you like to continue where you left off?"]}),e.jsxs("div",{className:"flex gap-3 mt-3",children:[e.jsx("button",{onClick:X,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Resume Booking"}),e.jsx("button",{onClick:Z,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium",children:"Start Fresh"})]})]})]})}),!b&&n<5&&e.jsx("div",{className:"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-amber-800",children:"You're currently offline. "}),e.jsx("span",{className:"text-amber-700",children:"Your booking will be saved and submitted when you're back online."})]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"New Booking"}),e.jsx("p",{className:"text-gray-600",children:"Create a new mango transport booking"})]}),n<=4&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4 lg:hidden",children:[e.jsx("button",{onClick:G,disabled:n===1,className:`p-3 rounded-full transition-colors touch-target ${n===1?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-orange-100 text-orange-600 hover:bg-orange-200 active:bg-orange-300"}`,"aria-label":"Previous step",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["Step ",n," of 4"]}),e.jsx("div",{className:"text-sm text-gray-600",children:Q[n-1]})]}),e.jsx("button",{onClick:W,disabled:n===4,className:`p-3 rounded-full transition-colors touch-target ${n===4?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-orange-100 text-orange-600 hover:bg-orange-200 active:bg-orange-300"}`,"aria-label":"Next step",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"hidden lg:flex items-center justify-center gap-2",children:Q.map((x,S)=>e.jsxs(le.Fragment,{children:[e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium ${n===S+1?"bg-orange-500 text-white":n>S+1?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[e.jsx("span",{children:S+1}),e.jsx("span",{children:x})]}),S<3&&e.jsx("div",{className:"w-8 h-0.5 bg-gray-200"})]},S))}),e.jsx("p",{className:"lg:hidden text-center text-xs text-gray-400 mt-2",children:"Swipe or use arrows to navigate"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 max-w-4xl mx-auto",onTouchStart:K,onTouchEnd:J,children:[n===1&&e.jsx(me,{formData:d,setFormData:u,depots:f,onNext:W}),n===2&&e.jsx(pe,{formData:d,setFormData:u,onNext:W,onPrev:G}),n===3&&e.jsx(be,{formData:d,setFormData:u,packages:P,pricing:l,onNext:W,onPrev:G}),n===4&&e.jsx(ye,{formData:d,depots:f,onSubmit:D,onPrev:G,goToStep:M,isSubmitting:T}),n===5&&e.jsx(ve,{receiptNumber:_,formData:d,depots:f,onNewBooking:V,onNavigate:r})]})]})}function me({formData:r,setFormData:n,depots:m,onNext:E}){const k=m.filter(c=>c.type==="origin"),p=m.filter(c=>c.type!=="origin").sort((c,P)=>{var T,w;const R=["bhusari colony","sadashiv peth","akurdi"],l=R.indexOf((T=c.name)==null?void 0:T.toLowerCase()),v=R.indexOf((w=P.name)==null?void 0:w.toLowerCase());return l!==-1&&v!==-1?l-v:l!==-1?-1:v!==-1?1:(c.name||"").localeCompare(P.name||"")}),f=r.originDepotId&&r.destinationDepotId&&r.paymentMethod;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Step 1: Route & Payment"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Origin Depot *"}),e.jsxs("select",{value:r.originDepotId,onChange:c=>n({...r,originDepotId:c.target.value,destinationDepotId:""}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select Origin"}),k.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Destination Depot *"}),e.jsxs("select",{value:r.destinationDepotId,onChange:c=>n({...r,destinationDepotId:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500",disabled:!r.originDepotId,children:[e.jsx("option",{value:"",children:"Select Destination"}),p.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Payment Method *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{value:"cash",label:"üíµ Cash"},{value:"online",label:"üì± Online"},{value:"to_pay",label:"üì¶ To Pay"},{value:"credit",label:"üí≥ Credit"}].map(c=>e.jsx("button",{type:"button",onClick:()=>n({...r,paymentMethod:c.value}),className:`px-4 py-3 rounded-lg border-2 text-sm font-medium transition-all ${r.paymentMethod===c.value?"border-orange-500 bg-orange-50 text-orange-700":"border-gray-200 hover:border-orange-300"}`,children:c.label},c.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Delivery Type *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{value:"pickup",label:"üè™ Depot Pickup",desc:"Receiver picks up from depot"},{value:"home_sender",label:"üè† Home Delivery (Paid)",desc:"Delivery paid by sender"},{value:"home_topay",label:"üöö Home Delivery (To Pay)",desc:"Delivery paid by receiver"},{value:"home_drt",label:"üìç DRT Delivery",desc:"Special DRT delivery"}].map(c=>e.jsxs("button",{type:"button",onClick:()=>n({...r,deliveryType:c.value,deliveryCharge:0}),className:`p-4 rounded-lg border-2 text-left transition-all ${r.deliveryType===c.value?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-orange-300"}`,children:[e.jsx("div",{className:"font-medium",children:c.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:c.desc})]},c.value))})]}),r.deliveryType!=="pickup"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Charge (‚Çπ)"}),e.jsx("input",{type:"number",min:"0",value:r.deliveryCharge,onChange:c=>n({...r,deliveryCharge:Number(c.target.value)}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500",placeholder:"Enter delivery charge"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Instructions (Optional)"}),e.jsx("textarea",{value:r.customInstructions,onChange:c=>n({...r,customInstructions:c.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500",rows:2,placeholder:"Any special handling instructions..."})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:E,disabled:!f,className:"px-8 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 font-medium",children:"Next Step ‚Üí"})})]})}function pe({formData:r,setFormData:n,onNext:m,onPrev:E}){const k=p=>/^[6-9]\d{9}$/.test(p),F=r.senderName&&k(r.senderPhone);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Step 2: Sender Details"}),e.jsx("p",{className:"text-gray-600",children:"Start typing to see suggestions from past bookings"}),e.jsx(re,{nameValue:r.senderName,phoneValue:r.senderPhone,onNameChange:p=>n({...r,senderName:p}),onPhoneChange:p=>n({...r,senderPhone:p}),onContactSelect:p=>n({...r,senderName:p.name,senderPhone:p.phone}),nameLabel:"Sender Name",phoneLabel:"Sender Phone",namePlaceholder:"Start typing name...",phonePlaceholder:"10-digit number",required:!0}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:E,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",children:"‚Üê Previous"}),e.jsx("button",{onClick:m,disabled:!F,className:"px-8 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 font-medium",children:"Next Step ‚Üí"})]})]})}function be({formData:r,setFormData:n,packages:m,pricing:E,onNext:k,onPrev:F}){const p=o=>/^[6-9]\d{9}$/.test(o),f=["home_sender","home_topay","home_drt"].includes(r.deliveryType),c=o=>{var i;const a=E.find(s=>s.packageId===o&&s.depotId===r.destinationDepotId);return(a==null?void 0:a.price)||((i=m.find(s=>s.id===o))==null?void 0:i.basePrice)||0},P=[...m].sort((o,a)=>{var j,d;const i=["1 dz","1dz","2 dz","2dz","3 dz","3dz","5 dz","5dz"],s=((j=o.name)==null?void 0:j.toLowerCase())||"",g=((d=a.name)==null?void 0:d.toLowerCase())||"",y=i.findIndex(u=>s.includes(u)),b=i.findIndex(u=>g.includes(u));return y!==-1&&b!==-1?y-b:y!==-1?-1:b!==-1?1:s.localeCompare(g)}),R=(o,a,i)=>{const s=[...r.receivers];s[o]={...s[o],[a]:i},n({...r,receivers:s})},l=(o,a,i)=>{const s=[...r.receivers],g=s[o],y=m.find(d=>d.id===a),b=c(a),j=g.packages.findIndex(d=>d.packageId===a);if(i>0){const d={packageId:a,size:(y==null?void 0:y.name)||"Custom",quantity:i,price:b};j>=0?g.packages[j]=d:g.packages.push(d)}else j>=0&&g.packages.splice(j,1);n({...r,receivers:s})},v=(o,a,i)=>{const s=[...r.receivers],g=s[o],y=g.packages.findIndex(b=>b.packageId===a);y>=0&&(g.packages[y].description=i,n({...r,receivers:s}))},T=(o,a)=>{var s,g;const i=(g=(s=r.receivers[o])==null?void 0:s.packages)==null?void 0:g.find(y=>y.packageId===a);return(i==null?void 0:i.description)||""},w=o=>(o==null?void 0:o.toLowerCase())==="other",_=(o,a)=>{var s,g;const i=(g=(s=r.receivers[o])==null?void 0:s.packages)==null?void 0:g.find(y=>y.packageId===a);return(i==null?void 0:i.quantity)||0},z=()=>{n({...r,receivers:[...r.receivers,{name:"",phone:"",address:"",packages:[]}]})},B=o=>{if(r.receivers.length>1){const a=r.receivers.filter((i,s)=>s!==o);n({...r,receivers:a})}},h=o=>o.packages.reduce((a,i)=>a+i.quantity*i.price,0),t=r.receivers.every(o=>o.name&&p(o.phone)&&o.packages.length>0&&(!f||o.address));return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Step 3: Receivers & Packages"}),e.jsx("p",{className:"text-gray-600",children:"Add receiver details and select packages for each receiver"}),r.receivers.map((o,a)=>e.jsxs("div",{className:"p-6 border-2 border-gray-200 rounded-lg space-y-4 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:["Receiver ",a+1]}),r.receivers.length>1&&e.jsx("button",{onClick:()=>B(a),className:"text-red-600 hover:text-red-700 text-sm font-medium",children:"Remove"})]}),e.jsx(re,{nameValue:o.name,phoneValue:o.phone,onNameChange:i=>R(a,"name",i),onPhoneChange:i=>R(a,"phone",i),onContactSelect:i=>{const s=[...r.receivers];s[a]={...s[a],name:i.name,phone:i.phone},n({...r,receivers:s})},nameLabel:"Receiver Name",phoneLabel:"Receiver Phone",namePlaceholder:"Start typing name...",phonePlaceholder:"10-digit number",required:!0}),f&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Address *"}),e.jsx("textarea",{value:o.address,onChange:i=>R(a,"address",i.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500",rows:2,placeholder:"Enter full delivery address",required:!0})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"üì¶ Select Packages"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:P.map(i=>{const s=c(i.id),g=_(a,i.id),y=w(i.name),b=T(a,i.id);return e.jsxs("div",{className:`p-3 bg-white border rounded-lg hover:border-orange-300 transition-colors ${y&&g>0?"border-yellow-400 col-span-full":"border-gray-200"}`,children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:i.name}),e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["‚Çπ",s,"/unit"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",value:g>0?g:"",placeholder:"0",onChange:j=>l(a,i.id,Number(j.target.value)||0),className:`w-16 px-2 py-1 text-center border rounded focus:ring-2 focus:ring-orange-500 ${g>0?"border-orange-400 bg-orange-50":"border-gray-300 text-gray-400"}`}),g>0&&e.jsxs("span",{className:"text-xs font-medium text-green-600",children:["‚Çπ",(g*s).toFixed(0)]})]}),y&&g>0&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",value:b,onChange:j=>v(a,i.id,j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-sm",placeholder:"Enter description (e.g., Special box, Custom crate...)"})})]},i.id)})})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:["Subtotal for ",o.name||`Receiver ${a+1}`,":"]}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["‚Çπ",h(o).toFixed(2)]})]})})]},a)),e.jsx("button",{onClick:z,className:"w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-orange-500 hover:text-orange-500 font-medium transition-colors",children:"+ Add Another Receiver"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:F,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",children:"‚Üê Previous"}),e.jsx("button",{onClick:k,disabled:!t,className:"px-8 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 font-medium",children:"Review Summary ‚Üí"})]})]})}function ye({formData:r,depots:n,onSubmit:m,onPrev:E,goToStep:k,isSubmitting:F}){var R,l;const p=n.find(v=>v.id===r.originDepotId),f=n.find(v=>v.id===r.destinationDepotId),c=r.receivers.reduce((v,T)=>v+T.packages.reduce((w,_)=>w+_.quantity*_.price,0),0),P=c+(r.deliveryCharge||0);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Step 4: Review & Confirm"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"üìç Route"}),e.jsx("button",{onClick:()=>k(1),className:"text-orange-600 text-sm hover:underline",children:"Edit"})]}),e.jsxs("p",{children:[p==null?void 0:p.name," ‚Üí ",f==null?void 0:f.name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Payment: ",(R=r.paymentMethod)==null?void 0:R.toUpperCase()," | Delivery: ",(l=r.deliveryType)==null?void 0:l.replace("_"," ")]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"üë§ Sender"}),e.jsx("button",{onClick:()=>k(2),className:"text-orange-600 text-sm hover:underline",children:"Edit"})]}),e.jsxs("p",{children:[r.senderName," (",r.senderPhone,")"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"üì¶ Receivers & Packages"}),e.jsx("button",{onClick:()=>k(3),className:"text-orange-600 text-sm hover:underline",children:"Edit"})]}),r.receivers.map((v,T)=>e.jsxs("div",{className:"border-l-4 border-orange-300 pl-4 mb-4",children:[e.jsxs("p",{className:"font-medium",children:[v.name," (",v.phone,")"]}),v.address&&e.jsx("p",{className:"text-sm text-gray-600",children:v.address}),e.jsx("div",{className:"mt-2 space-y-1",children:v.packages.map((w,_)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[w.size," √ó ",w.quantity]}),e.jsxs("span",{children:["‚Çπ",(w.quantity*w.price).toFixed(0)]})]},_))})]},T))]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Packages Subtotal"}),e.jsxs("span",{children:["‚Çπ",c.toFixed(2)]})]}),r.deliveryCharge>0&&e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Delivery Charge"}),e.jsxs("span",{children:["‚Çπ",r.deliveryCharge.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2 pt-2 border-t border-orange-300",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{className:"text-orange-600",children:["‚Çπ",P.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:E,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",children:"‚Üê Previous"}),e.jsx("button",{onClick:m,disabled:F,className:"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-medium",children:F?"Creating...":"‚úì Confirm Booking"})]})]})}function ve({receiptNumber:r,formData:n,depots:m,onNewBooking:E,onNavigate:k}){const F=m==null?void 0:m.find(h=>h.id===(n==null?void 0:n.originDepotId)),p=m==null?void 0:m.find(h=>h.id===(n==null?void 0:n.destinationDepotId)),f=r==null?void 0:r.startsWith("PENDING-"),c=ne(h=>h.pendingOperations),P=se(h=>h.isOnline),R=f?r.replace("PENDING-","").toLowerCase():null,l=R?c.find(h=>h.id.toLowerCase().endsWith(R)):null,v=()=>n!=null&&n.receivers?n.receivers.reduce((h,t)=>h+(t.packages||[]).reduce((o,a)=>o+a.quantity*a.price,0),0)+(n.deliveryCharge||0):0,T=()=>{var t;const h=["ü•≠ DRT MANGO TRANSPORT","‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ",`Receipt: ${r}`,`Date: ${new Date().toLocaleDateString("en-IN")}`,"","üìç DESTINATION",`${(p==null?void 0:p.name)||"N/A"}`,"","üë§ SENDER",`*${(n==null?void 0:n.senderName)||"N/A"}* (${(n==null?void 0:n.senderPhone)||"N/A"})`,"","üì¶ RECEIVERS & PACKAGES"];return(t=n==null?void 0:n.receivers)==null||t.forEach((o,a)=>{var i;h.push(`
${a+1}. ${o.name} (${o.phone})`),(i=o.packages)==null||i.forEach(s=>{h.push(`   ‚Ä¢ ${s.size} √ó ${s.quantity} = ‚Çπ${(s.quantity*s.price).toFixed(0)}`)})}),h.push(`
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`),h.push(`üí∞ TOTAL: ‚Çπ${v().toFixed(2)}`),h.push(`
Thank you for choosing DRT Mango Transport! ü•≠`),h.join(`
`)},w=()=>{const h=encodeURIComponent(T());window.open(`https://wa.me/?text=${h}`,"_blank")},_=async()=>{var J,W,G;const{jsPDF:h}=await oe(async()=>{const{jsPDF:M}=await import("./vendor-pdf-DRk-497H.js").then(V=>V.j);return{jsPDF:M}},[]),t=new h({format:"a5",unit:"mm",orientation:"landscape"}),o=t.internal.pageSize.getWidth(),a=t.internal.pageSize.getHeight(),i=12;let s=12;t.setFontSize(18),t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("DRT MANGO TRANSPORT",o/2,s,{align:"center"}),s+=5,t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(80,80,80),t.text("AT POST JAMSANDE, TAL.DEVGAD, DIST. SINDHUDURG | MOB: 9422584166, 9422435348",o/2,s,{align:"center"}),t.setTextColor(0,0,0),s+=6,t.setDrawColor(200,200,200),t.setLineWidth(.3),t.line(i,s,o-i,s),s+=6,t.setFontSize(10),t.setFont("helvetica","bold"),t.text(`Receipt No: ${r}`,i,s),t.setFont("helvetica","normal"),t.text(`Date: ${new Date().toLocaleDateString("en-IN")}`,o-i,s,{align:"right"}),s+=7,t.setFontSize(12),t.setFont("helvetica","bold"),t.text(`Destination: ${(p==null?void 0:p.name)||"N/A"}`,i,s),s+=6,t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`Sender: ${(n==null?void 0:n.senderName)||"N/A"} (${(n==null?void 0:n.senderPhone)||"N/A"})`,i,s),s+=8;const g=i,y=o-2*g,b={srNo:12,receiver:55,packageSize:40,qty:20},j=7,d=a-35;t.setFillColor(51,51,51),t.rect(g,s,y,j,"F"),t.setTextColor(255,255,255),t.setFontSize(9),t.setFont("helvetica","bold");let u=g+3;t.text("Sr.",u,s+5),u+=b.srNo,t.text("Receiver",u,s+5),u+=b.receiver,t.text("Package Size",u,s+5),u+=b.packageSize,t.text("Qty",u,s+5),u+=b.qty,t.text("Amount",u,s+5),s+=j,t.setTextColor(0,0,0),t.setFont("helvetica","normal");let O=0,U=0;(J=n==null?void 0:n.receivers)==null||J.forEach((M,V)=>{M.packages&&M.packages.length>0&&M.packages.forEach((X,Z)=>{s>d&&(t.addPage(),s=15),O++;const Q=X.quantity*X.price;U+=Q,O%2===0&&(t.setFillColor(248,248,248),t.rect(g,s,y,j,"F")),t.setDrawColor(220,220,220);const x=Z===0?j+3:j;if(t.rect(g,s,y,x,"S"),t.setFontSize(9),u=g+3,t.text(`${O}`,u,s+5),u+=b.srNo,Z===0){const S=`${M.name||"N/A"}`.substring(0,22);t.setFont("helvetica","bold"),t.text(S,u,s+4),t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text(`${M.phone||""}`,u,s+8),t.setTextColor(0,0,0),t.setFontSize(9)}u+=b.receiver,t.text(X.size||"N/A",u,s+5),u+=b.packageSize,t.text(`${X.quantity}`,u,s+5),u+=b.qty,t.text(`‚Çπ${Q.toFixed(0)}`,u,s+5),s+=x})}),(n==null?void 0:n.deliveryCharge)>0&&(s>d&&(t.addPage(),s=15),O++,U+=n.deliveryCharge,t.setFillColor(255,250,240),t.rect(g,s,y,j,"F"),t.setDrawColor(220,220,220),t.rect(g,s,y,j,"S"),t.setFontSize(9),u=g+3,t.text(`${O}`,u,s+5),u+=b.srNo,t.setFont("helvetica","italic"),t.text("Delivery Charge",u,s+5),t.setFont("helvetica","normal"),u+=b.receiver+b.packageSize,t.text("1",u,s+5),u+=b.qty,t.text(`‚Çπ${n.deliveryCharge.toFixed(0)}`,u,s+5),s+=j),t.setFillColor(51,51,51),t.rect(g,s,y,j+2,"F"),t.setTextColor(255,255,255),t.setFontSize(11),t.setFont("helvetica","bold");const D=((G=(W=n==null?void 0:n.paymentMethod)==null?void 0:W.replace("_"," "))==null?void 0:G.toUpperCase())||"CASH";t.text(`Payment: ${D}`,g+3,s+6);const H=g+b.srNo+b.receiver+b.packageSize+b.qty+3;t.text(`TOTAL: ‚Çπ${U.toFixed(0)}`,H,s+6),s+=j+8,t.setTextColor(0,0,0),t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text("Thank you for choosing DRT Mango Transport!",o/2,s,{align:"center"}),t.setTextColor(0,0,0),s+=12;const q=45,K=o-i-q;t.setDrawColor(150,150,150),t.setLineWidth(.4),t.line(K,s,K+q,s),s+=4,t.setFontSize(8),t.setFont("helvetica","normal"),t.text("Authorized Signature",K+q/2,s,{align:"center"}),t.save(`${r}.pdf`)},z=()=>{navigator.clipboard.writeText(r),alert("Receipt number copied!")},B=()=>{k?k("dashboard"):window.location.reload()};return e.jsxs("div",{className:"text-center space-y-6 py-8",children:[f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl",children:(l==null?void 0:l.status)==="syncing"?"üîÑ":(l==null?void 0:l.status)==="failed"?"‚ö†Ô∏è":"‚è≥"}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:(l==null?void 0:l.status)==="syncing"?"Syncing Booking...":(l==null?void 0:l.status)==="failed"?"Sync Failed":"Booking Saved Locally"}),e.jsx("p",{className:"text-gray-600",children:P?(l==null?void 0:l.status)==="failed"?"Failed to sync. Will retry automatically or you can retry from the status bar.":"Your booking will be synced shortly...":"Your booking is saved and will be submitted when you're back online."}),e.jsxs("div",{className:`border rounded-lg p-6 max-w-md mx-auto ${(l==null?void 0:l.status)==="failed"?"bg-red-50 border-red-200":"bg-amber-50 border-amber-200"}`,children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Temporary Reference"}),e.jsx("p",{className:`text-2xl font-bold ${(l==null?void 0:l.status)==="failed"?"text-red-700":"text-amber-700"}`,children:r}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[(l==null?void 0:l.status)==="syncing"&&"‚è≥ Syncing now...",(l==null?void 0:l.status)==="pending"&&P&&"‚è≥ Waiting to sync...",(l==null?void 0:l.status)==="pending"&&!P&&"üì¥ Will sync when online",(l==null?void 0:l.status)==="failed"&&`‚ùå ${l.error||"Sync failed"}`]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl",children:"‚úÖ"}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Booking Created Successfully!"}),e.jsx("p",{className:"text-gray-600",children:"Your mango transport booking has been confirmed"}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 max-w-md mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Receipt Number"}),e.jsx("p",{className:"text-3xl font-bold text-green-700",children:r}),e.jsx("button",{onClick:z,className:"mt-2 text-sm text-green-600 hover:underline",children:"üìã Copy"})]})]}),e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 max-w-md mx-auto text-left",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Route:"}),e.jsxs("span",{className:"font-medium",children:[F==null?void 0:F.name," ‚Üí ",p==null?void 0:p.name]})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Sender:"}),e.jsx("span",{className:"font-medium",children:n==null?void 0:n.senderName})]}),e.jsxs("div",{className:"flex justify-between font-bold pt-2 border-t mt-2",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:f?"text-amber-700":"text-green-700",children:["‚Çπ",v().toFixed(2)]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 max-w-md mx-auto pt-4",children:[!f&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:w,className:"flex-1 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-medium",children:"üí¨ WhatsApp"}),e.jsx("button",{onClick:_,className:"flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-medium",children:"üì• Download PDF"})]}),f&&e.jsx("div",{className:"p-3 bg-gray-100 rounded-lg text-sm text-gray-600",children:"üìã Share and PDF options will be available after sync completes"}),e.jsx("button",{onClick:E,className:"py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-medium",children:"‚ûï Create New Booking"}),e.jsx("button",{onClick:B,className:"py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium",children:"üè† Go to Dashboard"})]})]})}export{Ce as default};
//# sourceMappingURL=NewBooking-DnMKZJtb.js.map
