{"version":3,"mappings":"mSAuBA,SAAwBA,GAAoB,CACxC,UAAAC,EACA,WAAAC,EACA,aAAAC,EACA,cAAAC,EACA,gBAAAC,EACA,UAAAC,EAAY,OACZ,WAAAC,EAAa,QACb,gBAAAC,EAAkB,aAClB,iBAAAC,EAAmB,kBACnB,SAAAC,EAAW,EACf,EAA6B,CACzB,KAAM,CAACC,EAAaC,CAAc,EAAIC,WAAoB,EAAE,EACtD,CAACC,EAAcC,CAAe,EAAIF,WAAS,EAAK,EAChD,CAACG,EAAaC,CAAc,EAAIJ,WAAkC,IAAI,EACtE,CAACK,EAAWC,CAAY,EAAIN,WAAS,EAAK,EAC1CO,EAAcC,SAAuB,IAAI,EAG/CC,YAAU,IAAM,CACZ,MAAMC,EAAQP,IAAgB,OAASf,EAAYC,EACnD,GAAI,CAACqB,GAASA,EAAM,OAAS,EAAG,CAC5BX,EAAe,EAAE,EACjBG,EAAgB,EAAK,EACrB,MACJ,CAEA,MAAMS,EAAQ,WAAW,SAAY,CACjCL,EAAa,EAAI,EACjB,KAAM,CAAE,SAAAM,CAAA,EAAa,MAAMC,GAAY,OAAOH,CAAK,EACnDX,EAAea,CAAQ,EACvBV,EAAgBU,EAAS,OAAS,CAAC,EACnCN,EAAa,EAAK,CACtB,EAAG,GAAG,EAEN,MAAO,IAAM,aAAaK,CAAK,CACnC,EAAG,CAACvB,EAAWC,EAAYc,CAAW,CAAC,EAGvCM,YAAU,IAAM,CACZ,MAAMK,EAAsBC,GAAsB,CAC1CR,EAAY,SAAW,CAACA,EAAY,QAAQ,SAASQ,EAAM,MAAc,GACzEb,EAAgB,EAAK,CAE7B,EACA,gBAAS,iBAAiB,YAAaY,CAAkB,EAClD,IAAM,SAAS,oBAAoB,YAAaA,CAAkB,CAC7E,EAAG,EAAE,EAEL,MAAME,EAAuBC,GAAqB,CAC9C3B,EAAa2B,EAAQ,IAAI,EACzB1B,EAAc0B,EAAQ,KAAK,EAC3Bf,EAAgB,EAAK,EACjBV,KAAiCyB,CAAO,CAChD,EAEMC,EAAiBC,GACZ,eAAe,KAAKA,CAAK,EAGpC,OACIC,OAAC,OAAI,UAAU,WAAW,IAAKb,EAC3B,UAAAa,OAAC,OAAI,UAAU,wCAEX,UAAAA,OAAC,OACG,UAAAA,OAAC,SAAM,UAAU,+CACZ,UAAA3B,EAAU,IAAEI,GAAY,KAC7B,EACAwB,MAAC,SACG,KAAK,OACL,MAAOjC,EACP,SAAWkC,GAAMhC,EAAagC,EAAE,OAAO,KAAK,EAC5C,QAAS,IAAMlB,EAAe,MAAM,EACpC,UAAU,iHACV,YAAaT,EACb,aAAa,MACb,SAAAE,CAAA,EACJ,EACJ,SAGC,OACG,UAAAuB,OAAC,SAAM,UAAU,+CACZ,UAAA1B,EAAW,IAAEG,GAAY,KAC9B,EACAwB,MAAC,SACG,KAAK,MACL,MAAOhC,EACP,SAAWiC,GAAM/B,EAAc+B,EAAE,OAAO,KAAK,EAC7C,QAAS,IAAMlB,EAAe,OAAO,EACrC,UAAU,iHACV,YAAaR,EACb,UAAW,GACX,aAAa,MACb,SAAAC,CAAA,GAEHR,GAAc,CAAC6B,EAAc7B,CAAU,GACpCgC,MAAC,KAAE,UAAU,4BAA4B,yDAEzC,GAER,GACJ,EAGCpB,GACGoB,MAAC,OAAI,UAAU,0GACV,SAAAhB,EACGgB,MAAC,OAAI,UAAU,gCAAgC,wBAAY,EAE3DvB,EAAY,IAAKmB,GACbI,MAAC,UAEG,KAAK,SACL,QAAS,IAAML,EAAoBC,CAAO,EAC1C,UAAU,yGAEV,SAAAG,OAAC,OAAI,UAAU,oCACX,UAAAA,OAAC,OACG,UAAAC,MAAC,OAAI,UAAU,4BAA6B,SAAAJ,EAAQ,KAAK,EACzDI,MAAC,OAAI,UAAU,wBAAyB,WAAQ,MAAM,GAC1D,EACAD,OAAC,OAAI,UAAU,wBAAwB,kBAC7BH,EAAQ,YAAY,KAC9B,GACJ,GAbKA,EAAQ,GAepB,EAET,GAER,CAER,CCrHA,SAAwBM,GAAW,CAAE,WAAAC,GAA+B,CAClE,KAAM,CAACC,EAAaC,CAAc,EAAI1B,WAAS,CAAC,EAC1C,CAAC2B,EAAQC,CAAS,EAAI5B,WAAc,IAAI,EACxC,CAAC6B,EAAgBC,CAAiB,EAAI9B,WAAS,EAAI,EACnD,CAAC+B,EAAQC,CAAS,EAAIhC,WAAgB,EAAE,EACxC,CAACiC,EAAUC,CAAW,EAAIlC,WAAgB,EAAE,EAC5C,CAACmC,EAASC,CAAU,EAAIpC,WAAgB,EAAE,EAC1C,CAACqC,EAAcC,CAAe,EAAItC,WAAS,EAAK,EAChD,CAACuC,EAAeC,CAAgB,EAAIxC,WAAS,EAAE,EAC/C,CAACyC,EAAiBC,CAAkB,EAAI1C,WAAS,EAAK,EAGtD,CAAE,MAAA2C,EAAO,SAAAC,EAAU,UAAAC,EAAW,WAAAC,EAAY,YAAAC,EAAa,iBAAAC,EAAkB,oBAAAC,CAAA,EAAwBC,GAAA,EACjGC,EAAWC,GAAgBC,GAAUA,EAAM,QAAQ,EACnDC,EAAoBC,GAAcF,GAAUA,EAAM,iBAAiB,EAEnE,CAACG,EAAUC,CAAW,EAAIzD,WAA0B,CACxD,cAAe,GACf,mBAAoB,GACpB,cAAe,OACf,aAAc,SACd,eAAgB,EAChB,mBAAoB,GACpB,WAAY,GACZ,YAAa,GACb,UAAW,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,QAAS,GAAI,SAAU,EAAC,CAAG,EAC/D,EAGDS,YAAU,IAAM,CACVmC,GAAYD,GAEVI,KAC0B,KAAK,MAAQ,IAAI,KAAKA,CAAW,EAAE,WAAc,KACpD,GACvBL,EAAmB,EAAI,EAGvBI,EAAA,EAIR,EAAG,EAAE,EAGLrC,YAAU,IAAM,CACd,MAAMiD,EAAY,WAAW,IAAM,EAE7BF,EAAS,YAAcA,EAAS,aAAeA,EAAS,gBAC1DX,EAAUW,CAAQ,CAEtB,EAAG,GAAI,EAEP,MAAO,IAAM,aAAaE,CAAS,CACrC,EAAG,CAACF,EAAUX,CAAS,CAAC,EAExBpC,YAAU,IAAM,CACdkD,EAAA,CACF,EAAG,EAAE,EAEL,MAAMA,EAAkB,SAAY,CAClC,GAAI,CACF,KAAM,CAACC,EAAWC,EAAaC,EAAYC,CAAS,EAAI,MAAM,QAAQ,IAAI,CACxEC,GAAU,SACVC,GAAY,SACZC,GAAgB,SAChBC,GAAU,KAAI,CACf,EACKC,EAAeR,EAAU,QAAU,GACzC5B,EAAUoC,CAAY,EACtBlC,EAAY2B,EAAY,UAAY,EAAE,EACtCzB,EAAW0B,EAAW,SAAW,EAAE,EAGnC,MAAMO,EAAcD,EAAa,KAAME,GAAA,OAAW,QAAAC,EAAAD,EAAE,OAAF,YAAAC,EAAQ,iBAAkB,UAAYD,EAAE,OAAS,SAAQ,EAI3G,GAHID,GACFZ,MAAqB,CAAE,GAAGe,EAAM,cAAeH,EAAY,IAAK,EAE9DN,EAAU,OAAQ,CACpBnC,EAAUmC,EAAU,MAAM,EAE1B,MAAMU,MAAY,KACZC,EAAY,IAAI,KAAKX,EAAU,OAAO,SAAS,EAC/CY,GAAU,IAAI,KAAKZ,EAAU,OAAO,OAAO,EAC3Ca,GAAWH,GAASC,GAAaD,GAASE,GAChD7C,EAAkB8C,EAAQ,CAC5B,CACF,OAASC,EAAO,CACd,QAAQ,MAAM,sBAAuBA,CAAK,CAC5C,CACF,EAWMC,EAAiB,IAAM,CAC3B,IAAIC,EAAQ,EACZ,OAAAvB,EAAS,UAAU,QAAQwB,GAAY,CACrCA,EAAS,SAAS,QAAQC,GAAO,CAC/BF,GAASE,EAAI,SAAWA,EAAI,KAC9B,CAAC,CACH,CAAC,EACMF,GAASvB,EAAS,gBAAkB,EAC7C,EAEM0B,EAAe,SAAY,WAC/B5C,EAAgB,EAAI,EAGpB,QAAQ,IAAI,kCAAkC,EAC9C,QAAQ,IAAI,oCAAqCa,CAAQ,EACzD,QAAQ,IAAI,iCAAkC,UAAU,MAAM,EAE9D,GAAI,CACF,MAAMgC,EAAc,CAClB,gBAAiB3B,EAAS,cAC1B,qBAAsBA,EAAS,mBAC/B,eAAgBA,EAAS,cACzB,cAAeA,EAAS,aACxB,iBAAkBA,EAAS,eAC3B,YAAaA,EAAS,WACtB,aAAcA,EAAS,YACvB,UAAWA,EAAS,UACpB,SAAUsB,EAAA,GAAoBtB,EAAS,gBAAkB,GACzD,aAAcsB,EAAA,EACd,eAAgB,SAChB,qBAAsBtB,EAAS,oBAGjC,GAAIL,EAEF,GAAI,CACF,MAAMiC,EAAS,MAAMC,GAAY,OAAOF,CAAW,EAC7CG,IAAmBf,EAAAa,EAAO,UAAP,YAAAb,EAAgB,mBAAkBgB,EAAAH,EAAO,UAAP,YAAAG,EAAgB,KAAM,UACjF/C,EAAiB8C,CAAgB,EAG7B9B,EAAS,YAAcA,EAAS,aAClC,MAAM3C,GAAY,OAAO2C,EAAS,WAAYA,EAAS,WAAW,EAAE,MAAM,QAAQ,KAAK,EAEzF,UAAWwB,KAAYxB,EAAS,UAC1BwB,EAAS,MAAQA,EAAS,OAC5B,MAAMnE,GAAY,OAAOmE,EAAS,KAAMA,EAAS,KAAK,EAAE,MAAM,QAAQ,KAAK,EAK/ElC,EAAA,EACApB,EAAe,CAAC,CAClB,OAASmD,EAAY,CACnB,QAAQ,MAAM,0BAA2BA,CAAK,EAG9C,MAAMW,IAAeC,EAAAZ,EAAM,UAAN,YAAAY,EAAe,gBAAiB,GAgBrD,GAdED,EAAa,SAAS,OAAO,GAC7BA,EAAa,SAAS,SAAS,GAC/BA,EAAa,SAAS,iBAAiB,GACvCA,EAAa,SAAS,uBAAuB,GAC7CA,EAAa,SAAS,2BAA2B,GACjDA,EAAa,SAAS,gBAAgB,GACtCA,EAAa,SAAS,aAAa,GACnCA,EAAa,SAAS,OAAO,GAC7BA,EAAa,SAAS,SAAS,GAC/BA,EAAa,SAAS,OAAO,GAC7BX,EAAM,OAAS,aACfA,EAAM,OAAS,gBACf,CAAC,UAAU,OAEO,CAClB,QAAQ,IAAI,wDAAwD,EACpE,MAAMa,EAAcC,GAAe,iBAAkBR,EAAa,CAChE,WAAY,UACZ,eAAgB,CAAE,SAAA3B,EAAU,cAAe,OAAO,aAAY,CAAE,CACjE,EACDP,EAAoByC,CAAW,EAC/BlD,EAAiB,WAAakD,EAAY,MAAM,EAAE,EAAE,aAAa,EACjE5C,EAAA,EACApB,EAAe,CAAC,CAClB,MAEE,MAAM,6CAA6C,CAEvD,KACK,CAEL,MAAMgE,EAAcC,GAAe,iBAAkBR,EAAa,CAChE,WAAY,UACZ,eAAgB,CAAE,SAAA3B,EAAU,cAAe,OAAO,aAAY,CAAE,CACjE,EAEDP,EAAoByC,CAAW,EAC/BlD,EAAiB,WAAakD,EAAY,MAAM,EAAE,EAAE,aAAa,EACjE5C,EAAA,EACApB,EAAe,CAAC,CAClB,CACF,OAASmD,EAAO,CACd,QAAQ,MAAM,0BAA2BA,CAAK,EAC9C,MAAM,6CAA6C,CACrD,SACEvC,EAAgB,EAAK,CACvB,CACF,EAGMsD,EAAcpF,SAAsB,IAAI,EACxCqF,EAAcrF,SAAsB,IAAI,EAExCsF,EAAoBxE,GAAwB,CAChDsE,EAAY,QAAUtE,EAAE,QAAQ,CAAC,EAAE,QACnCuE,EAAY,QAAUvE,EAAE,QAAQ,CAAC,EAAE,OACrC,EAEMyE,EAAkBzE,GAAwB,CAC9C,GAAIsE,EAAY,UAAY,MAAQC,EAAY,UAAY,KAAM,OAElE,MAAMG,EAAY1E,EAAE,eAAe,CAAC,EAAE,QAChC2E,EAAY3E,EAAE,eAAe,CAAC,EAAE,QAChC4E,EAASF,EAAYJ,EAAY,QACjCO,EAASF,EAAYJ,EAAY,QAInC,KAAK,IAAIK,CAAM,EAAI,KAAK,IAAIC,CAAM,GAAK,KAAK,IAAID,CAAM,EAAI,KACxDA,EAAS,GAAKzE,EAAc,EAE9BC,KAAuB,KAAK,IAAI8C,EAAO,EAAG,CAAC,CAAC,EACnC0B,EAAS,GAAKzE,EAAc,GAErCC,KAAuB,KAAK,IAAI8C,EAAO,EAAG,CAAC,CAAC,GAIhDoB,EAAY,QAAU,KACtBC,EAAY,QAAU,IACxB,EAEMO,EAAW,IAAM1E,EAAe8C,GAAQ,KAAK,IAAIA,EAAO,EAAG,CAAC,CAAC,EAC7D6B,EAAW,IAAM3E,EAAe8C,GAAQ,KAAK,IAAIA,EAAO,EAAG,CAAC,CAAC,EAC7D8B,EAAYC,GAAiB7E,EAAe6E,CAAI,EAEhDC,EAAY,IAAM,CAEtB,MAAMnC,EAActC,EAAO,KAAMuC,GAAA,OAAW,QAAAC,EAAAD,EAAE,OAAF,YAAAC,EAAQ,iBAAkB,UAAYD,EAAE,OAAS,SAAQ,EAErGb,EAAY,CACV,eAAeY,GAAA,YAAAA,EAAa,KAAM,GAClC,mBAAoB,GACpB,cAAe,OACf,aAAc,SACd,eAAgB,EAChB,mBAAoB,GACpB,WAAY,GACZ,YAAa,GACb,UAAW,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,QAAS,GAAI,SAAU,EAAC,CAAG,EAC/D,EACD7B,EAAiB,EAAE,EACnBd,EAAe,CAAC,EAChBoB,EAAA,EACAG,EAAoB,IAAI,CAC1B,EAGMwD,EAAe,IAAM,CACrB9D,GACFc,EAAYd,CAAK,EAEnBD,EAAmB,EAAK,CAC1B,EAEMgE,EAAe,IAAM,CACzB5D,EAAA,EACAJ,EAAmB,EAAK,CAC1B,EAGA,GAAI,CAACb,EACH,OACET,OAAC,OAAI,UAAU,kBACb,UAAAC,MAAC,OAAI,UAAU,gBAAgB,cAAE,EACjCA,MAAC,MAAG,UAAU,wCAAwC,4CAAgC,EACtFA,MAAC,KAAE,UAAU,gBAAgB,sDAA0C,GACzE,EAIJ,MAAMsF,EAAa,CAAC,kBAAmB,iBAAkB,uBAAwB,SAAS,EAG1D,OAAA3D,GAC5BM,EAAkB,KAAKsD,GAAMA,EAAG,KAAO5D,GAAoB4D,EAAG,SAAW,WAAW,EAItFxF,OAAC,OAAI,UAAU,MAEZ,UAAAqB,SACE,OAAI,UAAU,wDACb,SAAArB,OAAC,OAAI,UAAU,yBACb,UAAAC,MAAC,QAAK,UAAU,WAAW,cAAE,EAC7BD,OAAC,OAAI,UAAU,SACb,UAAAC,MAAC,MAAG,UAAU,8BAA8B,oCAAwB,EACpED,OAAC,KAAE,UAAU,6BAA6B,8CACN2B,EAAc,IAAI,KAAKA,CAAW,EAAE,iBAAmB,UAAU,oDAErG,EACA3B,OAAC,OAAI,UAAU,kBACb,UAAAC,MAAC,UACC,QAASoF,EACT,UAAU,oFACX,4BAGDpF,MAAC,UACC,QAASqF,EACT,UAAU,uFACX,wBAED,EACF,GACF,GACF,EACF,EAID,CAACvD,GAAY1B,EAAc,GAC1BJ,MAAC,OAAI,UAAU,0DACb,SAAAD,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC,QAAK,UAAU,UAAU,cAAE,SAC3B,OACC,UAAAA,MAAC,QAAK,UAAU,6BAA6B,sCAA0B,EACvEA,MAAC,QAAK,UAAU,iBAAiB,6EAAiE,GACpG,GACF,EACF,EAIFD,OAAC,OAAI,UAAU,OACb,UAAAC,MAAC,MAAG,UAAU,mCAAmC,uBAAW,EAC5DA,MAAC,KAAE,UAAU,gBAAgB,0CAA8B,GAC7D,EAGCI,GAAe,GACdL,OAAC,OAAI,UAAU,OAEb,UAAAA,OAAC,OAAI,UAAU,wDACb,UAAAC,MAAC,UACC,QAASgF,EACT,SAAU5E,IAAgB,EAC1B,UAAW,mDAAmDA,IAAgB,EAC1E,+CACA,wEACF,GACF,aAAW,gBAEX,SAAAJ,MAAC,OAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,YACjE,eAAC,QAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,kBAAkB,EACzF,IAGFD,OAAC,OAAI,UAAU,cACb,UAAAA,OAAC,OAAI,UAAU,qCAAqC,kBAAMK,EAAY,SAAK,QAC1E,OAAI,UAAU,wBAAyB,SAAAkF,EAAWlF,EAAc,CAAC,EAAE,GACtE,EAEAJ,MAAC,UACC,QAAS+E,EACT,SAAU3E,IAAgB,EAC1B,UAAW,mDAAmDA,IAAgB,EAC1E,+CACA,wEACF,GACF,aAAW,YAEX,SAAAJ,MAAC,OAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,YACjE,eAAC,QAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,eAAe,EACtF,GACF,EACF,EAGAA,MAAC,OAAI,UAAU,mDACZ,SAAAsF,EAAW,IAAI,CAACE,EAAOC,IACtB1F,OAAC2F,GAAM,SAAN,CACC,UAAA3F,OAAC,OACC,UAAW,sEAAsEK,IAAgBqF,EAAQ,EACrG,2BACArF,EAAcqF,EAAQ,EACpB,8BACA,2BACJ,GAEF,UAAAzF,MAAC,QAAM,WAAQ,EAAE,EACjBA,MAAC,QAAM,SAAAwF,CAAA,CAAM,KAEdC,EAAQ,GAAKzF,MAAC,OAAI,UAAU,wBAAwB,IAZlCyF,CAarB,CACD,EACH,EAGAzF,MAAC,KAAE,UAAU,mDAAmD,2CAEhE,GACF,EAIFD,OAAC,OACC,UAAU,mEACV,aAAc0E,EACd,WAAYC,EAEX,UAAAtE,IAAgB,GACfJ,MAAC2F,GAAA,CACC,SAAAxD,EACA,YAAAC,EACA,OAAA1B,EACA,OAAQqE,CAAA,GAIX3E,IAAgB,GACfJ,MAAC4F,GAAA,CACC,SAAAzD,EACA,YAAAC,EACA,OAAQ2C,EACR,OAAQC,CAAA,GAIX5E,IAAgB,GACfJ,MAAC6F,GAAA,CACC,SAAA1D,EACA,YAAAC,EACA,SAAAxB,EACA,QAAAE,EACA,OAAQiE,EACR,OAAQC,CAAA,GAIX5E,IAAgB,GACfJ,MAAC8F,GAAA,CACC,SAAA3D,EACA,OAAAzB,EACA,SAAUmD,EACV,OAAQmB,EACR,SAAAC,EACA,aAAAjE,CAAA,GAIHZ,IAAgB,GACfJ,MAAC+F,GAAA,CACC,cAAA7E,EACA,SAAAiB,EACA,OAAAzB,EACA,aAAcyE,EACd,WAAAhF,CAAA,EACF,GAEJ,EACF,CAEJ,CAKA,SAASwF,GAA0B,CAAE,SAAAxD,EAAU,YAAAC,EAAa,OAAA1B,EAAQ,OAAAsF,GAAe,CAEjF,MAAMC,EAAevF,EAAO,OAAQuC,GAAWA,EAAE,OAAS,QAAQ,EAM5DiD,EAHoBxF,EAAO,OAAQuC,GAAWA,EAAE,OAAS,QAAQ,EAIpE,KAAK,CAACkD,EAAQC,IAAW,SACxB,MAAMC,EAAW,CAAC,iBAAkB,gBAAiB,QAAQ,EACvDC,EAASD,EAAS,SAAQnD,EAAAiD,EAAE,OAAF,YAAAjD,EAAQ,aAAa,EAC/CqD,EAASF,EAAS,SAAQnC,EAAAkC,EAAE,OAAF,YAAAlC,EAAQ,aAAa,EACrD,OAAIoC,IAAW,IAAMC,IAAW,GAAWD,EAASC,EAChDD,IAAW,GAAW,GACtBC,IAAW,GAAW,GAClBJ,EAAE,MAAQ,IAAI,cAAcC,EAAE,MAAQ,EAAE,CAClD,CAAC,EAEGI,EAAarE,EAAS,eAAiBA,EAAS,oBAAsBA,EAAS,cAErF,OACEpC,OAAC,OAAI,UAAU,YACb,UAAAC,MAAC,MAAG,UAAU,mCAAmC,mCAAuB,EAGxED,OAAC,OAAI,UAAU,wCACb,UAAAA,OAAC,OACC,UAAAC,MAAC,SAAM,UAAU,+CAA+C,0BAAc,EAC9ED,OAAC,UACC,MAAOoC,EAAS,cAChB,SAAWlC,GAAMmC,EAAY,CAAE,GAAGD,EAAU,cAAelC,EAAE,OAAO,MAAO,mBAAoB,GAAI,EACnG,UAAU,wFAEV,UAAAD,MAAC,UAAO,MAAM,GAAG,yBAAa,EAC7BiG,EAAa,IAAKQ,GACjBzG,MAAC,UAAsB,MAAOyG,EAAM,GAAK,SAAAA,EAAM,MAAlCA,EAAM,EAAiC,CACrD,IACH,EACF,SACC,OACC,UAAAzG,MAAC,SAAM,UAAU,+CAA+C,+BAAmB,EACnFD,OAAC,UACC,MAAOoC,EAAS,mBAChB,SAAWlC,GAAMmC,EAAY,CAAE,GAAGD,EAAU,mBAAoBlC,EAAE,OAAO,MAAO,EAChF,UAAU,wFACV,SAAU,CAACkC,EAAS,cAEpB,UAAAnC,MAAC,UAAO,MAAM,GAAG,8BAAkB,EAClCkG,EAAmB,IAAKO,GACvBzG,MAAC,UAAsB,MAAOyG,EAAM,GAAK,SAAAA,EAAM,MAAlCA,EAAM,EAAiC,CACrD,IACH,EACF,GACF,SAGC,OACC,UAAAzG,MAAC,SAAM,UAAU,+CAA+C,4BAAgB,EAChFA,MAAC,OAAI,UAAU,wCACZ,UACC,CAAE,MAAO,OAAQ,MAAO,WACxB,CAAE,MAAO,SAAU,MAAO,aAC1B,CAAE,MAAO,SAAU,MAAO,aAC1B,CAAE,MAAO,SAAU,MAAO,YAAY,EACtC,IAAI0G,GACJ1G,MAAC,UAEC,KAAK,SACL,QAAS,IAAMoC,EAAY,CAAE,GAAGD,EAAU,cAAeuE,EAAO,MAAO,EACvE,UAAW,oEAAoEvE,EAAS,gBAAkBuE,EAAO,MAC7G,iDACA,yCACF,GAED,SAAAA,EAAO,OARHA,EAAO,MAUf,EACH,GACF,SAGC,OACC,UAAA1G,MAAC,SAAM,UAAU,+CAA+C,2BAAe,EAC/EA,MAAC,OAAI,UAAU,yBACZ,UACC,CAAE,MAAO,SAAU,MAAO,kBAAmB,KAAM,gCACnD,CAAE,MAAO,cAAe,MAAO,0BAA2B,KAAM,2BAChE,CAAE,MAAO,aAAc,MAAO,4BAA6B,KAAM,6BACjE,CAAE,MAAO,WAAY,MAAO,kBAAmB,KAAM,uBAAuB,EAC5E,IAAI0G,GACJ3G,OAAC,UAEC,KAAK,SACL,QAAS,IAAMqC,EAAY,CAAE,GAAGD,EAAU,aAAcuE,EAAO,MAAO,eAAgB,EAAG,EACzF,UAAW,oDAAoDvE,EAAS,eAAiBuE,EAAO,MAC5F,iCACA,yCACF,GAEF,UAAA1G,MAAC,OAAI,UAAU,cAAe,SAAA0G,EAAO,MAAM,EAC3C1G,MAAC,OAAI,UAAU,6BAA8B,WAAO,KAAK,IATpD0G,EAAO,MAWf,EACH,GACF,EAGCvE,EAAS,eAAiB,UACzBpC,OAAC,OACC,UAAAC,MAAC,SAAM,UAAU,+CAA+C,+BAAmB,EACnFA,MAAC,SACC,KAAK,SACL,IAAI,IACJ,MAAOmC,EAAS,eAChB,SAAWlC,GAAMmC,EAAY,CAAE,GAAGD,EAAU,eAAgB,OAAOlC,EAAE,OAAO,KAAK,EAAG,EACpF,UAAU,wFACV,YAAY,yBACd,EACF,SAID,OACC,UAAAD,MAAC,SAAM,UAAU,+CAA+C,2CAA+B,EAC/FA,MAAC,YACC,MAAOmC,EAAS,mBAChB,SAAWlC,GAAMmC,EAAY,CAAE,GAAGD,EAAU,mBAAoBlC,EAAE,OAAO,MAAO,EAChF,UAAU,wFACV,KAAM,EACN,YAAY,wCACd,EACF,EAEAD,MAAC,OAAI,UAAU,mBACb,SAAAA,MAAC,UACC,QAASgG,EACT,SAAU,CAACQ,EACX,UAAU,oGACX,wBAED,CACF,GACF,CAEJ,CAKA,SAASZ,GAAmB,CAAE,SAAAzD,EAAU,YAAAC,EAAa,OAAA4D,EAAQ,OAAAW,GAAe,CAC1E,MAAM9G,EAAiBC,GAAkB,eAAe,KAAKA,CAAK,EAC5D0G,EAAarE,EAAS,YAActC,EAAcsC,EAAS,WAAW,EAE5E,OACEpC,OAAC,OAAI,UAAU,YACb,UAAAC,MAAC,MAAG,UAAU,mCAAmC,kCAAsB,EACvEA,MAAC,KAAE,UAAU,gBAAgB,8DAAkD,EAE/EA,MAAClC,GAAA,CACC,UAAWqE,EAAS,WACpB,WAAYA,EAAS,YACrB,aAAeyE,GAAUxE,EAAY,CAAE,GAAGD,EAAU,WAAYyE,EAAO,EACvE,cAAgBA,GAAUxE,EAAY,CAAE,GAAGD,EAAU,YAAayE,EAAO,EACzE,gBAAkBhH,GAAYwC,EAAY,CAAE,GAAGD,EAAU,WAAYvC,EAAQ,KAAM,YAAaA,EAAQ,MAAO,EAC/G,UAAU,cACV,WAAW,eACX,gBAAgB,uBAChB,iBAAiB,kBACjB,SAAQ,KAGVG,OAAC,OAAI,UAAU,uBACb,UAAAC,MAAC,UACC,QAAS2G,EACT,UAAU,+EACX,wBAGD3G,MAAC,UACC,QAASgG,EACT,SAAU,CAACQ,EACX,UAAU,oGACX,wBAED,EACF,GACF,CAEJ,CAKA,SAASX,GAAuB,CAAE,SAAA1D,EAAU,YAAAC,EAAa,SAAAxB,EAAU,QAAAE,EAAS,OAAAkF,EAAQ,OAAAW,GAAe,CACjG,MAAM9G,EAAiBC,GAAkB,eAAe,KAAKA,CAAK,EAC5D+G,EAAkB,CAAC,cAAe,aAAc,UAAU,EAAE,SAAS1E,EAAS,YAAY,EAE1F2E,EAAmBC,GAAsB,OAC7C,MAAMC,EAAalG,EAAQ,KACxBmG,GAAWA,EAAE,YAAcF,GAAaE,EAAE,UAAY9E,EAAS,oBAElE,OAAO6E,GAAA,YAAAA,EAAY,UAAS9D,EAAAtC,EAAS,KAAMqG,GAAWA,EAAE,KAAOF,CAAS,IAA5C,YAAA7D,EAA+C,YAAa,CAC1F,EAGMgE,EAAiB,CAAC,GAAGtG,CAAQ,EAAE,KAAK,CAACuF,EAAQC,IAAW,SAC5D,MAAMC,EAAW,CAAC,OAAQ,MAAO,OAAQ,MAAO,OAAQ,MAAO,OAAQ,KAAK,EACtEc,IAAQjE,EAAAiD,EAAE,OAAF,YAAAjD,EAAQ,gBAAiB,GACjCkE,IAAQlD,EAAAkC,EAAE,OAAF,YAAAlC,EAAQ,gBAAiB,GACjCoC,EAASD,EAAS,aAAec,EAAM,SAASF,CAAC,CAAC,EAClDV,EAASF,EAAS,aAAee,EAAM,SAASH,CAAC,CAAC,EACxD,OAAIX,IAAW,IAAMC,IAAW,GAAWD,EAASC,EAChDD,IAAW,GAAW,GACtBC,IAAW,GAAW,EACnBY,EAAM,cAAcC,CAAK,CAClC,CAAC,EAEKC,EAAiB,CAAC5B,EAAe6B,EAAeV,IAAe,CACnE,MAAMW,EAAe,CAAC,GAAGpF,EAAS,SAAS,EAC3CoF,EAAa9B,CAAK,EAAI,CAAE,GAAG8B,EAAa9B,CAAK,EAAG,CAAC6B,CAAK,EAAGV,CAAA,EACzDxE,EAAY,CAAE,GAAGD,EAAU,UAAWoF,EAAc,CACtD,EAEMC,EAAwB,CAACC,EAAuBV,EAAmBW,IAAqB,CAC5F,MAAMH,EAAe,CAAC,GAAGpF,EAAS,SAAS,EACrCwB,EAAW4D,EAAaE,CAAa,EACrC7D,EAAMhD,EAAS,KAAMqG,GAAWA,EAAE,KAAOF,CAAS,EAClDY,EAAQb,EAAgBC,CAAS,EAEjCa,EAAgBjE,EAAS,SAAS,UAAWsD,GAAWA,EAAE,YAAcF,CAAS,EAEvF,GAAIW,EAAW,EAAG,CAChB,MAAMG,EAAU,CAAE,UAAAd,EAAW,MAAMnD,GAAA,YAAAA,EAAK,OAAQ,SAAU,SAAA8D,EAAU,MAAAC,CAAA,EAChEC,GAAiB,EACnBjE,EAAS,SAASiE,CAAa,EAAIC,EAEnClE,EAAS,SAAS,KAAKkE,CAAO,CAElC,MAAWD,GAAiB,GAC1BjE,EAAS,SAAS,OAAOiE,EAAe,CAAC,EAG3CxF,EAAY,CAAE,GAAGD,EAAU,UAAWoF,EAAc,CACtD,EAGMO,EAAmC,CAACL,EAAuBV,EAAmBgB,IAAwB,CAC1G,MAAMR,EAAe,CAAC,GAAGpF,EAAS,SAAS,EACrCwB,EAAW4D,EAAaE,CAAa,EACrCG,EAAgBjE,EAAS,SAAS,UAAWsD,GAAWA,EAAE,YAAcF,CAAS,EACnFa,GAAiB,IACnBjE,EAAS,SAASiE,CAAa,EAAE,YAAcG,EAC/C3F,EAAY,CAAE,GAAGD,EAAU,UAAWoF,EAAc,EAExD,EAEMS,EAAgC,CAACP,EAAuBV,IAAsB,SAClF,MAAMnD,GAAMM,GAAAhB,EAAAf,EAAS,UAAUsF,CAAa,IAAhC,YAAAvE,EAAmC,WAAnC,YAAAgB,EAA6C,KAAM+C,GAAWA,EAAE,YAAcF,GAC1F,OAAOnD,GAAA,YAAAA,EAAK,cAAe,EAC7B,EAEMqE,EAAkBC,IACfA,GAAA,YAAAA,EAAS,iBAAkB,QAG9BC,EAA6B,CAACV,EAAuBV,IAAsB,SAC/E,MAAMnD,GAAMM,GAAAhB,EAAAf,EAAS,UAAUsF,CAAa,IAAhC,YAAAvE,EAAmC,WAAnC,YAAAgB,EAA6C,KAAM+C,GAAWA,EAAE,YAAcF,GAC1F,OAAOnD,GAAA,YAAAA,EAAK,WAAY,CAC1B,EAEMwE,EAAc,IAAM,CACxBhG,EAAY,CACV,GAAGD,EACH,UAAW,CAAC,GAAGA,EAAS,UAAW,CAAE,KAAM,GAAI,MAAO,GAAI,QAAS,GAAI,SAAU,GAAI,EACtF,CACH,EAEMkG,EAAkB5C,GAAkB,CACxC,GAAItD,EAAS,UAAU,OAAS,EAAG,CACjC,MAAMoF,EAAepF,EAAS,UAAU,OAAO,CAACmG,EAAQC,IAAcA,IAAM9C,CAAK,EACjFrD,EAAY,CAAE,GAAGD,EAAU,UAAWoF,EAAc,CACtD,CACF,EAEMiB,EAAuB7E,GACpBA,EAAS,SAAS,OAAO,CAAC8E,EAAK7E,IAAQ6E,EAAO7E,EAAI,SAAWA,EAAI,MAAQ,CAAC,EAG7E4C,EAAarE,EAAS,UAAU,MAAOuG,GAC3CA,EAAE,MAAQ7I,EAAc6I,EAAE,KAAK,GAAKA,EAAE,SAAS,OAAS,IAAM,CAAC7B,GAAmB6B,EAAE,UAGtF,OACE3I,OAAC,OAAI,UAAU,YACb,UAAAC,MAAC,MAAG,UAAU,mCAAmC,wCAA4B,EAC7EA,MAAC,KAAE,UAAU,gBAAgB,sEAA0D,EAEtFmC,EAAS,UAAU,IAAI,CAACwB,EAAoB8D,IAC3C1H,OAAC,OAAwB,UAAU,+DACjC,UAAAA,OAAC,OAAI,UAAU,kDACb,UAAAA,OAAC,MAAG,UAAU,kCAAkC,sBAAU0H,EAAgB,GAAE,EAC3EtF,EAAS,UAAU,OAAS,GAC3BnC,MAAC,UACC,QAAS,IAAMqI,EAAeZ,CAAa,EAC3C,UAAU,sDACX,mBAED,EAEJ,EAGAzH,MAAClC,GAAA,CACC,UAAW6F,EAAS,KACpB,WAAYA,EAAS,MACrB,aAAeiD,GAAUS,EAAeI,EAAe,OAAQb,CAAK,EACpE,cAAgBA,GAAUS,EAAeI,EAAe,QAASb,CAAK,EACtE,gBAAkBhH,GAAY,CAC5B,MAAM2H,EAAe,CAAC,GAAGpF,EAAS,SAAS,EAC3CoF,EAAaE,CAAa,EAAI,CAC5B,GAAGF,EAAaE,CAAa,EAC7B,KAAM7H,EAAQ,KACd,MAAOA,EAAQ,OAEjBwC,EAAY,CAAE,GAAGD,EAAU,UAAWoF,EAAc,CACtD,EACA,UAAU,gBACV,WAAW,iBACX,gBAAgB,uBAChB,iBAAiB,kBACjB,SAAQ,KAITV,UACE,OACC,UAAA7G,MAAC,SAAM,UAAU,+CAA+C,8BAAkB,EAClFA,MAAC,YACC,MAAO2D,EAAS,QAChB,SAAW1D,GAAMoH,EAAeI,EAAe,UAAWxH,EAAE,OAAO,KAAK,EACxE,UAAU,wFACV,KAAM,EACN,YAAY,8BACZ,SAAQ,IACV,EACF,SAID,OACC,UAAAD,MAAC,MAAG,UAAU,mCAAmC,8BAAkB,QAClE,OAAI,UAAU,uDACZ,SAAAkH,EAAe,IAAKtD,GAAa,CAChC,MAAM+D,EAAQb,EAAgBlD,EAAI,EAAE,EAC9B8D,EAAWS,EAA2BV,EAAe7D,EAAI,EAAE,EAC3D+E,EAAUV,EAAerE,EAAI,IAAI,EACjCmE,EAAcC,EAA8BP,EAAe7D,EAAI,EAAE,EACvE,OACE7D,OAAC,OAAiB,UAAW,4EAA4E4I,GAAWjB,EAAW,EAAI,kCAAoC,iBAAiB,GACtL,UAAA1H,MAAC,OAAI,UAAU,oCAAqC,SAAA4D,EAAI,KAAK,EAC7D7D,OAAC,OAAI,UAAU,6BAA6B,cAAE4H,EAAM,SAAK,EACzD5H,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC,SACC,KAAK,SACL,IAAI,IACJ,MAAO0H,EAAW,EAAIA,EAAW,GACjC,YAAY,IACZ,SAAWzH,GAAMuH,EAAsBC,EAAe7D,EAAI,GAAI,OAAO3D,EAAE,OAAO,KAAK,GAAK,CAAC,EACzF,UAAW,gFAAgFyH,EAAW,EAAI,iCAAmC,+BAC3I,KAEHA,EAAW,GACV3H,OAAC,QAAK,UAAU,qCAAqC,eAChD2H,EAAWC,GAAO,QAAQ,CAAC,GAChC,GAEJ,EAECgB,GAAWjB,EAAW,GACrB1H,MAAC,OAAI,UAAU,OACb,SAAAA,MAAC,SACC,KAAK,OACL,MAAO+H,EACP,SAAW9H,GAAM6H,EAAiCL,EAAe7D,EAAI,GAAI3D,EAAE,OAAO,KAAK,EACvF,UAAU,gGACV,YAAY,0DACd,CACF,IA7BM2D,EAAI,EA+Bd,CAEJ,CAAC,EACH,GACF,QAGC,OAAI,UAAU,uDACb,SAAA7D,OAAC,OAAI,UAAU,oCACb,UAAAA,OAAC,QAAK,UAAU,cAAc,0BAAc4D,EAAS,MAAQ,YAAY8D,EAAgB,CAAC,GAAG,KAAC,EAC9F1H,OAAC,QAAK,UAAU,oCAAoC,cAAEyI,EAAoB7E,CAAQ,EAAE,QAAQ,CAAC,GAAE,GACjG,EACF,IAvGQ8D,CAwGV,CACD,EAEDzH,MAAC,UACC,QAASoI,EACT,UAAU,0JACX,oCAIDrI,OAAC,OAAI,UAAU,uBACb,UAAAC,MAAC,UACC,QAAS2G,EACT,UAAU,+EACX,wBAGD3G,MAAC,UACC,QAASgG,EACT,SAAU,CAACQ,EACX,UAAU,oGACX,6BAED,EACF,GACF,CAEJ,CAKA,SAASV,GAAa,CAAE,SAAA3D,EAAU,OAAAzB,EAAQ,SAAAkI,EAAU,OAAAjC,EAAQ,SAAA1B,EAAU,aAAAjE,GAAqB,SACzF,MAAM6H,EAAcnI,EAAO,KAAMuC,GAAWA,EAAE,KAAOd,EAAS,aAAa,EACrE2G,EAAmBpI,EAAO,KAAMuC,GAAWA,EAAE,KAAOd,EAAS,kBAAkB,EAE/E4G,EAAgB5G,EAAS,UAAU,OAAO,CAACsG,EAAa9E,IACrD8E,EAAM9E,EAAS,SAAS,OAAO,CAACqF,EAAcpF,IAAaoF,EAAQpF,EAAI,SAAWA,EAAI,MAAQ,CAAC,EACrG,CAAC,EACEqF,EAAaF,GAAiB5G,EAAS,gBAAkB,GAE/D,OACEpC,OAAC,OAAI,UAAU,YACb,UAAAC,MAAC,MAAG,UAAU,mCAAmC,oCAAwB,EAGzED,OAAC,OAAI,UAAU,4BACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAC,MAAC,MAAG,UAAU,8BAA8B,oBAAQ,EACpDA,MAAC,UAAO,QAAS,IAAMiF,EAAS,CAAC,EAAG,UAAU,0CAA0C,gBAAI,GAC9F,SACC,KAAG,UAAA4D,GAAA,YAAAA,EAAa,KAAK,MAAIC,GAAA,YAAAA,EAAkB,MAAK,EACjD/I,OAAC,KAAE,UAAU,wBAAwB,uBAAUmD,EAAAf,EAAS,gBAAT,YAAAe,EAAwB,cAAc,iBAAcgB,EAAA/B,EAAS,eAAT,YAAA+B,EAAuB,QAAQ,IAAK,IAAG,EAAE,GAC9I,EAGAnE,OAAC,OAAI,UAAU,4BACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAC,MAAC,MAAG,UAAU,8BAA8B,qBAAS,EACrDA,MAAC,UAAO,QAAS,IAAMiF,EAAS,CAAC,EAAG,UAAU,0CAA0C,gBAAI,GAC9F,SACC,KAAG,UAAA9C,EAAS,WAAW,KAAGA,EAAS,YAAY,KAAC,GACnD,EAGApC,OAAC,OAAI,UAAU,4BACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAC,MAAC,MAAG,UAAU,8BAA8B,mCAAuB,EACnEA,MAAC,UAAO,QAAS,IAAMiF,EAAS,CAAC,EAAG,UAAU,0CAA0C,gBAAI,GAC9F,EACC9C,EAAS,UAAU,IAAI,CAACwB,EAAe8B,IACtC1F,OAAC,OAAgB,UAAU,yCACzB,UAAAA,OAAC,KAAE,UAAU,cAAe,UAAA4D,EAAS,KAAK,KAAGA,EAAS,MAAM,KAAC,EAC5DA,EAAS,SAAW3D,MAAC,KAAE,UAAU,wBAAyB,WAAS,QAAQ,EAC5EA,MAAC,OAAI,UAAU,iBACZ,SAAA2D,EAAS,SAAS,IAAI,CAACC,EAAUsF,IAChCnJ,OAAC,OAAmB,UAAU,+BAC5B,UAAAA,OAAC,QAAM,UAAA6D,EAAI,KAAK,MAAIA,EAAI,UAAS,SAChC,QAAK,eAAGA,EAAI,SAAWA,EAAI,OAAO,QAAQ,CAAC,GAAE,IAFtCsF,CAGV,CACD,EACH,IAVQzD,CAWV,CACD,GACH,EAGA1F,OAAC,OAAI,UAAU,uDACb,UAAAA,OAAC,OAAI,UAAU,oCACb,UAAAC,MAAC,QAAK,6BAAiB,SACtB,QAAK,cAAE+I,EAAc,QAAQ,CAAC,GAAE,GACnC,EACC5G,EAAS,eAAiB,GACzBpC,OAAC,OAAI,UAAU,oCACb,UAAAC,MAAC,QAAK,2BAAe,SACpB,QAAK,cAAEmC,EAAS,eAAe,QAAQ,CAAC,GAAE,GAC7C,EAEFpC,OAAC,OAAI,UAAU,8EACb,UAAAC,MAAC,QAAK,wBAAY,EAClBD,OAAC,QAAK,UAAU,kBAAkB,cAAEkJ,EAAW,QAAQ,CAAC,GAAE,GAC5D,GACF,EAEAlJ,OAAC,OAAI,UAAU,uBACb,UAAAC,MAAC,UACC,QAAS2G,EACT,UAAU,+EACX,wBAGD3G,MAAC,UACC,QAAS4I,EACT,SAAU5H,EACV,UAAU,kGAET,WAAe,cAAgB,qBAClC,EACF,GACF,CAEJ,CAKA,SAAS+E,GAAkB,CAAE,cAAA7E,EAAe,SAAAiB,EAAU,OAAAzB,EAAQ,aAAAyI,EAAc,WAAAhJ,GAAmB,CAC7F,MAAM0I,EAAcnI,GAAA,YAAAA,EAAQ,KAAMuC,GAAWA,EAAE,MAAOd,GAAA,YAAAA,EAAU,gBAC1D2G,EAAmBpI,GAAA,YAAAA,EAAQ,KAAMuC,GAAWA,EAAE,MAAOd,GAAA,YAAAA,EAAU,qBAG/DiH,EAAYlI,GAAA,YAAAA,EAAe,WAAW,YACtCe,EAAoBC,GAAcF,GAAUA,EAAM,iBAAiB,EACnEF,EAAWC,GAAgBC,GAAUA,EAAM,QAAQ,EAGnDqH,EAAcD,EAAYlI,EAAc,QAAQ,WAAY,EAAE,EAAE,cAAgB,KAChFoI,EAAYD,EACdpH,EAAkB,KAAKsD,GAAMA,EAAG,GAAG,cAAc,SAAS8D,CAAW,CAAC,EACtE,KAEE5F,EAAiB,IAChBtB,GAAA,MAAAA,EAAU,UACRA,EAAS,UAAU,OAAO,CAACsG,EAAa9E,IACtC8E,GAAO9E,EAAS,UAAY,IAAI,OAAO,CAACqF,EAAcpF,IAAaoF,EAAQpF,EAAI,SAAWA,EAAI,MAAQ,CAAC,EAC7G,CAAC,GAAKzB,EAAS,gBAAkB,GAHH,EAM7BoH,EAAsB,IAAM,OAChC,MAAMC,EAAQ,CACZ,wBACA,yBACA,YAAYtI,CAAa,GACzB,SAAS,IAAI,OAAO,mBAAmB,OAAO,CAAC,GAC/C,GACA,iBACA,IAAG4H,GAAA,YAAAA,EAAkB,OAAQ,KAAK,GAClC,GACA,YACA,KAAI3G,GAAA,YAAAA,EAAU,aAAc,KAAK,OAAMA,GAAA,YAAAA,EAAU,cAAe,KAAK,IACrE,GACA,2BAGF,OAAAe,EAAAf,GAAA,YAAAA,EAAU,YAAV,MAAAe,EAAqB,QAAQ,CAACS,EAAe,IAAc,OACzD6F,EAAM,KAAK;AAAA,EAAK,EAAI,CAAC,KAAK7F,EAAS,IAAI,KAAKA,EAAS,KAAK,GAAG,GAC7DT,EAAAS,EAAS,WAAT,MAAAT,EAAmB,QAASU,GAAa,CACvC4F,EAAM,KAAK,QAAQ5F,EAAI,IAAI,MAAMA,EAAI,QAAQ,QAAQA,EAAI,SAAWA,EAAI,OAAO,QAAQ,CAAC,CAAC,EAAE,CAC7F,EACF,GAEA4F,EAAM,KAAK;AAAA,uBAA0B,EACrCA,EAAM,KAAK,cAAc/F,EAAA,EAAiB,QAAQ,CAAC,CAAC,EAAE,EACtD+F,EAAM,KAAK;AAAA,8CAAiD,EAErDA,EAAM,KAAK;AAAA,CAAI,CACxB,EAEMC,EAAsB,IAAM,CAChC,MAAMC,EAAO,mBAAmBH,GAAqB,EACrD,OAAO,KAAK,uBAAuBG,CAAI,GAAI,QAAQ,CACrD,EAEMC,EAAoB,SAAY,WAEpC,KAAM,CAAE,MAAAC,CAAA,EAAU,MAAAC,GAAA,sBAAAD,CAAA,OAAM,QAAO,0BAAO,OAAAE,KAAA,gBAAAF,CAAA,OAEhCG,EAAM,IAAIH,EAAM,CAAE,OAAQ,KAAM,KAAM,KAAM,YAAa,YAAa,EACtEI,EAAYD,EAAI,SAAS,SAAS,WAClCE,EAAaF,EAAI,SAAS,SAAS,YACnCG,EAAS,GACf,IAAIC,EAAI,GAGRJ,EAAI,YAAY,EAAE,EAClBA,EAAI,QAAQ,YAAa,MAAM,EAC/BA,EAAI,aAAa,EAAG,EAAG,CAAC,EACxBA,EAAI,KAAK,qBAAsBC,EAAY,EAAGG,EAAG,CAAE,MAAO,SAAU,EACpEA,GAAK,EAGLJ,EAAI,YAAY,CAAC,EACjBA,EAAI,QAAQ,YAAa,QAAQ,EACjCA,EAAI,aAAa,GAAI,GAAI,EAAE,EAC3BA,EAAI,KAAK,+EAAgFC,EAAY,EAAGG,EAAG,CAAE,MAAO,SAAU,EAC9HJ,EAAI,aAAa,EAAG,EAAG,CAAC,EACxBI,GAAK,EAGLJ,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,aAAa,EAAG,EACpBA,EAAI,KAAKG,EAAQC,EAAGH,EAAYE,EAAQC,CAAC,EACzCA,GAAK,EAGLJ,EAAI,YAAY,EAAE,EAClBA,EAAI,QAAQ,YAAa,MAAM,EAC/BA,EAAI,KAAK,eAAe7I,CAAa,GAAIgJ,EAAQC,CAAC,EAClDJ,EAAI,QAAQ,YAAa,QAAQ,EACjCA,EAAI,KAAK,SAAS,IAAI,OAAO,mBAAmB,OAAO,CAAC,GAAIC,EAAYE,EAAQC,EAAG,CAAE,MAAO,QAAS,EACrGA,GAAK,EAGLJ,EAAI,YAAY,EAAE,EAClBA,EAAI,QAAQ,YAAa,MAAM,EAC/BA,EAAI,KAAK,iBAAgBjB,GAAA,YAAAA,EAAkB,OAAQ,KAAK,GAAIoB,EAAQC,CAAC,EACrEA,GAAK,EAGLJ,EAAI,YAAY,EAAE,EAClBA,EAAI,QAAQ,YAAa,QAAQ,EACjCA,EAAI,KAAK,YAAW5H,GAAA,YAAAA,EAAU,aAAc,KAAK,MAAKA,GAAA,YAAAA,EAAU,cAAe,KAAK,IAAK+H,EAAQC,CAAC,EAClGA,GAAK,EAGL,MAAMC,EAAcF,EACdG,EAAaL,EAAa,EAAII,EAC9BE,EAAY,CAChB,KAAM,GACN,SAAU,GACV,YAAa,GACb,IAAK,EAEP,EACMC,EAAY,EACZC,EAAOP,EAAa,GAG1BF,EAAI,aAAa,GAAI,GAAI,EAAE,EAC3BA,EAAI,KAAKK,EAAaD,EAAGE,EAAYE,EAAW,GAAG,EACnDR,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,YAAY,CAAC,EACjBA,EAAI,QAAQ,YAAa,MAAM,EAE/B,IAAIU,EAAOL,EAAc,EACzBL,EAAI,KAAK,MAAOU,EAAMN,EAAI,CAAC,EAC3BM,GAAQH,EAAU,KAClBP,EAAI,KAAK,WAAYU,EAAMN,EAAI,CAAC,EAChCM,GAAQH,EAAU,SAClBP,EAAI,KAAK,eAAgBU,EAAMN,EAAI,CAAC,EACpCM,GAAQH,EAAU,YAClBP,EAAI,KAAK,MAAOU,EAAMN,EAAI,CAAC,EAC3BM,GAAQH,EAAU,IAClBP,EAAI,KAAK,SAAUU,EAAMN,EAAI,CAAC,EAC9BA,GAAKI,EAGLR,EAAI,aAAa,EAAG,EAAG,CAAC,EACxBA,EAAI,QAAQ,YAAa,QAAQ,EACjC,IAAIW,EAAW,EACXzB,EAAa,GAEjB/F,EAAAf,GAAA,YAAAA,EAAU,YAAV,MAAAe,EAAqB,QAAQ,CAACS,EAAe8D,IAA0B,CACjE9D,EAAS,UAAYA,EAAS,SAAS,OAAS,GAClDA,EAAS,SAAS,QAAQ,CAACC,EAAUsF,IAAqB,CACpDiB,EAAIK,IACNT,EAAI,UACJI,EAAI,IAGNO,IACA,MAAMC,EAAS/G,EAAI,SAAWA,EAAI,MAClCqF,GAAc0B,EAGVD,EAAW,IAAM,IACnBX,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,KAAKK,EAAaD,EAAGE,EAAYE,EAAW,GAAG,GAIrDR,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9B,MAAMa,EAAmB1B,IAAa,EAAIqB,EAAY,EAAIA,EAS1D,GARAR,EAAI,KAAKK,EAAaD,EAAGE,EAAYO,EAAkB,GAAG,EAE1Db,EAAI,YAAY,CAAC,EACjBU,EAAOL,EAAc,EACrBL,EAAI,KAAK,GAAGW,CAAQ,GAAID,EAAMN,EAAI,CAAC,EACnCM,GAAQH,EAAU,KAGdpB,IAAa,EAAG,CAClB,MAAM2B,EAAkB,GAAGlH,EAAS,MAAQ,KAAK,GAAG,UAAU,EAAG,EAAE,EACnEoG,EAAI,QAAQ,YAAa,MAAM,EAC/BA,EAAI,KAAKc,EAAiBJ,EAAMN,EAAI,CAAC,EAErCJ,EAAI,YAAY,CAAC,EACjBA,EAAI,QAAQ,YAAa,QAAQ,EACjCA,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,KAAK,GAAGpG,EAAS,OAAS,EAAE,GAAI8G,EAAMN,EAAI,CAAC,EAC/CJ,EAAI,aAAa,EAAG,EAAG,CAAC,EACxBA,EAAI,YAAY,CAAC,CACnB,CACAU,GAAQH,EAAU,SAClBP,EAAI,KAAKnG,EAAI,MAAQ,MAAO6G,EAAMN,EAAI,CAAC,EACvCM,GAAQH,EAAU,YAClBP,EAAI,KAAK,GAAGnG,EAAI,QAAQ,GAAI6G,EAAMN,EAAI,CAAC,EACvCM,GAAQH,EAAU,IAClBP,EAAI,KAAK,IAAIY,EAAO,QAAQ,CAAC,CAAC,GAAIF,EAAMN,EAAI,CAAC,EAC7CA,GAAKS,CACP,CAAC,CAEL,IAGIzI,GAAA,YAAAA,EAAU,gBAAiB,IACzBgI,EAAIK,IACNT,EAAI,UACJI,EAAI,IAENO,IACAzB,GAAc9G,EAAS,eAEvB4H,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,KAAKK,EAAaD,EAAGE,EAAYE,EAAW,GAAG,EACnDR,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,KAAKK,EAAaD,EAAGE,EAAYE,EAAW,GAAG,EAEnDR,EAAI,YAAY,CAAC,EACjBU,EAAOL,EAAc,EACrBL,EAAI,KAAK,GAAGW,CAAQ,GAAID,EAAMN,EAAI,CAAC,EACnCM,GAAQH,EAAU,KAClBP,EAAI,QAAQ,YAAa,QAAQ,EACjCA,EAAI,KAAK,kBAAmBU,EAAMN,EAAI,CAAC,EACvCJ,EAAI,QAAQ,YAAa,QAAQ,EACjCU,GAAQH,EAAU,SAAWA,EAAU,YACvCP,EAAI,KAAK,IAAKU,EAAMN,EAAI,CAAC,EACzBM,GAAQH,EAAU,IAClBP,EAAI,KAAK,IAAI5H,EAAS,eAAe,QAAQ,CAAC,CAAC,GAAIsI,EAAMN,EAAI,CAAC,EAC9DA,GAAKI,GAIPR,EAAI,aAAa,GAAI,GAAI,EAAE,EAC3BA,EAAI,KAAKK,EAAaD,EAAGE,EAAYE,EAAY,EAAG,GAAG,EACvDR,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,YAAY,EAAE,EAClBA,EAAI,QAAQ,YAAa,MAAM,EAE/B,MAAMe,IAAoB1G,GAAAF,EAAA/B,GAAA,YAAAA,EAAU,gBAAV,YAAA+B,EAAyB,QAAQ,IAAK,OAAtC,YAAAE,EAA4C,gBAAiB,OACvF2F,EAAI,KAAK,YAAYe,CAAiB,GAAIV,EAAc,EAAGD,EAAI,CAAC,EAEhE,MAAMY,EAAYX,EAAcE,EAAU,KAAOA,EAAU,SAAWA,EAAU,YAAcA,EAAU,IAAM,EAC9GP,EAAI,KAAK,WAAWd,EAAW,QAAQ,CAAC,CAAC,GAAI8B,EAAWZ,EAAI,CAAC,EAC7DA,GAAKI,EAAY,EACjBR,EAAI,aAAa,EAAG,EAAG,CAAC,EAGxBA,EAAI,YAAY,CAAC,EACjBA,EAAI,QAAQ,YAAa,QAAQ,EACjCA,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,KAAK,6CAA8CC,EAAY,EAAGG,EAAG,CAAE,MAAO,SAAU,EAC5FJ,EAAI,aAAa,EAAG,EAAG,CAAC,EACxBI,GAAK,GAGL,MAAMa,EAAgB,GAChBC,EAAYjB,EAAYE,EAASc,EACvCjB,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,aAAa,EAAG,EACpBA,EAAI,KAAKkB,EAAWd,EAAGc,EAAYD,EAAeb,CAAC,EACnDA,GAAK,EACLJ,EAAI,YAAY,CAAC,EACjBA,EAAI,QAAQ,YAAa,QAAQ,EACjCA,EAAI,KAAK,uBAAwBkB,EAAYD,EAAgB,EAAGb,EAAG,CAAE,MAAO,SAAU,EAEtFJ,EAAI,KAAK,GAAG7I,CAAa,MAAM,CACjC,EAEMgK,EAAoB,IAAM,CAC9B,UAAU,UAAU,UAAUhK,CAAa,EAC3C,MAAM,wBAAwB,CAChC,EAEMiK,EAAsB,IAAM,CAC5BhL,EACFA,EAAW,WAAW,EAEtB,OAAO,SAAS,QAEpB,EAEA,OACEJ,OAAC,OAAI,UAAU,6BAEZ,UAAAqJ,EACCrJ,OAAAqL,WAAA,CACE,UAAApL,MAAC,OAAI,UAAU,WAAY,UAAAsJ,GAAA,YAAAA,EAAW,UAAW,UAAY,MAAOA,GAAA,YAAAA,EAAW,UAAW,SAAW,KAAO,IAAI,EAChHtJ,MAAC,MAAG,UAAU,mCACX,UAAAsJ,GAAA,YAAAA,EAAW,UAAW,UAAY,sBACjCA,GAAA,YAAAA,EAAW,UAAW,SAAW,cAC/B,wBACN,EACAtJ,MAAC,KAAE,UAAU,gBACV,SAAA8B,GACGwH,GAAA,YAAAA,EAAW,UAAW,SACpB,iFACA,yCACF,uEACN,EAEAvJ,OAAC,OAAI,UAAW,2CAA0CuJ,GAAA,YAAAA,EAAW,UAAW,SAAW,2BAA6B,8BACtH,GACA,UAAAtJ,MAAC,KAAE,UAAU,6BAA6B,+BAAmB,EAC7DA,MAAC,KAAE,UAAW,uBAAsBsJ,GAAA,YAAAA,EAAW,UAAW,SAAW,eAAiB,gBAAgB,GACnG,SAAApI,CAAA,CACH,EACAnB,OAAC,KAAE,UAAU,6BACV,WAAAuJ,GAAA,YAAAA,EAAW,UAAW,WAAa,oBACnCA,GAAA,YAAAA,EAAW,UAAW,WAAaxH,GAAY,wBAC/CwH,GAAA,YAAAA,EAAW,UAAW,WAAa,CAACxH,GAAY,4BAChDwH,GAAA,YAAAA,EAAW,UAAW,UAAY,KAAKA,EAAU,OAAS,aAAa,IAC1E,GACF,GACF,EAEAvJ,OAAAqL,WAAA,CACE,UAAApL,MAAC,OAAI,UAAU,WAAW,aAAC,EAC3BA,MAAC,MAAG,UAAU,mCAAmC,yCAA6B,EAC9EA,MAAC,KAAE,UAAU,gBAAgB,qDAAyC,EAEtED,OAAC,OAAI,UAAU,sEACb,UAAAC,MAAC,KAAE,UAAU,6BAA6B,0BAAc,EACxDA,MAAC,KAAE,UAAU,oCAAqC,SAAAkB,EAAc,QAC/D,UAAO,QAASgK,EAAmB,UAAU,8CAA8C,mBAE5F,GACF,GACF,EAGFnL,OAAC,OAAI,UAAU,8DACb,UAAAA,OAAC,OAAI,UAAU,oCACb,UAAAC,MAAC,QAAK,kBAAM,EACZD,OAAC,QAAK,UAAU,cAAe,UAAA8I,GAAA,YAAAA,EAAa,KAAK,MAAIC,GAAA,YAAAA,EAAkB,MAAK,GAC9E,EACA/I,OAAC,OAAI,UAAU,oCACb,UAAAC,MAAC,QAAK,mBAAO,EACbA,MAAC,QAAK,UAAU,cAAe,0BAAU,WAAW,GACtD,EACAD,OAAC,OAAI,UAAU,oDACb,UAAAC,MAAC,QAAK,kBAAM,EACZD,OAAC,QAAK,UAAWqJ,EAAY,iBAAmB,iBAAkB,cAAE3F,EAAA,EAAiB,QAAQ,CAAC,GAAE,GAClG,GACF,EAEA1D,OAAC,OAAI,UAAU,4CACZ,WAACqJ,GACArJ,OAAC,OAAI,UAAU,aACb,UAAAC,MAAC,UAAO,QAASyJ,EAAqB,UAAU,gFAAgF,uBAEhI,QACC,UAAO,QAASE,EAAmB,UAAU,8EAA8E,2BAE5H,GACF,EAEDP,GACCpJ,MAAC,OAAI,UAAU,mDAAmD,2EAElE,QAED,UAAO,QAASmJ,EAAc,UAAU,2EAA2E,gCAEpH,QACC,UAAO,QAASgC,EAAqB,UAAU,0EAA0E,8BAE1H,GACF,GACF,CAEJ","names":["ContactAutocomplete","nameValue","phoneValue","onNameChange","onPhoneChange","onContactSelect","nameLabel","phoneLabel","namePlaceholder","phonePlaceholder","required","suggestions","setSuggestions","useState","showDropdown","setShowDropdown","activeField","setActiveField","isLoading","setIsLoading","dropdownRef","useRef","useEffect","query","timer","contacts","contactsApi","handleClickOutside","event","handleSelectContact","contact","validatePhone","phone","jsxs","jsx","e","NewBooking","onNavigate","currentStep","setCurrentStep","season","setSeason","isSeasonActive","setIsSeasonActive","depots","setDepots","packages","setPackages","pricing","setPricing","isSubmitting","setIsSubmitting","receiptNumber","setReceiptNumber","showDraftPrompt","setShowDraftPrompt","draft","hasDraft","saveDraft","clearDraft","lastSavedAt","pendingBookingId","setPendingBookingId","useBookingStore","isOnline","useOnlineStore","state","pendingOperations","useSyncStore","formData","setFormData","timeoutId","loadInitialData","depotsRes","packagesRes","pricingRes","seasonRes","depotsApi","packagesApi","depotPricingApi","seasonApi","loadedDepots","devgadDepot","d","_a","prev","today","startDate","endDate","isActive","error","calculateTotal","total","receiver","pkg","handleSubmit","bookingData","result","bookingsApi","newReceiptNumber","_b","errorMessage","_c","operationId","queueOperation","touchStartX","touchStartY","handleTouchStart","handleTouchEnd","touchEndX","touchEndY","deltaX","deltaY","nextStep","prevStep","goToStep","step","resetForm","restoreDraft","dismissDraft","stepLabels","op","label","index","React","Step1DepotPaymentDelivery","Step2SenderDetails","Step3ReceiversPackages","Step4Summary","Step5Confirmation","onNext","originDepots","sortedDestinations","a","b","priority","aIndex","bIndex","canProceed","depot","option","onPrev","value","requiresAddress","getPackagePrice","packageId","priceEntry","p","sortedPackages","aName","bName","updateReceiver","field","newReceivers","updateReceiverPackage","receiverIndex","quantity","price","existingIndex","pkgData","updateReceiverPackageDescription","description","getReceiverPackageDescription","isOtherPackage","pkgName","getReceiverPackageQuantity","addReceiver","removeReceiver","_","i","getReceiverSubtotal","sum","r","isOther","onSubmit","originDepot","destinationDepot","packagesTotal","rSum","grandTotal","pkgIndex","onNewBooking","isPending","pendingOpId","pendingOp","generateReceiptText","lines","handleWhatsAppShare","text","handleDownloadPDF","jsPDF","__vitePreload","n","doc","pageWidth","pageHeight","margin","y","tableMargin","tableWidth","colWidths","rowHeight","maxY","xPos","rowIndex","amount","currentRowHeight","receiverDisplay","paymentMethodText","totalXPos","signLineWidth","signLineX","handleCopyReceipt","handleGoToDashboard","Fragment"],"ignoreList":[],"sources":["../../src/app/components/ContactAutocomplete.tsx","../../src/app/components/NewBooking.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { contactsApi } from '../utils/api';\r\n\r\ninterface Contact {\r\n    id: string;\r\n    name: string;\r\n    phone: string;\r\n    usage_count: number;\r\n}\r\n\r\ninterface ContactAutocompleteProps {\r\n    nameValue: string;\r\n    phoneValue: string;\r\n    onNameChange: (value: string) => void;\r\n    onPhoneChange: (value: string) => void;\r\n    onContactSelect?: (contact: Contact) => void;\r\n    nameLabel?: string;\r\n    phoneLabel?: string;\r\n    namePlaceholder?: string;\r\n    phonePlaceholder?: string;\r\n    required?: boolean;\r\n}\r\n\r\nexport default function ContactAutocomplete({\r\n    nameValue,\r\n    phoneValue,\r\n    onNameChange,\r\n    onPhoneChange,\r\n    onContactSelect,\r\n    nameLabel = 'Name',\r\n    phoneLabel = 'Phone',\r\n    namePlaceholder = 'Enter name',\r\n    phonePlaceholder = '10-digit number',\r\n    required = false\r\n}: ContactAutocompleteProps) {\r\n    const [suggestions, setSuggestions] = useState<Contact[]>([]);\r\n    const [showDropdown, setShowDropdown] = useState(false);\r\n    const [activeField, setActiveField] = useState<'name' | 'phone' | null>(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const dropdownRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Debounce search\r\n    useEffect(() => {\r\n        const query = activeField === 'name' ? nameValue : phoneValue;\r\n        if (!query || query.length < 2) {\r\n            setSuggestions([]);\r\n            setShowDropdown(false);\r\n            return;\r\n        }\r\n\r\n        const timer = setTimeout(async () => {\r\n            setIsLoading(true);\r\n            const { contacts } = await contactsApi.search(query);\r\n            setSuggestions(contacts);\r\n            setShowDropdown(contacts.length > 0);\r\n            setIsLoading(false);\r\n        }, 300);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [nameValue, phoneValue, activeField]);\r\n\r\n    // Close dropdown when clicking outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n                setShowDropdown(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    const handleSelectContact = (contact: Contact) => {\r\n        onNameChange(contact.name);\r\n        onPhoneChange(contact.phone);\r\n        setShowDropdown(false);\r\n        if (onContactSelect) onContactSelect(contact);\r\n    };\r\n\r\n    const validatePhone = (phone: string) => {\r\n        return /^[6-9]\\d{9}$/.test(phone);\r\n    };\r\n\r\n    return (\r\n        <div className=\"relative\" ref={dropdownRef}>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Name Field */}\r\n                <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                        {nameLabel} {required && '*'}\r\n                    </label>\r\n                    <input\r\n                        type=\"text\"\r\n                        value={nameValue}\r\n                        onChange={(e) => onNameChange(e.target.value)}\r\n                        onFocus={() => setActiveField('name')}\r\n                        className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\r\n                        placeholder={namePlaceholder}\r\n                        autoComplete=\"off\"\r\n                        required={required}\r\n                    />\r\n                </div>\r\n\r\n                {/* Phone Field */}\r\n                <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                        {phoneLabel} {required && '*'}\r\n                    </label>\r\n                    <input\r\n                        type=\"tel\"\r\n                        value={phoneValue}\r\n                        onChange={(e) => onPhoneChange(e.target.value)}\r\n                        onFocus={() => setActiveField('phone')}\r\n                        className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\r\n                        placeholder={phonePlaceholder}\r\n                        maxLength={10}\r\n                        autoComplete=\"off\"\r\n                        required={required}\r\n                    />\r\n                    {phoneValue && !validatePhone(phoneValue) && (\r\n                        <p className=\"mt-1 text-sm text-red-600\">\r\n                            Must be 10 digits starting with 9, 8, 7, or 6\r\n                        </p>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Suggestions Dropdown */}\r\n            {showDropdown && (\r\n                <div className=\"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto\">\r\n                    {isLoading ? (\r\n                        <div className=\"p-3 text-gray-500 text-center\">Searching...</div>\r\n                    ) : (\r\n                        suggestions.map((contact) => (\r\n                            <button\r\n                                key={contact.id}\r\n                                type=\"button\"\r\n                                onClick={() => handleSelectContact(contact)}\r\n                                className=\"w-full text-left px-4 py-3 hover:bg-orange-50 border-b border-gray-100 last:border-0 transition-colors\"\r\n                            >\r\n                                <div className=\"flex justify-between items-center\">\r\n                                    <div>\r\n                                        <div className=\"font-medium text-gray-900\">{contact.name}</div>\r\n                                        <div className=\"text-sm text-gray-600\">{contact.phone}</div>\r\n                                    </div>\r\n                                    <div className=\"text-xs text-gray-400\">\r\n                                        Used {contact.usage_count}x\r\n                                    </div>\r\n                                </div>\r\n                            </button>\r\n                        ))\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import React, { useState, useEffect, useCallback, useRef } from 'react';\r\n// jsPDF is dynamically imported when needed to reduce initial bundle size\r\nimport { depotsApi, packagesApi, depotPricingApi, bookingsApi, seasonApi, contactsApi, receiptsApi } from '../utils/api';\r\nimport ContactAutocomplete from './ContactAutocomplete';\r\nimport { useBookingStore, useSyncStore, useOnlineStore } from '../stores';\r\nimport { queueOperation, processQueue } from '../utils/syncEngine';\r\n\r\n// Types\r\ninterface ReceiverPackage {\r\n  packageId: string;\r\n  size: string;\r\n  quantity: number;\r\n  price: number;\r\n  description?: string; // For \"Other\" package type\r\n}\r\n\r\ninterface Receiver {\r\n  name: string;\r\n  phone: string;\r\n  address: string;\r\n  packages: ReceiverPackage[];\r\n}\r\n\r\ninterface BookingFormData {\r\n  originDepotId: string;\r\n  destinationDepotId: string;\r\n  paymentMethod: 'cash' | 'online' | 'to_pay' | 'credit';\r\n  deliveryType: 'pickup' | 'home_sender' | 'home_topay' | 'home_drt';\r\n  deliveryCharge: number;\r\n  customInstructions: string;\r\n  senderName: string;\r\n  senderPhone: string;\r\n  receivers: Receiver[];\r\n}\r\n\r\ninterface NewBookingProps {\r\n  onNavigate?: (page: string) => void;\r\n}\r\n\r\nexport default function NewBooking({ onNavigate }: NewBookingProps) {\r\n  const [currentStep, setCurrentStep] = useState(1);\r\n  const [season, setSeason] = useState<any>(null);\r\n  const [isSeasonActive, setIsSeasonActive] = useState(true);\r\n  const [depots, setDepots] = useState<any[]>([]);\r\n  const [packages, setPackages] = useState<any[]>([]);\r\n  const [pricing, setPricing] = useState<any[]>([]);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [receiptNumber, setReceiptNumber] = useState('');\r\n  const [showDraftPrompt, setShowDraftPrompt] = useState(false);\r\n\r\n  // Zustand stores for offline support\r\n  const { draft, hasDraft, saveDraft, clearDraft, lastSavedAt, pendingBookingId, setPendingBookingId } = useBookingStore();\r\n  const isOnline = useOnlineStore((state) => state.isOnline);\r\n  const pendingOperations = useSyncStore((state) => state.pendingOperations);\r\n\r\n  const [formData, setFormData] = useState<BookingFormData>({\r\n    originDepotId: '',\r\n    destinationDepotId: '',\r\n    paymentMethod: 'cash',\r\n    deliveryType: 'pickup',\r\n    deliveryCharge: 0,\r\n    customInstructions: '',\r\n    senderName: '',\r\n    senderPhone: '',\r\n    receivers: [{ name: '', phone: '', address: '', packages: [] }]\r\n  });\r\n\r\n  // Check for draft on mount\r\n  useEffect(() => {\r\n    if (hasDraft && draft) {\r\n      // Check if draft is from last 24 hours\r\n      if (lastSavedAt) {\r\n        const hoursSinceLastSave = (Date.now() - new Date(lastSavedAt).getTime()) / (1000 * 60 * 60);\r\n        if (hoursSinceLastSave < 24) {\r\n          setShowDraftPrompt(true);\r\n        } else {\r\n          // Draft is too old, clear it\r\n          clearDraft();\r\n        }\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Auto-save form data as draft (debounced)\r\n  useEffect(() => {\r\n    const timeoutId = setTimeout(() => {\r\n      // Only save if there's meaningful data\r\n      if (formData.senderName || formData.senderPhone || formData.originDepotId) {\r\n        saveDraft(formData);\r\n      }\r\n    }, 1000); // 1 second debounce\r\n\r\n    return () => clearTimeout(timeoutId);\r\n  }, [formData, saveDraft]);\r\n\r\n  useEffect(() => {\r\n    loadInitialData();\r\n  }, []);\r\n\r\n  const loadInitialData = async () => {\r\n    try {\r\n      const [depotsRes, packagesRes, pricingRes, seasonRes] = await Promise.all([\r\n        depotsApi.getAll(),\r\n        packagesApi.getAll(),\r\n        depotPricingApi.getAll(),\r\n        seasonApi.get()\r\n      ]);\r\n      const loadedDepots = depotsRes.depots || [];\r\n      setDepots(loadedDepots);\r\n      setPackages(packagesRes.packages || []);\r\n      setPricing(pricingRes.pricing || []);\r\n\r\n      // Set Devgad as default origin depot (most frequently used)\r\n      const devgadDepot = loadedDepots.find((d: any) => d.name?.toLowerCase() === 'devgad' && d.type === 'origin');\r\n      if (devgadDepot) {\r\n        setFormData(prev => ({ ...prev, originDepotId: devgadDepot.id }));\r\n      }\r\n      if (seasonRes.season) {\r\n        setSeason(seasonRes.season);\r\n        // Calculate is_active based on current date\r\n        const today = new Date();\r\n        const startDate = new Date(seasonRes.season.startDate);\r\n        const endDate = new Date(seasonRes.season.endDate);\r\n        const isActive = today >= startDate && today <= endDate;\r\n        setIsSeasonActive(isActive);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n    }\r\n  };\r\n\r\n  const validatePhone = (phone: string) => /^[6-9]\\d{9}$/.test(phone);\r\n\r\n  const getPackagePrice = (packageId: string, depotId: string) => {\r\n    const priceEntry = pricing.find(\r\n      (p: any) => p.packageId === packageId && p.depotId === depotId\r\n    );\r\n    return priceEntry?.price || packages.find((p: any) => p.id === packageId)?.base_price || 0;\r\n  };\r\n\r\n  const calculateTotal = () => {\r\n    let total = 0;\r\n    formData.receivers.forEach(receiver => {\r\n      receiver.packages.forEach(pkg => {\r\n        total += pkg.quantity * pkg.price;\r\n      });\r\n    });\r\n    return total + (formData.deliveryCharge || 0);\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    setIsSubmitting(true);\r\n\r\n    // Debug logging for offline status\r\n    console.log('[NewBooking] handleSubmit called');\r\n    console.log('[NewBooking] isOnline from store:', isOnline);\r\n    console.log('[NewBooking] navigator.onLine:', navigator.onLine);\r\n\r\n    try {\r\n      const bookingData = {\r\n        origin_depot_id: formData.originDepotId,\r\n        destination_depot_id: formData.destinationDepotId,\r\n        payment_method: formData.paymentMethod,\r\n        delivery_type: formData.deliveryType,\r\n        delivery_charges: formData.deliveryCharge,\r\n        sender_name: formData.senderName,\r\n        sender_phone: formData.senderPhone,\r\n        receivers: formData.receivers,\r\n        subtotal: calculateTotal() - (formData.deliveryCharge || 0),\r\n        total_amount: calculateTotal(),\r\n        current_status: 'booked',\r\n        special_instructions: formData.customInstructions\r\n      };\r\n\r\n      if (isOnline) {\r\n        // Online: Try to create booking directly\r\n        try {\r\n          const result = await bookingsApi.create(bookingData);\r\n          const newReceiptNumber = result.booking?.receipt_number || result.booking?.id || 'Unknown';\r\n          setReceiptNumber(newReceiptNumber);\r\n\r\n          // Save contacts for future autocomplete\r\n          if (formData.senderName && formData.senderPhone) {\r\n            await contactsApi.upsert(formData.senderName, formData.senderPhone).catch(console.error);\r\n          }\r\n          for (const receiver of formData.receivers) {\r\n            if (receiver.name && receiver.phone) {\r\n              await contactsApi.upsert(receiver.name, receiver.phone).catch(console.error);\r\n            }\r\n          }\r\n\r\n          // Clear draft on successful submission\r\n          clearDraft();\r\n          setCurrentStep(5); // Confirmation\r\n        } catch (error: any) {\r\n          console.error('Error creating booking:', error);\r\n\r\n          // Check if it's a network error - if so, queue it\r\n          const errorMessage = error.message?.toLowerCase() || '';\r\n          const isNetworkError =\r\n            errorMessage.includes('fetch') ||\r\n            errorMessage.includes('network') ||\r\n            errorMessage.includes('failed to fetch') ||\r\n            errorMessage.includes('err_name_not_resolved') ||\r\n            errorMessage.includes('err_internet_disconnected') ||\r\n            errorMessage.includes('err_connection') ||\r\n            errorMessage.includes('err_network') ||\r\n            errorMessage.includes('net::') ||\r\n            errorMessage.includes('timeout') ||\r\n            errorMessage.includes('abort') ||\r\n            error.name === 'TypeError' ||  // Fetch throws TypeError on network failure\r\n            error.code === 'ECONNREFUSED' ||\r\n            !navigator.onLine;  // Also check browser's online status\r\n\r\n          if (isNetworkError) {\r\n            console.log('[NewBooking] Network error detected, queuing operation');\r\n            const operationId = queueOperation('CREATE_BOOKING', bookingData, {\r\n              entityType: 'booking',\r\n              optimisticData: { formData, createdAt: new Date().toISOString() }\r\n            });\r\n            setPendingBookingId(operationId);\r\n            setReceiptNumber('PENDING-' + operationId.slice(-8).toUpperCase());\r\n            clearDraft();\r\n            setCurrentStep(5); // Show confirmation with pending status\r\n          } else {\r\n            // Non-network error, show error to user\r\n            alert('Failed to create booking. Please try again.');\r\n          }\r\n        }\r\n      } else {\r\n        // Offline: Queue the operation\r\n        const operationId = queueOperation('CREATE_BOOKING', bookingData, {\r\n          entityType: 'booking',\r\n          optimisticData: { formData, createdAt: new Date().toISOString() }\r\n        });\r\n\r\n        setPendingBookingId(operationId);\r\n        setReceiptNumber('PENDING-' + operationId.slice(-8).toUpperCase());\r\n        clearDraft();\r\n        setCurrentStep(5); // Show confirmation with pending status\r\n      }\r\n    } catch (error) {\r\n      console.error('Error creating booking:', error);\r\n      alert('Failed to create booking. Please try again.');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Swipe gesture handling for mobile\r\n  const touchStartX = useRef<number | null>(null);\r\n  const touchStartY = useRef<number | null>(null);\r\n\r\n  const handleTouchStart = (e: React.TouchEvent) => {\r\n    touchStartX.current = e.touches[0].clientX;\r\n    touchStartY.current = e.touches[0].clientY;\r\n  };\r\n\r\n  const handleTouchEnd = (e: React.TouchEvent) => {\r\n    if (touchStartX.current === null || touchStartY.current === null) return;\r\n\r\n    const touchEndX = e.changedTouches[0].clientX;\r\n    const touchEndY = e.changedTouches[0].clientY;\r\n    const deltaX = touchEndX - touchStartX.current;\r\n    const deltaY = touchEndY - touchStartY.current;\r\n\r\n    // Only trigger if horizontal swipe is greater than vertical (not scrolling)\r\n    // and swipe distance is at least 50px\r\n    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {\r\n      if (deltaX < 0 && currentStep < 4) {\r\n        // Swipe left - go to next step\r\n        setCurrentStep(prev => Math.min(prev + 1, 4));\r\n      } else if (deltaX > 0 && currentStep > 1) {\r\n        // Swipe right - go to previous step\r\n        setCurrentStep(prev => Math.max(prev - 1, 1));\r\n      }\r\n    }\r\n\r\n    touchStartX.current = null;\r\n    touchStartY.current = null;\r\n  };\r\n\r\n  const nextStep = () => setCurrentStep(prev => Math.min(prev + 1, 5));\r\n  const prevStep = () => setCurrentStep(prev => Math.max(prev - 1, 1));\r\n  const goToStep = (step: number) => setCurrentStep(step);\r\n\r\n  const resetForm = () => {\r\n    // Find Devgad depot to set as default\r\n    const devgadDepot = depots.find((d: any) => d.name?.toLowerCase() === 'devgad' && d.type === 'origin');\r\n\r\n    setFormData({\r\n      originDepotId: devgadDepot?.id || '',\r\n      destinationDepotId: '',\r\n      paymentMethod: 'cash',\r\n      deliveryType: 'pickup',\r\n      deliveryCharge: 0,\r\n      customInstructions: '',\r\n      senderName: '',\r\n      senderPhone: '',\r\n      receivers: [{ name: '', phone: '', address: '', packages: [] }]\r\n    });\r\n    setReceiptNumber('');\r\n    setCurrentStep(1);\r\n    clearDraft();\r\n    setPendingBookingId(null);\r\n  };\r\n\r\n  // Handle draft restoration\r\n  const restoreDraft = () => {\r\n    if (draft) {\r\n      setFormData(draft);\r\n    }\r\n    setShowDraftPrompt(false);\r\n  };\r\n\r\n  const dismissDraft = () => {\r\n    clearDraft();\r\n    setShowDraftPrompt(false);\r\n  };\r\n\r\n  // Check if season is active\r\n  if (!isSeasonActive) {\r\n    return (\r\n      <div className=\"p-8 text-center\">\r\n        <div className=\"text-6xl mb-4\"></div>\r\n        <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Mango Season is Currently Closed</h2>\r\n        <p className=\"text-gray-600\">Please check back during the mango season.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const stepLabels = ['Depot & Payment', 'Sender Details', 'Receivers & Packages', 'Summary'];\r\n\r\n  // Check for pending booking that completed\r\n  const completedPendingBooking = pendingBookingId\r\n    ? pendingOperations.find(op => op.id === pendingBookingId && op.status === 'completed')\r\n    : null;\r\n\r\n  return (\r\n    <div className=\"p-8\">\r\n      {/* Draft Recovery Prompt */}\r\n      {showDraftPrompt && (\r\n        <div className=\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <span className=\"text-2xl\"></span>\r\n            <div className=\"flex-1\">\r\n              <h3 className=\"font-semibold text-blue-900\">Resume Previous Booking?</h3>\r\n              <p className=\"text-sm text-blue-700 mt-1\">\r\n                You have an unsaved booking from {lastSavedAt ? new Date(lastSavedAt).toLocaleString() : 'earlier'}.\r\n                Would you like to continue where you left off?\r\n              </p>\r\n              <div className=\"flex gap-3 mt-3\">\r\n                <button\r\n                  onClick={restoreDraft}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium\"\r\n                >\r\n                  Resume Booking\r\n                </button>\r\n                <button\r\n                  onClick={dismissDraft}\r\n                  className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium\"\r\n                >\r\n                  Start Fresh\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Offline Warning */}\r\n      {!isOnline && currentStep < 5 && (\r\n        <div className=\"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"text-xl\"></span>\r\n            <div>\r\n              <span className=\"font-medium text-amber-800\">You're currently offline. </span>\r\n              <span className=\"text-amber-700\">Your booking will be saved and submitted when you're back online.</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Header */}\r\n      <div className=\"mb-8\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900\">New Booking</h1>\r\n        <p className=\"text-gray-600\">Create a new transport booking</p>\r\n      </div>\r\n\r\n      {/* Step Indicator with Swipe Navigation */}\r\n      {currentStep <= 4 && (\r\n        <div className=\"mb-8\">\r\n          {/* Mobile Navigation Arrows */}\r\n          <div className=\"flex items-center justify-center gap-4 mb-4 lg:hidden\">\r\n            <button\r\n              onClick={prevStep}\r\n              disabled={currentStep === 1}\r\n              className={`p-3 rounded-full transition-colors touch-target ${currentStep === 1\r\n                ? 'bg-gray-100 text-gray-300 cursor-not-allowed'\r\n                : 'bg-orange-100 text-orange-600 hover:bg-orange-200 active:bg-orange-300'\r\n                }`}\r\n              aria-label=\"Previous step\"\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n              </svg>\r\n            </button>\r\n\r\n            <div className=\"text-center\">\r\n              <div className=\"text-2xl font-bold text-orange-600\">Step {currentStep} of 4</div>\r\n              <div className=\"text-sm text-gray-600\">{stepLabels[currentStep - 1]}</div>\r\n            </div>\r\n\r\n            <button\r\n              onClick={nextStep}\r\n              disabled={currentStep === 4}\r\n              className={`p-3 rounded-full transition-colors touch-target ${currentStep === 4\r\n                ? 'bg-gray-100 text-gray-300 cursor-not-allowed'\r\n                : 'bg-orange-100 text-orange-600 hover:bg-orange-200 active:bg-orange-300'\r\n                }`}\r\n              aria-label=\"Next step\"\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Desktop Step Indicator */}\r\n          <div className=\"hidden lg:flex items-center justify-center gap-2\">\r\n            {stepLabels.map((label, index) => (\r\n              <React.Fragment key={index}>\r\n                <div\r\n                  className={`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium ${currentStep === index + 1\r\n                    ? 'bg-orange-500 text-white'\r\n                    : currentStep > index + 1\r\n                      ? 'bg-green-100 text-green-700'\r\n                      : 'bg-gray-100 text-gray-500'\r\n                    }`}\r\n                >\r\n                  <span>{index + 1}</span>\r\n                  <span>{label}</span>\r\n                </div>\r\n                {index < 3 && <div className=\"w-8 h-0.5 bg-gray-200\" />}\r\n              </React.Fragment>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Swipe hint for mobile */}\r\n          <p className=\"lg:hidden text-center text-xs text-gray-400 mt-2\">\r\n            Swipe or use arrows to navigate\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Form Steps - Swipe enabled on mobile */}\r\n      <div\r\n        className=\"bg-white rounded-xl border border-gray-200 p-8 max-w-4xl mx-auto\"\r\n        onTouchStart={handleTouchStart}\r\n        onTouchEnd={handleTouchEnd}\r\n      >\r\n        {currentStep === 1 && (\r\n          <Step1DepotPaymentDelivery\r\n            formData={formData}\r\n            setFormData={setFormData}\r\n            depots={depots}\r\n            onNext={nextStep}\r\n          />\r\n        )}\r\n\r\n        {currentStep === 2 && (\r\n          <Step2SenderDetails\r\n            formData={formData}\r\n            setFormData={setFormData}\r\n            onNext={nextStep}\r\n            onPrev={prevStep}\r\n          />\r\n        )}\r\n\r\n        {currentStep === 3 && (\r\n          <Step3ReceiversPackages\r\n            formData={formData}\r\n            setFormData={setFormData}\r\n            packages={packages}\r\n            pricing={pricing}\r\n            onNext={nextStep}\r\n            onPrev={prevStep}\r\n          />\r\n        )}\r\n\r\n        {currentStep === 4 && (\r\n          <Step4Summary\r\n            formData={formData}\r\n            depots={depots}\r\n            onSubmit={handleSubmit}\r\n            onPrev={prevStep}\r\n            goToStep={goToStep}\r\n            isSubmitting={isSubmitting}\r\n          />\r\n        )}\r\n\r\n        {currentStep === 5 && (\r\n          <Step5Confirmation\r\n            receiptNumber={receiptNumber}\r\n            formData={formData}\r\n            depots={depots}\r\n            onNewBooking={resetForm}\r\n            onNavigate={onNavigate}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// STEP 1: Depot, Payment & Delivery\r\n// ============================================================================\r\nfunction Step1DepotPaymentDelivery({ formData, setFormData, depots, onNext }: any) {\r\n  // Origin depots: only show depots with type \"origin\"\r\n  const originDepots = depots.filter((d: any) => d.type === 'origin');\r\n\r\n  // Destination depots: exclude origin-type depots (Devgad, Shirgaon)\r\n  const destinationDepots = depots.filter((d: any) => d.type !== 'origin');\r\n\r\n  // Sort destinations: Bhusari Colony, Sadashiv Peth, Akurdi first (managed depots)\r\n  const sortedDestinations = destinationDepots\r\n    .sort((a: any, b: any) => {\r\n      const priority = ['bhusari colony', 'sadashiv peth', 'akurdi'];\r\n      const aIndex = priority.indexOf(a.name?.toLowerCase());\r\n      const bIndex = priority.indexOf(b.name?.toLowerCase());\r\n      if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;\r\n      if (aIndex !== -1) return -1;\r\n      if (bIndex !== -1) return 1;\r\n      return (a.name || '').localeCompare(b.name || '');\r\n    });\r\n\r\n  const canProceed = formData.originDepotId && formData.destinationDepotId && formData.paymentMethod;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <h2 className=\"text-2xl font-bold text-gray-900\">Step 1: Route & Payment</h2>\r\n\r\n      {/* Depot Selection */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Origin Depot *</label>\r\n          <select\r\n            value={formData.originDepotId}\r\n            onChange={(e) => setFormData({ ...formData, originDepotId: e.target.value, destinationDepotId: '' })}\r\n            className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500\"\r\n          >\r\n            <option value=\"\">Select Origin</option>\r\n            {originDepots.map((depot: any) => (\r\n              <option key={depot.id} value={depot.id}>{depot.name}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Destination Depot *</label>\r\n          <select\r\n            value={formData.destinationDepotId}\r\n            onChange={(e) => setFormData({ ...formData, destinationDepotId: e.target.value })}\r\n            className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500\"\r\n            disabled={!formData.originDepotId}\r\n          >\r\n            <option value=\"\">Select Destination</option>\r\n            {sortedDestinations.map((depot: any) => (\r\n              <option key={depot.id} value={depot.id}>{depot.name}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Payment Method */}\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-3\">Payment Method *</label>\r\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n          {[\r\n            { value: 'cash', label: ' Cash' },\r\n            { value: 'online', label: ' Online' },\r\n            { value: 'to_pay', label: ' To Pay' },\r\n            { value: 'credit', label: ' Credit' }\r\n          ].map(option => (\r\n            <button\r\n              key={option.value}\r\n              type=\"button\"\r\n              onClick={() => setFormData({ ...formData, paymentMethod: option.value })}\r\n              className={`px-4 py-3 rounded-lg border-2 text-sm font-medium transition-all ${formData.paymentMethod === option.value\r\n                ? 'border-orange-500 bg-orange-50 text-orange-700'\r\n                : 'border-gray-200 hover:border-orange-300'\r\n                }`}\r\n            >\r\n              {option.label}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delivery Type */}\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-3\">Delivery Type *</label>\r\n        <div className=\"grid grid-cols-2 gap-3\">\r\n          {[\r\n            { value: 'pickup', label: ' Depot Pickup', desc: 'Receiver picks up from depot' },\r\n            { value: 'home_sender', label: ' Home Delivery (Paid)', desc: 'Delivery paid by sender' },\r\n            { value: 'home_topay', label: ' Home Delivery (To Pay)', desc: 'Delivery paid by receiver' },\r\n            { value: 'home_drt', label: ' DRT Delivery', desc: 'Special DRT delivery' }\r\n          ].map(option => (\r\n            <button\r\n              key={option.value}\r\n              type=\"button\"\r\n              onClick={() => setFormData({ ...formData, deliveryType: option.value, deliveryCharge: 0 })}\r\n              className={`p-4 rounded-lg border-2 text-left transition-all ${formData.deliveryType === option.value\r\n                ? 'border-orange-500 bg-orange-50'\r\n                : 'border-gray-200 hover:border-orange-300'\r\n                }`}\r\n            >\r\n              <div className=\"font-medium\">{option.label}</div>\r\n              <div className=\"text-xs text-gray-500 mt-1\">{option.desc}</div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delivery Charge (if home delivery) */}\r\n      {formData.deliveryType !== 'pickup' && (\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Delivery Charge ()</label>\r\n          <input\r\n            type=\"number\"\r\n            min=\"0\"\r\n            value={formData.deliveryCharge}\r\n            onChange={(e) => setFormData({ ...formData, deliveryCharge: Number(e.target.value) })}\r\n            className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500\"\r\n            placeholder=\"Enter delivery charge\"\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {/* Custom Instructions */}\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Special Instructions (Optional)</label>\r\n        <textarea\r\n          value={formData.customInstructions}\r\n          onChange={(e) => setFormData({ ...formData, customInstructions: e.target.value })}\r\n          className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500\"\r\n          rows={2}\r\n          placeholder=\"Any special handling instructions...\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex justify-end\">\r\n        <button\r\n          onClick={onNext}\r\n          disabled={!canProceed}\r\n          className=\"px-8 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 font-medium\"\r\n        >\r\n          Next Step \r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// STEP 2: Sender Details\r\n// ============================================================================\r\nfunction Step2SenderDetails({ formData, setFormData, onNext, onPrev }: any) {\r\n  const validatePhone = (phone: string) => /^[6-9]\\d{9}$/.test(phone);\r\n  const canProceed = formData.senderName && validatePhone(formData.senderPhone);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <h2 className=\"text-2xl font-bold text-gray-900\">Step 2: Sender Details</h2>\r\n      <p className=\"text-gray-600\">Start typing to see suggestions from past bookings</p>\r\n\r\n      <ContactAutocomplete\r\n        nameValue={formData.senderName}\r\n        phoneValue={formData.senderPhone}\r\n        onNameChange={(value) => setFormData({ ...formData, senderName: value })}\r\n        onPhoneChange={(value) => setFormData({ ...formData, senderPhone: value })}\r\n        onContactSelect={(contact) => setFormData({ ...formData, senderName: contact.name, senderPhone: contact.phone })}\r\n        nameLabel=\"Sender Name\"\r\n        phoneLabel=\"Sender Phone\"\r\n        namePlaceholder=\"Start typing name...\"\r\n        phonePlaceholder=\"10-digit number\"\r\n        required\r\n      />\r\n\r\n      <div className=\"flex justify-between\">\r\n        <button\r\n          onClick={onPrev}\r\n          className=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium\"\r\n        >\r\n           Previous\r\n        </button>\r\n        <button\r\n          onClick={onNext}\r\n          disabled={!canProceed}\r\n          className=\"px-8 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 font-medium\"\r\n        >\r\n          Next Step \r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// STEP 3: Receivers & Packages\r\n// ============================================================================\r\nfunction Step3ReceiversPackages({ formData, setFormData, packages, pricing, onNext, onPrev }: any) {\r\n  const validatePhone = (phone: string) => /^[6-9]\\d{9}$/.test(phone);\r\n  const requiresAddress = ['home_sender', 'home_topay', 'home_drt'].includes(formData.deliveryType);\r\n\r\n  const getPackagePrice = (packageId: string) => {\r\n    const priceEntry = pricing.find(\r\n      (p: any) => p.packageId === packageId && p.depotId === formData.destinationDepotId\r\n    );\r\n    return priceEntry?.price || packages.find((p: any) => p.id === packageId)?.basePrice || 0;\r\n  };\r\n\r\n  // Sort packages: 1Dz first\r\n  const sortedPackages = [...packages].sort((a: any, b: any) => {\r\n    const priority = ['1 dz', '1dz', '2 dz', '2dz', '3 dz', '3dz', '5 dz', '5dz'];\r\n    const aName = a.name?.toLowerCase() || '';\r\n    const bName = b.name?.toLowerCase() || '';\r\n    const aIndex = priority.findIndex(p => aName.includes(p));\r\n    const bIndex = priority.findIndex(p => bName.includes(p));\r\n    if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;\r\n    if (aIndex !== -1) return -1;\r\n    if (bIndex !== -1) return 1;\r\n    return aName.localeCompare(bName);\r\n  });\r\n\r\n  const updateReceiver = (index: number, field: string, value: any) => {\r\n    const newReceivers = [...formData.receivers];\r\n    newReceivers[index] = { ...newReceivers[index], [field]: value };\r\n    setFormData({ ...formData, receivers: newReceivers });\r\n  };\r\n\r\n  const updateReceiverPackage = (receiverIndex: number, packageId: string, quantity: number) => {\r\n    const newReceivers = [...formData.receivers];\r\n    const receiver = newReceivers[receiverIndex];\r\n    const pkg = packages.find((p: any) => p.id === packageId);\r\n    const price = getPackagePrice(packageId);\r\n\r\n    const existingIndex = receiver.packages.findIndex((p: any) => p.packageId === packageId);\r\n\r\n    if (quantity > 0) {\r\n      const pkgData = { packageId, size: pkg?.name || 'Custom', quantity, price };\r\n      if (existingIndex >= 0) {\r\n        receiver.packages[existingIndex] = pkgData;\r\n      } else {\r\n        receiver.packages.push(pkgData);\r\n      }\r\n    } else if (existingIndex >= 0) {\r\n      receiver.packages.splice(existingIndex, 1);\r\n    }\r\n\r\n    setFormData({ ...formData, receivers: newReceivers });\r\n  };\r\n\r\n  // Update description for Other package\r\n  const updateReceiverPackageDescription = (receiverIndex: number, packageId: string, description: string) => {\r\n    const newReceivers = [...formData.receivers];\r\n    const receiver = newReceivers[receiverIndex];\r\n    const existingIndex = receiver.packages.findIndex((p: any) => p.packageId === packageId);\r\n    if (existingIndex >= 0) {\r\n      receiver.packages[existingIndex].description = description;\r\n      setFormData({ ...formData, receivers: newReceivers });\r\n    }\r\n  };\r\n\r\n  const getReceiverPackageDescription = (receiverIndex: number, packageId: string) => {\r\n    const pkg = formData.receivers[receiverIndex]?.packages?.find((p: any) => p.packageId === packageId);\r\n    return pkg?.description || '';\r\n  };\r\n\r\n  const isOtherPackage = (pkgName: string) => {\r\n    return pkgName?.toLowerCase() === 'other';\r\n  };\r\n\r\n  const getReceiverPackageQuantity = (receiverIndex: number, packageId: string) => {\r\n    const pkg = formData.receivers[receiverIndex]?.packages?.find((p: any) => p.packageId === packageId);\r\n    return pkg?.quantity || 0;\r\n  };\r\n\r\n  const addReceiver = () => {\r\n    setFormData({\r\n      ...formData,\r\n      receivers: [...formData.receivers, { name: '', phone: '', address: '', packages: [] }]\r\n    });\r\n  };\r\n\r\n  const removeReceiver = (index: number) => {\r\n    if (formData.receivers.length > 1) {\r\n      const newReceivers = formData.receivers.filter((_: any, i: number) => i !== index);\r\n      setFormData({ ...formData, receivers: newReceivers });\r\n    }\r\n  };\r\n\r\n  const getReceiverSubtotal = (receiver: Receiver) => {\r\n    return receiver.packages.reduce((sum, pkg) => sum + (pkg.quantity * pkg.price), 0);\r\n  };\r\n\r\n  const canProceed = formData.receivers.every((r: Receiver) =>\r\n    r.name && validatePhone(r.phone) && r.packages.length > 0 && (!requiresAddress || r.address)\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <h2 className=\"text-2xl font-bold text-gray-900\">Step 3: Receivers & Packages</h2>\r\n      <p className=\"text-gray-600\">Add receiver details and select packages for each receiver</p>\r\n\r\n      {formData.receivers.map((receiver: Receiver, receiverIndex: number) => (\r\n        <div key={receiverIndex} className=\"p-6 border-2 border-gray-200 rounded-lg space-y-4 bg-gray-50\">\r\n          <div className=\"flex justify-between items-center pb-2 border-b\">\r\n            <h3 className=\"text-lg font-bold text-gray-900\">Receiver {receiverIndex + 1}</h3>\r\n            {formData.receivers.length > 1 && (\r\n              <button\r\n                onClick={() => removeReceiver(receiverIndex)}\r\n                className=\"text-red-600 hover:text-red-700 text-sm font-medium\"\r\n              >\r\n                Remove\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Receiver Contact with Autocomplete */}\r\n          <ContactAutocomplete\r\n            nameValue={receiver.name}\r\n            phoneValue={receiver.phone}\r\n            onNameChange={(value) => updateReceiver(receiverIndex, 'name', value)}\r\n            onPhoneChange={(value) => updateReceiver(receiverIndex, 'phone', value)}\r\n            onContactSelect={(contact) => {\r\n              const newReceivers = [...formData.receivers];\r\n              newReceivers[receiverIndex] = {\r\n                ...newReceivers[receiverIndex],\r\n                name: contact.name,\r\n                phone: contact.phone\r\n              };\r\n              setFormData({ ...formData, receivers: newReceivers });\r\n            }}\r\n            nameLabel=\"Receiver Name\"\r\n            phoneLabel=\"Receiver Phone\"\r\n            namePlaceholder=\"Start typing name...\"\r\n            phonePlaceholder=\"10-digit number\"\r\n            required\r\n          />\r\n\r\n          {/* Address (if required) */}\r\n          {requiresAddress && (\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Delivery Address *</label>\r\n              <textarea\r\n                value={receiver.address}\r\n                onChange={(e) => updateReceiver(receiverIndex, 'address', e.target.value)}\r\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500\"\r\n                rows={2}\r\n                placeholder=\"Enter full delivery address\"\r\n                required\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* Packages - 3x3 Grid */}\r\n          <div>\r\n            <h4 className=\"font-semibold text-gray-900 mb-3\"> Select Packages</h4>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3\">\r\n              {sortedPackages.map((pkg: any) => {\r\n                const price = getPackagePrice(pkg.id);\r\n                const quantity = getReceiverPackageQuantity(receiverIndex, pkg.id);\r\n                const isOther = isOtherPackage(pkg.name);\r\n                const description = getReceiverPackageDescription(receiverIndex, pkg.id);\r\n                return (\r\n                  <div key={pkg.id} className={`p-3 bg-white border rounded-lg hover:border-orange-300 transition-colors ${isOther && quantity > 0 ? 'border-yellow-400 col-span-full' : 'border-gray-200'}`}>\r\n                    <div className=\"font-medium text-gray-900 text-sm\">{pkg.name}</div>\r\n                    <div className=\"text-xs text-gray-600 mb-2\">{price}/unit</div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input\r\n                        type=\"number\"\r\n                        min=\"0\"\r\n                        value={quantity > 0 ? quantity : ''}\r\n                        placeholder=\"0\"\r\n                        onChange={(e) => updateReceiverPackage(receiverIndex, pkg.id, Number(e.target.value) || 0)}\r\n                        className={`w-16 px-2 py-1 text-center border rounded focus:ring-2 focus:ring-orange-500 ${quantity > 0 ? 'border-orange-400 bg-orange-50' : 'border-gray-300 text-gray-400'\r\n                          }`}\r\n                      />\r\n                      {quantity > 0 && (\r\n                        <span className=\"text-xs font-medium text-green-600\">\r\n                          {(quantity * price).toFixed(0)}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    {/* Description field for Other package */}\r\n                    {isOther && quantity > 0 && (\r\n                      <div className=\"mt-2\">\r\n                        <input\r\n                          type=\"text\"\r\n                          value={description}\r\n                          onChange={(e) => updateReceiverPackageDescription(receiverIndex, pkg.id, e.target.value)}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-sm\"\r\n                          placeholder=\"Enter description (e.g., Special box, Custom crate...)\"\r\n                        />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Receiver Subtotal */}\r\n          <div className=\"bg-orange-50 border border-orange-200 rounded-lg p-3\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <span className=\"font-medium\">Subtotal for {receiver.name || `Receiver ${receiverIndex + 1}`}:</span>\r\n              <span className=\"text-lg font-bold text-orange-600\">{getReceiverSubtotal(receiver).toFixed(2)}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ))}\r\n\r\n      <button\r\n        onClick={addReceiver}\r\n        className=\"w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-orange-500 hover:text-orange-500 font-medium transition-colors\"\r\n      >\r\n        + Add Another Receiver\r\n      </button>\r\n\r\n      <div className=\"flex justify-between\">\r\n        <button\r\n          onClick={onPrev}\r\n          className=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium\"\r\n        >\r\n           Previous\r\n        </button>\r\n        <button\r\n          onClick={onNext}\r\n          disabled={!canProceed}\r\n          className=\"px-8 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 font-medium\"\r\n        >\r\n          Review Summary \r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// STEP 4: Summary\r\n// ============================================================================\r\nfunction Step4Summary({ formData, depots, onSubmit, onPrev, goToStep, isSubmitting }: any) {\r\n  const originDepot = depots.find((d: any) => d.id === formData.originDepotId);\r\n  const destinationDepot = depots.find((d: any) => d.id === formData.destinationDepotId);\r\n\r\n  const packagesTotal = formData.receivers.reduce((sum: number, receiver: any) => {\r\n    return sum + receiver.packages.reduce((rSum: number, pkg: any) => rSum + (pkg.quantity * pkg.price), 0);\r\n  }, 0);\r\n  const grandTotal = packagesTotal + (formData.deliveryCharge || 0);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <h2 className=\"text-2xl font-bold text-gray-900\">Step 4: Review & Confirm</h2>\r\n\r\n      {/* Route */}\r\n      <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n        <div className=\"flex justify-between items-center mb-2\">\r\n          <h3 className=\"font-semibold text-gray-900\"> Route</h3>\r\n          <button onClick={() => goToStep(1)} className=\"text-orange-600 text-sm hover:underline\">Edit</button>\r\n        </div>\r\n        <p>{originDepot?.name}  {destinationDepot?.name}</p>\r\n        <p className=\"text-sm text-gray-600\">Payment: {formData.paymentMethod?.toUpperCase()} | Delivery: {formData.deliveryType?.replace('_', ' ')}</p>\r\n      </div>\r\n\r\n      {/* Sender */}\r\n      <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n        <div className=\"flex justify-between items-center mb-2\">\r\n          <h3 className=\"font-semibold text-gray-900\"> Sender</h3>\r\n          <button onClick={() => goToStep(2)} className=\"text-orange-600 text-sm hover:underline\">Edit</button>\r\n        </div>\r\n        <p>{formData.senderName} ({formData.senderPhone})</p>\r\n      </div>\r\n\r\n      {/* Receivers & Packages */}\r\n      <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n        <div className=\"flex justify-between items-center mb-2\">\r\n          <h3 className=\"font-semibold text-gray-900\"> Receivers & Packages</h3>\r\n          <button onClick={() => goToStep(3)} className=\"text-orange-600 text-sm hover:underline\">Edit</button>\r\n        </div>\r\n        {formData.receivers.map((receiver: any, index: number) => (\r\n          <div key={index} className=\"border-l-4 border-orange-300 pl-4 mb-4\">\r\n            <p className=\"font-medium\">{receiver.name} ({receiver.phone})</p>\r\n            {receiver.address && <p className=\"text-sm text-gray-600\">{receiver.address}</p>}\r\n            <div className=\"mt-2 space-y-1\">\r\n              {receiver.packages.map((pkg: any, pkgIndex: number) => (\r\n                <div key={pkgIndex} className=\"flex justify-between text-sm\">\r\n                  <span>{pkg.size}  {pkg.quantity}</span>\r\n                  <span>{(pkg.quantity * pkg.price).toFixed(0)}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Total */}\r\n      <div className=\"bg-orange-50 border border-orange-200 p-4 rounded-lg\">\r\n        <div className=\"flex justify-between text-sm mb-1\">\r\n          <span>Packages Subtotal</span>\r\n          <span>{packagesTotal.toFixed(2)}</span>\r\n        </div>\r\n        {formData.deliveryCharge > 0 && (\r\n          <div className=\"flex justify-between text-sm mb-1\">\r\n            <span>Delivery Charge</span>\r\n            <span>{formData.deliveryCharge.toFixed(2)}</span>\r\n          </div>\r\n        )}\r\n        <div className=\"flex justify-between font-bold text-lg mt-2 pt-2 border-t border-orange-300\">\r\n          <span>Total Amount</span>\r\n          <span className=\"text-orange-600\">{grandTotal.toFixed(2)}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex justify-between\">\r\n        <button\r\n          onClick={onPrev}\r\n          className=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium\"\r\n        >\r\n           Previous\r\n        </button>\r\n        <button\r\n          onClick={onSubmit}\r\n          disabled={isSubmitting}\r\n          className=\"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-medium\"\r\n        >\r\n          {isSubmitting ? 'Creating...' : ' Confirm Booking'}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// STEP 5: Confirmation with PDF, WhatsApp, New Booking\r\n// ============================================================================\r\nfunction Step5Confirmation({ receiptNumber, formData, depots, onNewBooking, onNavigate }: any) {\r\n  const originDepot = depots?.find((d: any) => d.id === formData?.originDepotId);\r\n  const destinationDepot = depots?.find((d: any) => d.id === formData?.destinationDepotId);\r\n\r\n  // Check if this is a pending (offline) booking\r\n  const isPending = receiptNumber?.startsWith('PENDING-');\r\n  const pendingOperations = useSyncStore((state) => state.pendingOperations);\r\n  const isOnline = useOnlineStore((state) => state.isOnline);\r\n\r\n  // Find the pending operation to check its status\r\n  const pendingOpId = isPending ? receiptNumber.replace('PENDING-', '').toLowerCase() : null;\r\n  const pendingOp = pendingOpId\r\n    ? pendingOperations.find(op => op.id.toLowerCase().endsWith(pendingOpId))\r\n    : null;\r\n\r\n  const calculateTotal = () => {\r\n    if (!formData?.receivers) return 0;\r\n    return formData.receivers.reduce((sum: number, receiver: any) => {\r\n      return sum + (receiver.packages || []).reduce((rSum: number, pkg: any) => rSum + (pkg.quantity * pkg.price), 0);\r\n    }, 0) + (formData.deliveryCharge || 0);\r\n  };\r\n\r\n  const generateReceiptText = () => {\r\n    const lines = [\r\n      ` DIRBA AMBA SERVICE`,\r\n      ``,\r\n      `Receipt: ${receiptNumber}`,\r\n      `Date: ${new Date().toLocaleDateString('en-IN')}`,\r\n      ``,\r\n      ` DESTINATION`,\r\n      `${destinationDepot?.name || 'N/A'}`,\r\n      ``,\r\n      ` SENDER`,\r\n      `*${formData?.senderName || 'N/A'}* (${formData?.senderPhone || 'N/A'})`,\r\n      ``,\r\n      ` RECEIVERS & PACKAGES`,\r\n    ];\r\n\r\n    formData?.receivers?.forEach((receiver: any, i: number) => {\r\n      lines.push(`\\n${i + 1}. ${receiver.name} (${receiver.phone})`);\r\n      receiver.packages?.forEach((pkg: any) => {\r\n        lines.push(`    ${pkg.size}  ${pkg.quantity} = ${(pkg.quantity * pkg.price).toFixed(0)}`);\r\n      });\r\n    });\r\n\r\n    lines.push(`\\n`);\r\n    lines.push(` TOTAL: ${calculateTotal().toFixed(2)}`);\r\n    lines.push(`\\nThank you for choosing Dirba Amba Service! `);\r\n\r\n    return lines.join('\\n');\r\n  };\r\n\r\n  const handleWhatsAppShare = () => {\r\n    const text = encodeURIComponent(generateReceiptText());\r\n    window.open(`https://wa.me/?text=${text}`, '_blank');\r\n  };\r\n\r\n  const handleDownloadPDF = async () => {\r\n    // Dynamically import jsPDF to reduce initial bundle size (~693KB saved)\r\n    const { jsPDF } = await import('jspdf');\r\n    // A5 size landscape: 210mm x 148mm\r\n    const doc = new jsPDF({ format: 'a5', unit: 'mm', orientation: 'landscape' });\r\n    const pageWidth = doc.internal.pageSize.getWidth();\r\n    const pageHeight = doc.internal.pageSize.getHeight();\r\n    const margin = 12;\r\n    let y = 12;\r\n\r\n    // ============ HEADER ============\r\n    doc.setFontSize(18);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.text('DIRBA AMBA SERVICE', pageWidth / 2, y, { align: 'center' });\r\n    y += 5;\r\n\r\n    // Address line\r\n    doc.setFontSize(8);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setTextColor(80, 80, 80);\r\n    doc.text('AT POST JAMSANDE, TAL.DEVGAD, DIST. SINDHUDURG | MOB: 9422584166, 9422435348', pageWidth / 2, y, { align: 'center' });\r\n    doc.setTextColor(0, 0, 0);\r\n    y += 6;\r\n\r\n    // Divider line\r\n    doc.setDrawColor(200, 200, 200);\r\n    doc.setLineWidth(0.3);\r\n    doc.line(margin, y, pageWidth - margin, y);\r\n    y += 6;\r\n\r\n    // Receipt Number & Date row\r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(`Receipt No: ${receiptNumber}`, margin, y);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Date: ${new Date().toLocaleDateString('en-IN')}`, pageWidth - margin, y, { align: 'right' });\r\n    y += 7;\r\n\r\n    // ============ DESTINATION ============\r\n    doc.setFontSize(12);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(`Destination: ${destinationDepot?.name || 'N/A'}`, margin, y);\r\n    y += 6;\r\n\r\n    // ============ SENDER ============\r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Sender: ${formData?.senderName || 'N/A'} (${formData?.senderPhone || 'N/A'})`, margin, y);\r\n    y += 8;\r\n\r\n    // ============ PROFESSIONAL TABLE ============\r\n    const tableMargin = margin;\r\n    const tableWidth = pageWidth - (2 * tableMargin);\r\n    const colWidths = {\r\n      srNo: 12,\r\n      receiver: 55,\r\n      packageSize: 40,\r\n      qty: 20,\r\n      amount: tableWidth - 12 - 55 - 40 - 20\r\n    };\r\n    const rowHeight = 7;\r\n    const maxY = pageHeight - 35;\r\n\r\n    // Table Header\r\n    doc.setFillColor(51, 51, 51);\r\n    doc.rect(tableMargin, y, tableWidth, rowHeight, 'F');\r\n    doc.setTextColor(255, 255, 255);\r\n    doc.setFontSize(9);\r\n    doc.setFont('helvetica', 'bold');\r\n\r\n    let xPos = tableMargin + 3;\r\n    doc.text('Sr.', xPos, y + 5);\r\n    xPos += colWidths.srNo;\r\n    doc.text('Receiver', xPos, y + 5);\r\n    xPos += colWidths.receiver;\r\n    doc.text('Package Size', xPos, y + 5);\r\n    xPos += colWidths.packageSize;\r\n    doc.text('Qty', xPos, y + 5);\r\n    xPos += colWidths.qty;\r\n    doc.text('Amount', xPos, y + 5);\r\n    y += rowHeight;\r\n\r\n    // Table Body\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFont('helvetica', 'normal');\r\n    let rowIndex = 0;\r\n    let grandTotal = 0;\r\n\r\n    formData?.receivers?.forEach((receiver: any, receiverIndex: number) => {\r\n      if (receiver.packages && receiver.packages.length > 0) {\r\n        receiver.packages.forEach((pkg: any, pkgIndex: number) => {\r\n          if (y > maxY) {\r\n            doc.addPage();\r\n            y = 15;\r\n          }\r\n\r\n          rowIndex++;\r\n          const amount = pkg.quantity * pkg.price;\r\n          grandTotal += amount;\r\n\r\n          // Alternating row colors\r\n          if (rowIndex % 2 === 0) {\r\n            doc.setFillColor(248, 248, 248);\r\n            doc.rect(tableMargin, y, tableWidth, rowHeight, 'F');\r\n          }\r\n\r\n          // Row border\r\n          doc.setDrawColor(220, 220, 220);\r\n          const currentRowHeight = pkgIndex === 0 ? rowHeight + 3 : rowHeight; // Extra height for receiver info\r\n          doc.rect(tableMargin, y, tableWidth, currentRowHeight, 'S');\r\n\r\n          doc.setFontSize(9);\r\n          xPos = tableMargin + 3;\r\n          doc.text(`${rowIndex}`, xPos, y + 5);\r\n          xPos += colWidths.srNo;\r\n\r\n          // Show receiver name and phone on first package row\r\n          if (pkgIndex === 0) {\r\n            const receiverDisplay = `${receiver.name || 'N/A'}`.substring(0, 22);\r\n            doc.setFont('helvetica', 'bold');\r\n            doc.text(receiverDisplay, xPos, y + 4);\r\n            // Phone number on second line\r\n            doc.setFontSize(8);\r\n            doc.setFont('helvetica', 'normal');\r\n            doc.setTextColor(100, 100, 100);\r\n            doc.text(`${receiver.phone || ''}`, xPos, y + 8);\r\n            doc.setTextColor(0, 0, 0);\r\n            doc.setFontSize(9);\r\n          }\r\n          xPos += colWidths.receiver;\r\n          doc.text(pkg.size || 'N/A', xPos, y + 5);\r\n          xPos += colWidths.packageSize;\r\n          doc.text(`${pkg.quantity}`, xPos, y + 5);\r\n          xPos += colWidths.qty;\r\n          doc.text(`${amount.toFixed(0)}`, xPos, y + 5);\r\n          y += currentRowHeight;\r\n        });\r\n      }\r\n    });\r\n\r\n    // Add delivery charge if any\r\n    if (formData?.deliveryCharge > 0) {\r\n      if (y > maxY) {\r\n        doc.addPage();\r\n        y = 15;\r\n      }\r\n      rowIndex++;\r\n      grandTotal += formData.deliveryCharge;\r\n\r\n      doc.setFillColor(255, 250, 240);\r\n      doc.rect(tableMargin, y, tableWidth, rowHeight, 'F');\r\n      doc.setDrawColor(220, 220, 220);\r\n      doc.rect(tableMargin, y, tableWidth, rowHeight, 'S');\r\n\r\n      doc.setFontSize(9);\r\n      xPos = tableMargin + 3;\r\n      doc.text(`${rowIndex}`, xPos, y + 5);\r\n      xPos += colWidths.srNo;\r\n      doc.setFont('helvetica', 'italic');\r\n      doc.text('Delivery Charge', xPos, y + 5);\r\n      doc.setFont('helvetica', 'normal');\r\n      xPos += colWidths.receiver + colWidths.packageSize;\r\n      doc.text('1', xPos, y + 5);\r\n      xPos += colWidths.qty;\r\n      doc.text(`${formData.deliveryCharge.toFixed(0)}`, xPos, y + 5);\r\n      y += rowHeight;\r\n    }\r\n\r\n    // ============ TOTAL ROW (Part of table) ============\r\n    doc.setFillColor(51, 51, 51);\r\n    doc.rect(tableMargin, y, tableWidth, rowHeight + 2, 'F');\r\n    doc.setTextColor(255, 255, 255);\r\n    doc.setFontSize(11);\r\n    doc.setFont('helvetica', 'bold');\r\n\r\n    const paymentMethodText = formData?.paymentMethod?.replace('_', ' ')?.toUpperCase() || 'CASH';\r\n    doc.text(`Payment: ${paymentMethodText}`, tableMargin + 3, y + 6);\r\n    // Align total under the Amount column\r\n    const totalXPos = tableMargin + colWidths.srNo + colWidths.receiver + colWidths.packageSize + colWidths.qty + 3;\r\n    doc.text(`TOTAL: ${grandTotal.toFixed(0)}`, totalXPos, y + 6);\r\n    y += rowHeight + 8;\r\n    doc.setTextColor(0, 0, 0);\r\n\r\n    // ============ THANK YOU MESSAGE ============\r\n    doc.setFontSize(9);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setTextColor(100, 100, 100);\r\n    doc.text('Thank you for choosing Dirba Amba Service!', pageWidth / 2, y, { align: 'center' });\r\n    doc.setTextColor(0, 0, 0);\r\n    y += 12;\r\n\r\n    // ============ SIGNATURE LINE ============\r\n    const signLineWidth = 45;\r\n    const signLineX = pageWidth - margin - signLineWidth;\r\n    doc.setDrawColor(150, 150, 150);\r\n    doc.setLineWidth(0.4);\r\n    doc.line(signLineX, y, signLineX + signLineWidth, y);\r\n    y += 4;\r\n    doc.setFontSize(8);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text('Authorized Signature', signLineX + signLineWidth / 2, y, { align: 'center' });\r\n\r\n    doc.save(`${receiptNumber}.pdf`);\r\n  };\r\n\r\n  const handleCopyReceipt = () => {\r\n    navigator.clipboard.writeText(receiptNumber);\r\n    alert('Receipt number copied!');\r\n  };\r\n\r\n  const handleGoToDashboard = () => {\r\n    if (onNavigate) {\r\n      onNavigate('dashboard');\r\n    } else {\r\n      window.location.reload();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"text-center space-y-6 py-8\">\r\n      {/* Different display for pending vs confirmed bookings */}\r\n      {isPending ? (\r\n        <>\r\n          <div className=\"text-6xl\">{pendingOp?.status === 'syncing' ? '' : pendingOp?.status === 'failed' ? '' : ''}</div>\r\n          <h2 className=\"text-3xl font-bold text-gray-900\">\r\n            {pendingOp?.status === 'syncing' ? 'Syncing Booking...' :\r\n              pendingOp?.status === 'failed' ? 'Sync Failed' :\r\n                'Booking Saved Locally'}\r\n          </h2>\r\n          <p className=\"text-gray-600\">\r\n            {isOnline\r\n              ? pendingOp?.status === 'failed'\r\n                ? 'Failed to sync. Will retry automatically or you can retry from the status bar.'\r\n                : 'Your booking will be synced shortly...'\r\n              : 'Your booking is saved and will be submitted when you\\'re back online.'}\r\n          </p>\r\n\r\n          <div className={`border rounded-lg p-6 max-w-md mx-auto ${pendingOp?.status === 'failed' ? 'bg-red-50 border-red-200' : 'bg-amber-50 border-amber-200'\r\n            }`}>\r\n            <p className=\"text-sm text-gray-600 mb-2\">Temporary Reference</p>\r\n            <p className={`text-2xl font-bold ${pendingOp?.status === 'failed' ? 'text-red-700' : 'text-amber-700'}`}>\r\n              {receiptNumber}\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-2\">\r\n              {pendingOp?.status === 'syncing' && ' Syncing now...'}\r\n              {pendingOp?.status === 'pending' && isOnline && ' Waiting to sync...'}\r\n              {pendingOp?.status === 'pending' && !isOnline && ' Will sync when online'}\r\n              {pendingOp?.status === 'failed' && ` ${pendingOp.error || 'Sync failed'}`}\r\n            </p>\r\n          </div>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <div className=\"text-6xl\"></div>\r\n          <h2 className=\"text-3xl font-bold text-gray-900\">Booking Created Successfully!</h2>\r\n          <p className=\"text-gray-600\">Your transport booking has been confirmed</p>\r\n\r\n          <div className=\"bg-green-50 border border-green-200 rounded-lg p-6 max-w-md mx-auto\">\r\n            <p className=\"text-sm text-gray-600 mb-2\">Receipt Number</p>\r\n            <p className=\"text-3xl font-bold text-green-700\">{receiptNumber}</p>\r\n            <button onClick={handleCopyReceipt} className=\"mt-2 text-sm text-green-600 hover:underline\">\r\n               Copy\r\n            </button>\r\n          </div>\r\n        </>\r\n      )}\r\n\r\n      <div className=\"bg-gray-50 border rounded-lg p-4 max-w-md mx-auto text-left\">\r\n        <div className=\"flex justify-between text-sm mb-1\">\r\n          <span>Route:</span>\r\n          <span className=\"font-medium\">{originDepot?.name}  {destinationDepot?.name}</span>\r\n        </div>\r\n        <div className=\"flex justify-between text-sm mb-1\">\r\n          <span>Sender:</span>\r\n          <span className=\"font-medium\">{formData?.senderName}</span>\r\n        </div>\r\n        <div className=\"flex justify-between font-bold pt-2 border-t mt-2\">\r\n          <span>Total:</span>\r\n          <span className={isPending ? \"text-amber-700\" : \"text-green-700\"}>{calculateTotal().toFixed(2)}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex flex-col gap-3 max-w-md mx-auto pt-4\">\r\n        {!isPending && (\r\n          <div className=\"flex gap-3\">\r\n            <button onClick={handleWhatsAppShare} className=\"flex-1 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-medium\">\r\n               WhatsApp\r\n            </button>\r\n            <button onClick={handleDownloadPDF} className=\"flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-medium\">\r\n               Download PDF\r\n            </button>\r\n          </div>\r\n        )}\r\n        {isPending && (\r\n          <div className=\"p-3 bg-gray-100 rounded-lg text-sm text-gray-600\">\r\n             Share and PDF options will be available after sync completes\r\n          </div>\r\n        )}\r\n        <button onClick={onNewBooking} className=\"py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-medium\">\r\n           Create New Booking\r\n        </button>\r\n        <button onClick={handleGoToDashboard} className=\"py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium\">\r\n           Go to Dashboard\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"file":"assets/NewBooking-DxyX9C5w.js"}